<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mitarbeiter-Verwaltung | Auto-Lackierzentrum Mosbach</title>

    <!-- Mobile-Responsive CSS Framework -->
    <link rel="stylesheet" href="mobile-responsive.css">

    <!-- Apple Liquid Glass Design System -->
    <link rel="stylesheet" href="design-system.css">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="animations.css">
    <link rel="stylesheet" href="mobile-first.css">

    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- GSAP Animation Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', 'Inter', var(--font-system);
            background: var(--color-background);
            min-height: 100vh;
            padding: var(--space-6) var(--space-4) 100px;
            color: var(--color-text-primary);
            transition: background 0.3s ease, color 0.3s ease;
            overflow-x: hidden;
            position: relative;
        }

        /* üé® Marken-Charakter: Dezentes Reflex-Pattern (Lack-Oberfl√§che) */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image: repeating-linear-gradient(
                45deg,
                transparent,
                transparent 50px,
                rgba(255, 255, 255, 0.02) 50px,
                rgba(255, 255, 255, 0.02) 51px
            );
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;

            /* Glassmorphismus - Apple Liquid Glass Style */
            background: var(--color-surface);
            backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
            border: 1px solid var(--color-border-glass);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);

            padding: var(--space-8);
            position: relative;
            overflow: hidden;

            /* ‚ú® Page-Transition: Slide-In beim Laden */
            animation: slideIn 0.4s cubic-bezier(0.22, 1, 0.36, 1);
        }

        /* üé¨ Page-Transition Animation */
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Navigation Bar */
        .nav-bar {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .nav-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: var(--color-primary);
            transform: translateY(-2px);
        }

        .nav-btn.active {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-size: 32px;
            font-weight: 700;
            color: var(--color-text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--color-primary-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 113, 227, 0.3);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid rgba(255, 0, 0, 0.5);
            color: #ff4444;
        }

        .btn-danger:hover {
            background: rgba(255, 0, 0, 0.3);
            transform: translateY(-2px);
        }

        /* Table */
        .mitarbeiter-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: var(--color-surface);
            border-radius: 12px;
            overflow: hidden;
        }

        .mitarbeiter-table thead {
            background: rgba(255, 255, 255, 0.1);
        }

        .mitarbeiter-table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--color-text-primary);
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .mitarbeiter-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            color: var(--color-text-secondary);
        }

        .mitarbeiter-table tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
            border: 1px solid rgba(40, 167, 69, 0.4);
        }

        .badge-warning {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
            border: 1px solid rgba(255, 193, 7, 0.4);
        }

        .badge-danger {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            border: 1px solid rgba(220, 53, 69, 0.4);
        }

        .badge-info {
            background: rgba(0, 113, 227, 0.2);
            color: var(--color-primary);
            border: 1px solid rgba(0, 113, 227, 0.4);
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--color-text-secondary);
        }

        .empty-state i {
            width: 64px;
            height: 64px;
            color: var(--color-text-secondary);
            opacity: 0.5;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: var(--color-text-primary);
        }

        /* Theme Toggle Button */
        .theme-toggle {
            position: fixed;
            top: var(--space-4);
            right: var(--space-4);
            z-index: 10000;
            width: 56px;
            height: 56px;
            border-radius: var(--radius-full);
            background: var(--color-surface);
            backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
            -webkit-backdrop-filter: blur(var(--glass-blur)) saturate(var(--glass-saturation));
            border: 1px solid var(--color-border-glass);
            box-shadow: var(--shadow-lg), inset 0 1px 1px rgba(255,255,255,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            border: none;
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotate(15deg);
            box-shadow: var(--shadow-xl), inset 0 1px 1px rgba(255,255,255,0.2);
        }

        .theme-toggle__icon {
            position: absolute;
            width: 24px;
            height: 24px;
            color: var(--color-text-primary);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        /* Show sun icon in dark mode, moon in light mode */
        [data-theme="dark"] .theme-toggle__icon--light {
            opacity: 1;
            transform: rotate(0deg) scale(1);
        }

        [data-theme="dark"] .theme-toggle__icon--dark {
            opacity: 0;
            transform: rotate(180deg) scale(0);
        }

        :root .theme-toggle__icon--light,
        [data-theme="light"] .theme-toggle__icon--light {
            opacity: 0;
            transform: rotate(-180deg) scale(0);
        }

        :root .theme-toggle__icon--dark,
        [data-theme="light"] .theme-toggle__icon--dark {
            opacity: 1;
            transform: rotate(0deg) scale(1);
        }

        /* Dark Mode - Text & Borders */
        [data-theme="dark"] .mitarbeiter-table th,
        [data-theme="dark"] .mitarbeiter-table td {
            color: rgba(255, 255, 255, 0.9);
        }

        [data-theme="dark"] .header h1 {
            color: rgba(255, 255, 255, 0.95);
        }

        [data-theme="dark"] .nav-btn {
            background: rgba(255, 255, 255, 0.08);
            color: rgba(255, 255, 255, 0.8);
            border-color: rgba(255, 255, 255, 0.2);
        }

        [data-theme="dark"] .nav-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            color: #2ec8ff;
        }

        [data-theme="dark"] .nav-btn.active {
            background: rgba(46, 200, 255, 0.3);
            color: rgba(255, 255, 255, 1);
            border-color: rgba(46, 200, 255, 0.6);
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            .header h1 {
                font-size: 24px;
            }

            .header-actions {
                width: 100%;
            }

            .btn {
                flex: 1;
                justify-content: center;
            }

            .mitarbeiter-table {
                font-size: 14px;
            }

            .mitarbeiter-table th,
            .mitarbeiter-table td {
                padding: 10px;
            }

            .theme-toggle {
                width: 48px;
                height: 48px;
                top: var(--space-3);
                right: var(--space-3);
            }

            .theme-toggle__icon {
                width: 20px;
                height: 20px;
            }
        }

        /* üåô Dark Mode Fix f√ºr Edit Modal */
        [data-theme="dark"] #modalContent {
            background: #2a2a2d !important;
        }

        [data-theme="dark"] #newMitarbeiterModalContent {
            background: #2a2a2d !important;
        }

        /* ‚úÖ TOGGLE SWITCH CHECKBOXEN - iOS Style */
        .permission-checkbox {
            display: none; /* Hide original checkbox */
        }

        .permission-label {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 10px;
            border-radius: 8px;
            transition: background 0.2s;
        }

        .permission-label:hover {
            background: rgba(255,255,255,0.05);
        }

        /* Toggle Switch Container */
        .toggle-switch {
            position: relative;
            width: 48px;
            height: 26px;
            background: rgba(255,255,255,0.15);
            border-radius: 13px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 2px solid rgba(255,255,255,0.2);
        }

        /* Toggle Slider */
        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 18px;
            height: 18px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Checked State */
        .permission-checkbox:checked + .permission-label .toggle-switch {
            background: linear-gradient(135deg, #34c759 0%, #30d158 100%); /* iOS Green */
            border-color: #34c759;
        }

        .permission-checkbox:checked + .permission-label .toggle-slider {
            transform: translateX(22px);
        }

        /* Permission Text */
        .permission-text {
            font-size: 14px;
            font-weight: 500;
            color: var(--color-text-secondary);
            transition: color 0.2s;
        }

        .permission-checkbox:checked + .permission-label .permission-text {
            color: var(--color-text-primary);
            font-weight: 600;
        }

        /* Hover Animation */
        .permission-label:hover .toggle-switch {
            transform: scale(1.05);
        }

        /* Active Animation (beim Klicken) */
        .permission-label:active .toggle-switch {
            transform: scale(0.95);
        }

        /* Dark Mode */
        [data-theme="dark"] .toggle-switch {
            background: rgba(255,255,255,0.1);
        }

        [data-theme="dark"] .toggle-slider {
            background: rgba(255,255,255,0.9);
        }

        /* Info Box Styles */
        .info-box {
            background: rgba(0, 113, 227, 0.1);
            border-left: 4px solid var(--color-primary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box p {
            color: var(--color-text-primary);
            margin: 0;
        }

        .success-box {
            background: rgba(40, 167, 69, 0.1);
            border-left: 4px solid #28a745;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .success-box p {
            color: var(--color-text-primary);
            margin: 0;
        }
    </style>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>

    <!-- Firebase Konfiguration -->
    <script src="firebase-config.js?v=4412ea9"></script>

    <!-- Auth Manager -->
    <script src="js/auth-manager.js?v=20251027-multitenant"></script>
</head>
<body>
    <!-- üåì THEME TOGGLE BUTTON - Fixed Top-Right -->
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle Light/Dark Mode">
        <i data-feather="sun" class="theme-toggle__icon theme-toggle__icon--light"></i>
        <i data-feather="moon" class="theme-toggle__icon theme-toggle__icon--dark"></i>
    </button>

    <div class="container">
        <!-- Navigation -->
        <div class="nav-bar">
            <a href="index.html" class="nav-btn">Home</a>
            <a href="annahme.html" class="nav-btn">Annahme</a>
            <a href="abnahme.html" class="nav-btn">Abnahme</a>
            <a href="liste.html" class="nav-btn">√úbersicht</a>
            <a href="kunden.html" class="nav-btn">Kunden</a>
            <a href="kalender.html" class="nav-btn">Kalender</a>
            <a href="kanban.html" class="nav-btn">Prozess√ºberwachung</a>
            <a href="mitarbeiter-verwaltung.html" class="nav-btn active">Mitarbeiter</a>
        </div>

        <!-- Header -->
        <div class="header">
            <h1>
                üë• Mitarbeiter-Verwaltung
                <span id="werkstattName" style="font-size: 18px; color: var(--color-text-secondary); font-weight: 400;"></span>
            </h1>
            <div class="header-actions">
                <button class="btn btn-success" onclick="openNewMitarbeiterModal()">
                    ‚ûï Neuer Mitarbeiter
                </button>
                <button class="btn btn-primary" onclick="createTestData()" style="background: rgba(0, 113, 227, 0.3); border: 2px solid var(--color-primary);">
                    üß™ Test-Daten (3)
                </button>
            </div>
        </div>

        <!-- Success Info Box (MULTI-TENANT) -->
        <div class="success-box">
            <p>
                <strong>‚úÖ MULTI-TENANT READY!</strong><br>
                Diese Seite nutzt jetzt <code>mitarbeiter_{werkstattId}</code> Collection.<br>
                Mitarbeiter sind werkstatt-spezifisch isoliert! üè¢
            </p>
        </div>

        <!-- Mitarbeiter Tabelle -->
        <table class="mitarbeiter-table">
            <thead>
                <tr>
                    <th>üë§ Name</th>
                    <th>üîë Passwort</th>
                    <th>‚úÖ Status</th>
                    <th>üîê Berechtigungen</th>
                    <th>‚öôÔ∏è Aktionen</th>
                </tr>
            </thead>
            <tbody id="mitarbeiterTableBody">
                <!-- Wird dynamisch gef√ºllt -->
                <tr>
                    <td colspan="5">
                        <div class="empty-state">
                            <i data-feather="users"></i>
                            <h3>L√§dt Mitarbeiter...</h3>
                            <p>Bitte warten...</p>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>

        <!-- EDIT MODAL -->
        <div id="editModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10001; overflow-y: auto; padding: 20px;">
            <div id="modalContent" style="max-width: 700px; margin: 50px auto; background: #ffffff; border-radius: 12px; padding: 30px; box-shadow: 0 8px 32px rgba(0,0,0,0.4);">
                <!-- Modal Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--color-text-primary); margin: 0;">‚úèÔ∏è Mitarbeiter bearbeiten</h2>
                    <button onclick="closeEditModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary);">‚úï</button>
                </div>

                <!-- Form -->
                <form id="editForm" onsubmit="saveMitarbeiter(event); return false;">
                    <!-- Hidden ID -->
                    <input type="hidden" id="editId">

                    <!-- Name -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; color: var(--color-text-primary);">üë§ Name</label>
                        <input type="text" id="editName" required style="width: 100%; padding: 10px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--color-text-primary); font-size: 14px;">
                    </div>

                    <!-- Status -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; color: var(--color-text-primary);">‚úÖ Status</label>
                        <select id="editStatus" required style="width: 100%; padding: 10px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--color-text-primary); font-size: 14px;">
                            <option value="active">Aktiv</option>
                            <option value="inactive">Inaktiv</option>
                        </select>
                    </div>

                    <!-- Password -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; color: var(--color-text-primary);">üîë Neues Passwort (optional - leer lassen um beizubehalten)</label>
                        <input type="password" id="editPassword" style="width: 100%; padding: 10px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--color-text-primary); font-size: 14px;" placeholder="Leer lassen f√ºr keine √Ñnderung">
                    </div>

                    <!-- Berechtigungen (14 Kacheln) - iOS Toggle Style -->
                    <div style="margin-bottom: 20px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div style="display: block; font-weight: 600; margin-bottom: 15px; color: var(--color-text-primary); font-size: 16px;">üîê Berechtigungen f√ºr Kacheln</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <!-- Fahrzeug-Management -->
                            <div>
                                <input type="checkbox" id="editAnnahme" class="permission-checkbox">
                                <label for="editAnnahme" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üöó Annahme</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editAbnahme" class="permission-checkbox">
                                <label for="editAbnahme" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">‚úÖ Abnahme</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editListe" class="permission-checkbox">
                                <label for="editListe" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìã √úbersicht</span>
                                </label>
                            </div>

                            <!-- Prozess-√úberwachung -->
                            <div>
                                <input type="checkbox" id="editKanban" class="permission-checkbox">
                                <label for="editKanban" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìä Kanban</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editKunden" class="permission-checkbox">
                                <label for="editKunden" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üë• Kunden</span>
                                </label>
                            </div>

                            <!-- Organisation & Partner -->
                            <div>
                                <input type="checkbox" id="editKalender" class="permission-checkbox">
                                <label for="editKalender" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìÖ Kalender</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editMaterial" class="permission-checkbox">
                                <label for="editMaterial" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üì¶ Material</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editPartnerAnfragen" class="permission-checkbox">
                                <label for="editPartnerAnfragen" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìß Partner-Anfragen</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editPartnerPortal" class="permission-checkbox">
                                <label for="editPartnerPortal" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üîó Partner-Portal</span>
                                </label>
                            </div>

                            <!-- Admin-Funktionen -->
                            <div>
                                <input type="checkbox" id="editMitarbeiterVerwaltung" class="permission-checkbox">
                                <label for="editMitarbeiterVerwaltung" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üë§ Mitarbeiter-Verwaltung</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editNutzerVerwaltung" class="permission-checkbox">
                                <label for="editNutzerVerwaltung" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üë• User-Verwaltung</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editRegistrierung" class="permission-checkbox">
                                <label for="editRegistrierung" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìù Registrierung</span>
                                </label>
                            </div>

                            <!-- KI-Assistent -->
                            <div>
                                <input type="checkbox" id="editKiChat" class="permission-checkbox">
                                <label for="editKiChat" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üí¨ KI-Chat</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="editKiSprache" class="permission-checkbox">
                                <label for="editKiSprache" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üé§ KI-Sprache</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="deleteMitarbeiter()" class="btn btn-danger">
                            üóëÔ∏è L√∂schen
                        </button>
                        <button type="button" onclick="closeEditModal()" class="btn" style="background: rgba(255,255,255,0.1); color: var(--color-text-primary);">
                            Abbrechen
                        </button>
                        <button type="submit" class="btn btn-primary">
                            üíæ Speichern
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- NEW MITARBEITER MODAL -->
        <div id="newMitarbeiterModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10001; overflow-y: auto; padding: 20px;">
            <div id="newMitarbeiterModalContent" style="max-width: 700px; margin: 50px auto; background: #ffffff; border-radius: 12px; padding: 30px; box-shadow: 0 8px 32px rgba(0,0,0,0.4);">
                <!-- Modal Header -->
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2 style="color: var(--color-text-primary); margin: 0;">‚ûï Neuer Mitarbeiter</h2>
                    <button onclick="closeNewMitarbeiterModal()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--color-text-secondary);">‚úï</button>
                </div>

                <!-- Form -->
                <form id="newMitarbeiterForm" onsubmit="createNewMitarbeiter(event); return false;">
                    <!-- Name -->
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; color: var(--color-text-primary);">üë§ Name</label>
                        <input type="text" id="newName" required style="width: 100%; padding: 10px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--color-text-primary); font-size: 14px;" placeholder="z.B. Max Mustermann">
                    </div>

                    <!-- Password -->
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; font-weight: 600; margin-bottom: 5px; color: var(--color-text-primary);">üîë Passwort</label>
                        <input type="password" id="newPassword" required style="width: 100%; padding: 10px; border: 2px solid rgba(255,255,255,0.2); border-radius: 8px; background: rgba(255,255,255,0.05); color: var(--color-text-primary); font-size: 14px;" placeholder="Mindestens 4 Zeichen" minlength="4">
                    </div>

                    <!-- Berechtigungen (14 Kacheln) - iOS Toggle Style -->
                    <div style="margin-bottom: 20px; padding: 20px; background: rgba(255,255,255,0.05); border-radius: 8px;">
                        <div style="display: block; font-weight: 600; margin-bottom: 15px; color: var(--color-text-primary); font-size: 16px;">üîê Berechtigungen f√ºr Kacheln</div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <!-- Same 14 checkboxes as edit modal, but with "new" prefix -->
                            <div>
                                <input type="checkbox" id="newAnnahme" class="permission-checkbox">
                                <label for="newAnnahme" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üöó Annahme</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newAbnahme" class="permission-checkbox">
                                <label for="newAbnahme" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">‚úÖ Abnahme</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newListe" class="permission-checkbox">
                                <label for="newListe" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìã √úbersicht</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newKanban" class="permission-checkbox">
                                <label for="newKanban" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìä Kanban</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newKunden" class="permission-checkbox">
                                <label for="newKunden" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üë• Kunden</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newKalender" class="permission-checkbox">
                                <label for="newKalender" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìÖ Kalender</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newMaterial" class="permission-checkbox">
                                <label for="newMaterial" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üì¶ Material</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newPartnerAnfragen" class="permission-checkbox">
                                <label for="newPartnerAnfragen" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìß Partner-Anfragen</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newPartnerPortal" class="permission-checkbox">
                                <label for="newPartnerPortal" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üîó Partner-Portal</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newMitarbeiterVerwaltung" class="permission-checkbox">
                                <label for="newMitarbeiterVerwaltung" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üë§ Mitarbeiter-Verwaltung</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newNutzerVerwaltung" class="permission-checkbox">
                                <label for="newNutzerVerwaltung" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üë• User-Verwaltung</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newRegistrierung" class="permission-checkbox">
                                <label for="newRegistrierung" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üìù Registrierung</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newKiChat" class="permission-checkbox">
                                <label for="newKiChat" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üí¨ KI-Chat</span>
                                </label>
                            </div>
                            <div>
                                <input type="checkbox" id="newKiSprache" class="permission-checkbox">
                                <label for="newKiSprache" class="permission-label">
                                    <div class="toggle-switch">
                                        <div class="toggle-slider"></div>
                                    </div>
                                    <span class="permission-text">üé§ KI-Sprache</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Buttons -->
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <button type="button" onclick="closeNewMitarbeiterModal()" class="btn" style="background: rgba(255,255,255,0.1); color: var(--color-text-primary);">
                            Abbrechen
                        </button>
                        <button type="submit" class="btn btn-success">
                            ‚ûï Erstellen
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Initialize Feather Icons -->
    <script>
        feather.replace();
    </script>

    <!-- Theme Toggle Logic -->
    <script>
        (function initThemeToggle() {
            const themeToggle = document.getElementById('themeToggle');
            const html = document.documentElement;

            // Initialize theme (default: light)
            let currentTheme = localStorage.getItem('theme') || 'light';
            html.setAttribute('data-theme', currentTheme);
            console.log(`üåì Theme initialized: ${currentTheme}`);

            // Toggle theme on button click
            themeToggle.addEventListener('click', () => {
                currentTheme = currentTheme === 'light' ? 'dark' : 'light';
                html.setAttribute('data-theme', currentTheme);
                localStorage.setItem('theme', currentTheme);

                console.log(`üåì Theme switched to: ${currentTheme}`);

                // Re-initialize Feather Icons for theme change
                if (typeof feather !== 'undefined') {
                    feather.replace();
                }
            });

            console.log('‚úÖ Theme Toggle initialized');
        })();
    </script>

    <!-- MULTI-TENANT MITARBEITER-VERWALTUNG -->
    <script>
        // ============================================
        // PHASE 6: MULTI-TENANT MITARBEITER-VERWALTUNG
        // ============================================

        let mitarbeiterList = [];
        let currentWerkstattId = null;
        let currentWerkstattName = null;

        // Initialize App
        async function initApp() {
            console.log('üöÄ Initialisiere Multi-Tenant Mitarbeiter-Verwaltung...');

            // Wait for Firebase + Auth Manager
            await window.initFirebase();

            if (!window.firebaseInitialized || !window.authManager) {
                console.error('‚ùå Firebase oder Auth Manager nicht initialisiert!');
                alert('‚ö†Ô∏è Fehler: Firebase konnte nicht initialisiert werden. Bitte Seite neu laden.');
                return;
            }

            // Check if user is logged in as werkstatt
            // ‚ö†Ô∏è WICHTIG: Warte auf Auth State Listener (Race Condition Fix)
            let currentUser = null;
            let attempts = 0;
            const maxAttempts = 20; // 20 * 250ms = 5 Sekunden max

            while (!currentUser && attempts < maxAttempts) {
                currentUser = window.authManager.getCurrentUser();
                if (!currentUser) {
                    console.log(`‚è≥ Warte auf Auth State Listener (Versuch ${attempts + 1}/${maxAttempts})...`);
                    await new Promise(resolve => setTimeout(resolve, 250)); // 250ms warten
                    attempts++;
                }
            }

            if (!currentUser) {
                console.error('‚ùå Auth Timeout: Kein User eingeloggt nach 5 Sekunden');
                alert('‚ö†Ô∏è Bitte zuerst als Werkstatt einloggen!');
                window.location.href = 'index.html';
                return;
            }

            console.log('‚úÖ Auth State erfolgreich geladen nach', attempts * 250, 'ms');

            currentWerkstattId = currentUser.werkstattId;
            currentWerkstattName = currentUser.werkstattName || currentUser.name;

            if (!currentWerkstattId) {
                console.error('‚ùå User hat keine werkstattId!');
                alert('‚ö†Ô∏è Fehler: Werkstatt-ID fehlt. Bitte neu einloggen.');
                window.location.href = 'index.html';
                return;
            }

            console.log('‚úÖ Eingeloggt als Werkstatt:', currentWerkstattName);
            console.log('   WerkstattID:', currentWerkstattId);

            // Update header
            document.getElementById('werkstattName').textContent = `(${currentWerkstattName})`;

            // Load mitarbeiter (werkstatt-specific)
            await loadMitarbeiter();

            console.log('‚úÖ App erfolgreich initialisiert');
        }

        // ============================================
        // PASSWORD HASHING (SHA-256)
        // ============================================

        /**
         * Hash password using SHA-256
         * Matches auth-manager.js implementation
         */
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hashBuffer = await crypto.subtle.digest('SHA-256', data);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        // ============================================
        // LOAD MITARBEITER (WERKSTATT-SPECIFIC)
        // ============================================

        async function loadMitarbeiter() {
            console.log('üì• Lade Mitarbeiter f√ºr werkstattId:', currentWerkstattId);

            try {
                // Use window.getCollection() helper from firebase-config.js
                const mitarbeiterCollection = window.getCollection('mitarbeiter');

                console.log('   Collection:', mitarbeiterCollection._delegate._path.segments.join('/'));

                // Setup realtime listener
                mitarbeiterCollection.onSnapshot((snapshot) => {
                    mitarbeiterList = snapshot.docs
                        .filter(doc => doc.id !== '_init') // Skip init doc
                        .map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));

                    console.log(`‚úÖ ${mitarbeiterList.length} Mitarbeiter geladen (Realtime Update)`);

                    // Render table
                    renderMitarbeiterTable();
                }, (error) => {
                    console.error('‚ùå Fehler beim Laden der Mitarbeiter:', error);
                    alert('‚ùå Fehler beim Laden der Mitarbeiter. Siehe Console f√ºr Details.');
                });

            } catch (error) {
                console.error('‚ùå Fehler beim Setup des Listeners:', error);
                alert('‚ùå Fehler beim Setup. Siehe Console f√ºr Details.');
            }
        }

        // ============================================
        // RENDER MITARBEITER TABLE
        // ============================================

        function renderMitarbeiterTable() {
            const tbody = document.getElementById('mitarbeiterTableBody');

            if (mitarbeiterList.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5">
                            <div class="empty-state">
                                <i data-feather="users"></i>
                                <h3>Noch keine Mitarbeiter vorhanden</h3>
                                <p>Klicken Sie auf "Neuer Mitarbeiter" oder "Test-Daten (3)" um Mitarbeiter hinzuzuf√ºgen.</p>
                            </div>
                        </td>
                    </tr>
                `;
                feather.replace();
                return;
            }

            tbody.innerHTML = mitarbeiterList.map(user => {
                // Berechtigungen count (aus 14 m√∂glichen)
                const berechtigungenCount = user.berechtigungen
                    ? Object.values(user.berechtigungen).filter(v => v === true).length
                    : 0;

                // Berechtigung badge mit Farbe basierend auf Anzahl
                let badgeClass = 'badge-info';
                if (berechtigungenCount >= 10) {
                    badgeClass = 'badge-success'; // Gr√ºn f√ºr viele Berechtigungen
                } else if (berechtigungenCount >= 5) {
                    badgeClass = 'badge-warning'; // Gelb f√ºr mittlere Berechtigungen
                } else {
                    badgeClass = 'badge-danger'; // Rot f√ºr wenige Berechtigungen
                }

                // Status badge
                const statusBadge = user.status === 'active'
                    ? '<span class="badge badge-success">Aktiv</span>'
                    : '<span class="badge badge-danger">Inaktiv</span>';

                return `
                    <tr>
                        <td><strong>${user.name}</strong></td>
                        <td>${user.passwordHash ? '<span style="color: #34c759;">‚úÖ Gesetzt</span>' : '<span style="color: #ff4444;">‚ùå Fehlt</span>'}</td>
                        <td>${statusBadge}</td>
                        <td>
                            <span class="badge ${badgeClass}">${berechtigungenCount}/14 Kacheln</span>
                        </td>
                        <td>
                            <button class="btn btn-primary" style="padding: 8px 16px; font-size: 12px;" onclick="openEditModal('${user.id}')">
                                ‚úèÔ∏è Bearbeiten
                            </button>
                        </td>
                    </tr>
                `;
            }).join('');

            feather.replace();
            console.log('‚úÖ Tabelle gerendert mit', mitarbeiterList.length, 'Mitarbeitern');
        }

        // ============================================
        // MODAL FUNCTIONS
        // ============================================

        function openEditModal(userId) {
            const user = mitarbeiterList.find(u => u.id === userId);
            if (!user) {
                console.error('‚ùå Mitarbeiter nicht gefunden:', userId);
                return;
            }

            console.log('üìù √ñffne Edit-Modal f√ºr:', user.name);

            // Populate form fields
            document.getElementById('editId').value = user.id;
            document.getElementById('editName').value = user.name;
            document.getElementById('editStatus').value = user.status || 'active';
            document.getElementById('editPassword').value = ''; // Never show password

            // Populate all checkboxes (14 berechtigungen)
            document.getElementById('editAnnahme').checked = user.berechtigungen?.annahme || false;
            document.getElementById('editAbnahme').checked = user.berechtigungen?.abnahme || false;
            document.getElementById('editListe').checked = user.berechtigungen?.liste || false;
            document.getElementById('editKanban').checked = user.berechtigungen?.kanban || false;
            document.getElementById('editKunden').checked = user.berechtigungen?.kunden || false;
            document.getElementById('editKalender').checked = user.berechtigungen?.kalender || false;
            document.getElementById('editMaterial').checked = user.berechtigungen?.material || false;
            document.getElementById('editPartnerAnfragen').checked = user.berechtigungen?.partnerAnfragen || false;
            document.getElementById('editPartnerPortal').checked = user.berechtigungen?.partnerPortal || false;
            document.getElementById('editMitarbeiterVerwaltung').checked = user.berechtigungen?.mitarbeiterVerwaltung || false;
            document.getElementById('editNutzerVerwaltung').checked = user.berechtigungen?.nutzerVerwaltung || false;
            document.getElementById('editRegistrierung').checked = user.berechtigungen?.registrierung || false;
            document.getElementById('editKiChat').checked = user.berechtigungen?.kiChat || false;
            document.getElementById('editKiSprache').checked = user.berechtigungen?.kiSprache || false;

            // Show modal
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            console.log('‚ùå Schlie√üe Edit-Modal');
            document.getElementById('editModal').style.display = 'none';
            document.getElementById('editForm').reset();
        }

        async function saveMitarbeiter(event) {
            event.preventDefault();

            const userId = document.getElementById('editId').value;
            console.log('üíæ Speichere √Ñnderungen f√ºr:', userId);

            // Check if new password was entered
            const newPassword = document.getElementById('editPassword').value;
            let passwordHash = null;
            if (newPassword && newPassword.trim() !== '') {
                passwordHash = await hashPassword(newPassword);
                console.log('üîí Neues Passwort gehasht (SHA-256)');
            }

            const updates = {
                name: document.getElementById('editName').value,
                status: document.getElementById('editStatus').value,
                berechtigungen: {
                    annahme: document.getElementById('editAnnahme').checked,
                    abnahme: document.getElementById('editAbnahme').checked,
                    liste: document.getElementById('editListe').checked,
                    kanban: document.getElementById('editKanban').checked,
                    kunden: document.getElementById('editKunden').checked,
                    kalender: document.getElementById('editKalender').checked,
                    material: document.getElementById('editMaterial').checked,
                    partnerAnfragen: document.getElementById('editPartnerAnfragen').checked,
                    partnerPortal: document.getElementById('editPartnerPortal').checked,
                    mitarbeiterVerwaltung: document.getElementById('editMitarbeiterVerwaltung').checked,
                    nutzerVerwaltung: document.getElementById('editNutzerVerwaltung').checked,
                    registrierung: document.getElementById('editRegistrierung').checked,
                    kiChat: document.getElementById('editKiChat').checked,
                    kiSprache: document.getElementById('editKiSprache').checked
                },
                lastModified: new Date().toISOString()
            };

            // Add password hash if new password was entered
            if (passwordHash) {
                updates.passwordHash = passwordHash;
            }

            try {
                const mitarbeiterCollection = window.getCollection('mitarbeiter');
                await mitarbeiterCollection.doc(userId).update(updates);
                console.log('‚úÖ Mitarbeiter erfolgreich aktualisiert:', userId);

                // Close modal (realtime listener will update table)
                closeEditModal();

                alert('‚úÖ √Ñnderungen erfolgreich gespeichert!');
            } catch (error) {
                console.error('‚ùå Fehler beim Speichern:', error);
                alert('‚ùå Fehler beim Speichern. Siehe Console f√ºr Details.');
            }
        }

        async function deleteMitarbeiter() {
            const userId = document.getElementById('editId').value;
            const userName = document.getElementById('editName').value;

            if (!confirm(`‚ö†Ô∏è Mitarbeiter "${userName}" wirklich l√∂schen?\n\nDieser Vorgang kann nicht r√ºckg√§ngig gemacht werden!`)) {
                return;
            }

            console.log('üóëÔ∏è L√∂sche Mitarbeiter:', userId);

            try {
                const mitarbeiterCollection = window.getCollection('mitarbeiter');
                await mitarbeiterCollection.doc(userId).delete();
                console.log('‚úÖ Mitarbeiter erfolgreich gel√∂scht:', userId);

                // Close modal (realtime listener will update table)
                closeEditModal();

                alert(`‚úÖ Mitarbeiter "${userName}" erfolgreich gel√∂scht!`);
            } catch (error) {
                console.error('‚ùå Fehler beim L√∂schen:', error);
                alert('‚ùå Fehler beim L√∂schen. Siehe Console f√ºr Details.');
            }
        }

        // ============================================
        // NEW MITARBEITER MODAL
        // ============================================

        function openNewMitarbeiterModal() {
            console.log('‚ûï √ñffne Neuer-Mitarbeiter Modal');
            document.getElementById('newMitarbeiterModal').style.display = 'block';
        }

        function closeNewMitarbeiterModal() {
            console.log('‚ùå Schlie√üe Neuer-Mitarbeiter Modal');
            document.getElementById('newMitarbeiterModal').style.display = 'none';
            document.getElementById('newMitarbeiterForm').reset();
        }

        async function createNewMitarbeiter(event) {
            event.preventDefault();

            console.log('üíæ Erstelle neuen Mitarbeiter...');

            // Generate unique ID
            const userId = `user_${Date.now()}`;

            // Hash password
            const password = document.getElementById('newPassword').value;
            const passwordHash = await hashPassword(password);
            console.log('üîí Passwort gehasht (SHA-256)');

            const newUser = {
                name: document.getElementById('newName').value,
                passwordHash: passwordHash,
                status: 'active', // New users are active by default
                berechtigungen: {
                    annahme: document.getElementById('newAnnahme').checked,
                    abnahme: document.getElementById('newAbnahme').checked,
                    liste: document.getElementById('newListe').checked,
                    kanban: document.getElementById('newKanban').checked,
                    kunden: document.getElementById('newKunden').checked,
                    kalender: document.getElementById('newKalender').checked,
                    material: document.getElementById('newMaterial').checked,
                    partnerAnfragen: document.getElementById('newPartnerAnfragen').checked,
                    partnerPortal: document.getElementById('newPartnerPortal').checked,
                    mitarbeiterVerwaltung: document.getElementById('newMitarbeiterVerwaltung').checked,
                    nutzerVerwaltung: document.getElementById('newNutzerVerwaltung').checked,
                    registrierung: document.getElementById('newRegistrierung').checked,
                    kiChat: document.getElementById('newKiChat').checked,
                    kiSprache: document.getElementById('newKiSprache').checked
                },
                werkstattId: currentWerkstattId, // Add werkstattId for reference
                createdAt: new Date().toISOString(),
                createdBy: currentWerkstattName,
                lastLogin: null
            };

            try {
                const mitarbeiterCollection = window.getCollection('mitarbeiter');
                await mitarbeiterCollection.doc(userId).set(newUser);
                console.log('‚úÖ Neuer Mitarbeiter erfolgreich erstellt:', newUser.name);

                // Close modal (realtime listener will update table)
                closeNewMitarbeiterModal();

                alert(`‚úÖ Mitarbeiter "${newUser.name}" erfolgreich erstellt!`);
            } catch (error) {
                console.error('‚ùå Fehler beim Erstellen:', error);
                alert('‚ùå Fehler beim Erstellen. Siehe Console f√ºr Details.');
            }
        }

        // ============================================
        // TEST DATA CREATION
        // ============================================

        async function createTestData() {
            if (!confirm('üß™ 3 Test-Mitarbeiter erstellen?\n\n- Max M√ºller (Vollzugriff)\n- Anna Schmidt (Teilzugriff)\n- Tom Weber (Basiszugriff)')) {
                return;
            }

            console.log('üß™ Erstelle Test-Mitarbeiter...');

            const testUsers = [
                {
                    id: `user_max_${Date.now()}`,
                    name: 'Max M√ºller (Vollzugriff)',
                    passwordHash: await hashPassword('1234'), // Test password: 1234
                    status: 'active',
                    berechtigungen: {
                        annahme: true,
                        abnahme: true,
                        liste: true,
                        kanban: true,
                        kunden: true,
                        kalender: true,
                        material: true,
                        partnerAnfragen: true,
                        partnerPortal: true,
                        mitarbeiterVerwaltung: true,
                        nutzerVerwaltung: true,
                        registrierung: true,
                        kiChat: true,
                        kiSprache: true
                    },
                    werkstattId: currentWerkstattId,
                    createdAt: new Date().toISOString(),
                    createdBy: 'Test-Daten Generator',
                    lastLogin: null
                },
                {
                    id: `user_anna_${Date.now()}`,
                    name: 'Anna Schmidt (Teilzugriff)',
                    passwordHash: await hashPassword('1234'),
                    status: 'active',
                    berechtigungen: {
                        annahme: true,
                        abnahme: true,
                        liste: true,
                        kanban: true,
                        kunden: false,
                        kalender: true,
                        material: true,
                        partnerAnfragen: false,
                        partnerPortal: false,
                        mitarbeiterVerwaltung: false,
                        nutzerVerwaltung: false,
                        registrierung: false,
                        kiChat: true,
                        kiSprache: false
                    },
                    werkstattId: currentWerkstattId,
                    createdAt: new Date().toISOString(),
                    createdBy: 'Test-Daten Generator',
                    lastLogin: null
                },
                {
                    id: `user_tom_${Date.now()}`,
                    name: 'Tom Weber (Basiszugriff)',
                    passwordHash: await hashPassword('1234'),
                    status: 'inactive', // Inactive for testing
                    berechtigungen: {
                        annahme: true,
                        abnahme: false,
                        liste: true,
                        kanban: true,
                        kunden: false,
                        kalender: false,
                        material: false,
                        partnerAnfragen: false,
                        partnerPortal: false,
                        mitarbeiterVerwaltung: false,
                        nutzerVerwaltung: false,
                        registrierung: false,
                        kiChat: false,
                        kiSprache: false
                    },
                    werkstattId: currentWerkstattId,
                    createdAt: new Date().toISOString(),
                    createdBy: 'Test-Daten Generator',
                    lastLogin: null
                }
            ];

            try {
                const mitarbeiterCollection = window.getCollection('mitarbeiter');

                for (const user of testUsers) {
                    await mitarbeiterCollection.doc(user.id).set(user);
                    console.log(`‚úÖ Test-Mitarbeiter erstellt: ${user.name}`);
                }

                alert('‚úÖ 3 Test-Mitarbeiter erfolgreich erstellt!\n\nPasswort f√ºr alle: 1234\n\n‚Ä¢ Max M√ºller (Vollzugriff, Aktiv)\n‚Ä¢ Anna Schmidt (Teilzugriff, Aktiv)\n‚Ä¢ Tom Weber (Basiszugriff, Inaktiv)');
            } catch (error) {
                console.error('‚ùå Fehler beim Erstellen der Test-Daten:', error);
                alert('‚ùå Fehler beim Erstellen. Siehe Console f√ºr Details.');
            }
        }

        // ============================================
        // INITIALIZE APP ON PAGE LOAD
        // ============================================

        window.addEventListener('DOMContentLoaded', async () => {
            console.log('üöÄ DOMContentLoaded - starte App...');
            await initApp();
        });

        console.log('‚úÖ PHASE 6: Multi-Tenant Mitarbeiter-Verwaltung geladen');
    </script>
</body>
</html>
