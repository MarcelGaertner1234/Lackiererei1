<!DOCTYPE html>
<!-- CACHE BUSTER: v2025-11-11-2210-window-functions-fix -->
<html lang="de">
<head>
    <!-- werkstattId will be set dynamically by auth-manager.js after login -->
    <script>
        /// <reference path="js/types.js" />
        // window.werkstattId is set automatically after successful login
        // This ensures proper multi-tenant data isolation
    </script>
    <script>
        // üÜï FIX #2: PDF UPLOAD VALIDATION (2025-11-15)
        // Prevents: Non-PDF uploads, Storage quota exhaustion, Malware-disguised PDFs
        window.validatePDFFile = function(file) {
            const allowedType = 'application/pdf';
            const maxSize = 50 * 1024 * 1024; // 50 MB

            if (!file) {
                throw new Error('‚ùå Keine PDF-Datei!');
            }

            // Check 1: File-Type Validation
            if (file.type !== allowedType) {
                throw new Error(`‚ùå Nur PDF erlaubt!\n\nDein Typ: ${file.type || 'unbekannt'}`);
            }

            // Check 2: Size Validation
            if (file.size > maxSize) {
                throw new Error(`‚ùå PDF zu gro√ü!\n\nMaximum: 50 MB\nDeine Gr√∂√üe: ${(file.size / 1024 / 1024).toFixed(2)} MB`);
            }

            console.log('‚úÖ [validatePDFFile] PDF validiert:', {
                type: file.type,
                sizeMB: (file.size / 1024 / 1024).toFixed(2)
            });

            return { isValid: true };
        };
    </script>
    <script>
        // ‚úÖ BUG #5 FIX: Global DEBUG flag for conditional logging
        window.DEBUG = (
            localStorage.getItem('DEBUG') === 'true' ||
            window.location.search.includes('debug=true') ||
            window.location.hostname === 'localhost' ||
            window.location.port === '8000'
        );
    </script>

    <!-- ‚úÖ BUG #7 FIX: Service Type Normalization Registry -->
    <script src="js/service-types.js?v=bug7-normalization"></script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fahrzeug-Annahme | Auto-Lackierzentrum Mosbach</title>

    <!-- Aggressive No-Cache Headers (Cache-Fix f√ºr v=a4192c4) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- üåì FOUC Prevention: Load Theme BEFORE CSS to prevent flash -->
    <script>
        (function() {
            // Load saved theme from localStorage (default: light)
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            console.log(`üåì Theme pre-loaded in <head>: ${savedTheme} (FOUC Prevention)`);
        })();
    </script>

    <!-- Design System -->
    <link rel="stylesheet" href="design-system.css?v=af6b90f">
    <link rel="stylesheet" href="components.css?v=af6b90f">
    <link rel="stylesheet" href="animations.css?v=af6b90f">
    <link rel="stylesheet" href="mobile-first.css?v=af6b90f">
    <link rel="stylesheet" href="css/ai-chat-widget.css">
    <link rel="stylesheet" href="css/quota-display.css">

    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <!-- jsPDF autoTable Plugin for Excel-Style Tables (Nov 20, 2025) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>

    <!-- PDF.js for PDF Parsing -->
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>

    <!-- QRious - Browser-optimized QR Code Generator (Local Copy) -->
    <script src="./libs/qrious.min.js"></script>

    <!-- GSAP Animation Library (Phase 1 UX Redesign) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>


    <!-- üõ°Ô∏è PERFORMANCE FIX Phase 2: Ausgelagertes CSS -->
    <link rel="stylesheet" href="css/annahme.css">

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>

    <!-- Firebase Konfiguration -->
    <script src="firebase-config.js?v=a4192c4"></script>

    <!-- Auth Manager f√ºr Multi-Tenant Support -->
    <script src="js/auth-manager.js"></script>
    <script src="js/settings-manager.js"></script>
    <script src="js/permissions-helper.js"></script>

    <!-- Listener Registry (must load early!) -->
    <script src="listener-registry.js?v=6020c9e"></script>

    <!-- Image Optimizer -->
    <script src="image-optimizer.js"></script>

    <!-- Global Chat Notifications -->
    <link rel="stylesheet" href="global-chat-notifications.css">
    <script src="global-chat-notifications.js"></script>

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>
</head>
<body class="has-ai-features">
    <!-- üé® Modern 2025 Background Effects -->
    <div class="gradient-mesh" aria-hidden="true"></div>
    <div class="noise-overlay" aria-hidden="true"></div>
    <div class="floating-orb floating-orb--1" aria-hidden="true"></div>
    <div class="floating-orb floating-orb--2" aria-hidden="true"></div>
    <div class="floating-orb floating-orb--3" aria-hidden="true"></div>

    <!-- üîô ZUR√úCK-BUTTON -->
    <button class="back-button" onclick="history.back()" title="Zur√ºck">
        <i data-feather="arrow-left"></i>
        <span>Zur√ºck</span>
    </button>

    <!-- THEME TOGGLE BUTTON -->
    <button id="themeToggle" class="theme-toggle" aria-label="Toggle Light/Dark Mode">
        <i data-feather="sun" class="theme-toggle__icon theme-toggle__icon--light"></i>
        <i data-feather="moon" class="theme-toggle__icon theme-toggle__icon--dark"></i>
    </button>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>
                <i data-feather="file-plus"></i>
                Fahrzeug-Annahme
            </h1>
            <p>Auto-Lackierzentrum Mosbach</p>
        </div>

        <div class="date-display">
            Datum: <strong id="currentDate"></strong>
        </div>

        <div class="success-message" id="successMessage">
            ‚úÖ Fahrzeug erfolgreich aufgenommen!
        </div>

        <div class="info-box">
            <i data-feather="info"></i>
            <div class="info-box-content">
                <strong>Tipp:</strong>
                <p>F√ºllen Sie alle Fahrzeugdaten und die Farbnummer aus - das erleichtert die Arbeit in der Farbkabine enorm!</p>
            </div>
        </div>

        <!-- Form -->
        <form id="annahmeForm">
            <div class="form-container">
                <!-- KUNDENDATEN -->
                <div class="section-title">
                    <i data-feather="user"></i>
                    Kundendaten
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="kennzeichen" class="form-label">Kennzeichen <span class="required">*</span></label>
                        <input type="text" id="kennzeichen" class="form-input" placeholder="z.B. MOS-CG 123" required style="text-transform: uppercase;">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Kundenauswahl</label>
                        <select id="kundenDropdown" class="form-select" onchange="selectKunde()">
                            <option value="">üÜï Neuer Kunde</option>
                            <!-- Dynamisch gef√ºllt -->
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label for="kundenname" class="form-label">Kundenname <span class="required">*</span></label>
                    <input type="text" id="kundenname" class="form-input" placeholder="z.B. Max Mustermann" required>
                </div>

                <div class="form-group">
                    <label for="kundenEmail" class="form-label">Kunden-Email <span class="required">*</span></label>
                    <input type="email" id="kundenEmail" class="form-input" placeholder="z.B. kunde@example.com" required>
                    <small style="color: var(--color-text-tertiary); display: block; margin-top: var(--space-1);">
                        üìß Ben√∂tigt f√ºr automatische Status-Updates per Email
                    </small>
                </div>

                <div class="form-group">
                    <label for="telefon" class="form-label">Telefonnummer</label>
                    <input type="tel" id="telefon" class="form-input" placeholder="z.B. +49 6261 123456 oder 06261 123456">
                    <small style="color: var(--color-text-tertiary); display: block; margin-top: var(--space-1);">
                        üìû Optional - f√ºr telefonische R√ºckfragen
                    </small>
                </div>

                <div class="form-group">
                    <label for="geplantesAbnahmeDatum" class="form-label">Voraussichtliches Abnahme-Datum <span class="required">*</span></label>
                    <input type="date" id="geplantesAbnahmeDatum" class="form-input" required>
                </div>

                <div class="form-group">
                    <label for="serviceTyp" class="form-label">Service-Typ <span class="required">*</span></label>
                    <select id="serviceTyp" class="form-select" required>
                        <option value="lackier">üé® Lackierung</option>
                        <option value="reifen">üîß Reifen-Service</option>
                        <option value="mechanik">‚öôÔ∏è Mechanik</option>
                        <option value="pflege">‚ú® Pflege & Aufbereitung</option>
                        <option value="tuev">üìã T√úV & Pr√ºfung</option>
                        <option value="versicherung">üõ°Ô∏è Versicherungsschaden</option>
                        <option value="glas">üîç Glas-Reparatur</option>
                        <option value="klima">‚ùÑÔ∏è Klima-Service</option>
                        <option value="dellen">üî® Dellen-Dr√ºckung</option>
                        <option value="folierung">üåà Auto Folierung</option>
                        <option value="steinschutz">üõ°Ô∏è Steinschutzfolie</option>
                        <option value="werbebeklebung">üì¢ Fahrzeugbeschriftung</option>
                    </select>
                    <small style="color: var(--color-text-tertiary); display: block; margin-top: var(--space-1);">
                        üí° Wichtig f√ºr korrekte Prozess√ºberwachung im Kanban-Board
                    </small>
                </div>

                <!-- üÜï MULTI-SERVICE FEATURE: Zus√§tzliche Services ausw√§hlen -->
                <div id="zusaetzliche-services-container" class="form-group" style="margin-top: var(--space-6); padding: var(--space-6); background: rgba(79, 70, 229, 0.05); border: 2px solid rgba(79, 70, 229, 0.2); border-radius: var(--radius-lg);">
                    <div class="section-title" style="margin: 0 0 var(--space-4) 0;">
                        <i data-feather="plus-circle"></i>
                        Weitere Services hinzuf√ºgen?
                    </div>
                    <small style="color: var(--color-text-secondary); display: block; margin-bottom: var(--space-4);">
                        ‚ú® Neu: Sie k√∂nnen jetzt mehrere Services gleichzeitig buchen (z.B. Lackierung + Reifen-Service)
                    </small>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--space-3);">
                        <!-- Checkboxen werden dynamisch basierend auf Haupt-Service generiert -->
                        <label class="checkbox-card" data-service="lackier">
                            <input type="checkbox" value="lackier" class="additional-service-checkbox">
                            <span class="checkbox-label">üé® Lackierung</span>
                        </label>
                        <label class="checkbox-card" data-service="reifen">
                            <input type="checkbox" value="reifen" class="additional-service-checkbox">
                            <span class="checkbox-label">üîß Reifen-Service</span>
                        </label>
                        <label class="checkbox-card" data-service="mechanik">
                            <input type="checkbox" value="mechanik" class="additional-service-checkbox">
                            <span class="checkbox-label">‚öôÔ∏è Mechanik</span>
                        </label>
                        <label class="checkbox-card" data-service="pflege">
                            <input type="checkbox" value="pflege" class="additional-service-checkbox">
                            <span class="checkbox-label">‚ú® Pflege & Aufbereitung</span>
                        </label>
                        <label class="checkbox-card" data-service="tuev">
                            <input type="checkbox" value="tuev" class="additional-service-checkbox">
                            <span class="checkbox-label">üìã T√úV & Pr√ºfung</span>
                        </label>
                        <label class="checkbox-card" data-service="versicherung">
                            <input type="checkbox" value="versicherung" class="additional-service-checkbox">
                            <span class="checkbox-label">üõ°Ô∏è Versicherungsschaden</span>
                        </label>
                        <label class="checkbox-card" data-service="glas">
                            <input type="checkbox" value="glas" class="additional-service-checkbox">
                            <span class="checkbox-label">üîç Glas-Reparatur</span>
                        </label>
                        <label class="checkbox-card" data-service="klima">
                            <input type="checkbox" value="klima" class="additional-service-checkbox">
                            <span class="checkbox-label">‚ùÑÔ∏è Klima-Service</span>
                        </label>
                        <label class="checkbox-card" data-service="dellen">
                            <input type="checkbox" value="dellen" class="additional-service-checkbox">
                            <span class="checkbox-label">üî® Dellen-Dr√ºckung</span>
                        </label>
                        <label class="checkbox-card" data-service="folierung">
                            <input type="checkbox" value="folierung" class="additional-service-checkbox">
                            <span class="checkbox-label">üåà Auto Folierung</span>
                        </label>
                        <label class="checkbox-card" data-service="steinschutz">
                            <input type="checkbox" value="steinschutz" class="additional-service-checkbox">
                            <span class="checkbox-label">üõ°Ô∏è Steinschutzfolie</span>
                        </label>
                        <label class="checkbox-card" data-service="werbebeklebung">
                            <input type="checkbox" value="werbebeklebung" class="additional-service-checkbox">
                            <span class="checkbox-label">üì¢ Fahrzeugbeschriftung</span>
                        </label>
                    </div>

                    <style>
                        .checkbox-card {
                            display: flex;
                            align-items: center;
                            gap: var(--space-2);
                            padding: var(--space-3);
                            background: var(--color-surface);
                            border: 2px solid var(--color-border);
                            border-radius: var(--radius-md);
                            cursor: pointer;
                            transition: all var(--duration-base) var(--ease-out);
                        }

                        .checkbox-card:hover {
                            border-color: var(--color-primary);
                            transform: translateY(-2px);
                            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.15);
                        }

                        .checkbox-card input[type="checkbox"] {
                            width: 20px;
                            height: 20px;
                            cursor: pointer;
                        }

                        .checkbox-card input[type="checkbox"]:checked + .checkbox-label {
                            font-weight: var(--font-weight-semibold);
                            color: var(--color-primary);
                        }

                        .checkbox-card.disabled {
                            opacity: 0.5;
                            cursor: not-allowed;
                            pointer-events: none;
                        }

                        .checkbox-label {
                            font-size: var(--font-size-sm);
                            color: var(--color-text-primary);
                        }
                    </style>
                </div>

                <!-- ‚ú® SERVICE-SPEZIFISCHE FELDER (dynamisch angezeigt) -->

                <!-- Reifen-Service Felder -->
                <div id="reifen-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Reifen-Service Details
                    </div>

                    <div class="form-group">
                        <label for="reifengroesse" class="form-label">Reifengr√∂√üe</label>
                        <input type="text" id="reifengroesse" class="form-input" placeholder="z.B. 205/55 R16 91V">
                        <small style="color: var(--color-text-tertiary);">Format: Breite/H√∂he Durchmesser Lastindex</small>
                    </div>

                    <div class="form-group">
                        <label for="reifentyp" class="form-label">Reifen-Typ</label>
                        <select id="reifentyp" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="sommer">Sommerreifen</option>
                            <option value="winter">Winterreifen</option>
                            <option value="ganzjahr">Ganzjahresreifen</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="reifenanzahl" class="form-label">Anzahl Reifen</label>
                        <input type="number" id="reifenanzahl" class="form-input" min="1" max="4" value="4">
                    </div>
                </div>

                <!-- Glas-Reparatur Felder -->
                <div id="glas-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Glas-Reparatur Details
                    </div>

                    <div class="form-group">
                        <label for="scheibentyp" class="form-label">Scheiben-Typ</label>
                        <select id="scheibentyp" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="frontscheibe">Frontscheibe</option>
                            <option value="seitenscheibe-vorne-links">Seitenscheibe vorne links</option>
                            <option value="seitenscheibe-vorne-rechts">Seitenscheibe vorne rechts</option>
                            <option value="seitenscheibe-hinten-links">Seitenscheibe hinten links</option>
                            <option value="seitenscheibe-hinten-rechts">Seitenscheibe hinten rechts</option>
                            <option value="heckscheibe">Heckscheibe</option>
                            <option value="schiebedach">Schiebedach</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="schadensgroesse" class="form-label">Schadens-Gr√∂√üe</label>
                        <select id="schadensgroesse" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="steinschlag">Steinschlag (< 2cm) - Reparatur m√∂glich</option>
                            <option value="riss-klein">Kleiner Riss (2-5cm) - Reparatur m√∂glich</option>
                            <option value="riss-mittel">Mittlerer Riss (5-10cm) - Austausch empfohlen</option>
                            <option value="riss-gross">Gro√üer Riss/Bruch (> 10cm) - Austausch n√∂tig</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="glasposition" class="form-label">Position des Schadens</label>
                        <input type="text" id="glasposition" class="form-input" placeholder="z.B. Fahrerseite Mitte, Beifahrerseite oben links">
                    </div>
                </div>

                <!-- Klima-Service Felder -->
                <div id="klima-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Klima-Service Details
                    </div>

                    <div class="form-group">
                        <label for="klimaservice" class="form-label">Service-Art</label>
                        <select id="klimaservice" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="wartung">Wartung & Desinfektion</option>
                            <option value="fuellen">K√§ltemittel auff√ºllen</option>
                            <option value="reparatur">Reparatur (Leckage)</option>
                            <option value="komplett">Kompletter Service-Check</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="kaeltemittel" class="form-label">K√§ltemittel-Typ</label>
                        <select id="kaeltemittel" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="r134a">R134a (Fahrzeuge √§lter 2017)</option>
                            <option value="r1234yf">R1234yf (Fahrzeuge ab 2017)</option>
                            <option value="unbekannt">Unbekannt / Nicht sicher</option>
                        </select>
                        <small style="color: var(--color-text-tertiary);">Ab Erstzulassung 2017 meist R1234yf</small>
                    </div>

                    <div class="form-group">
                        <label for="klimaproblem" class="form-label">Beschreibung des Problems</label>
                        <textarea id="klimaproblem" class="form-input" rows="3" placeholder="z.B. Klimaanlage k√ºhlt nicht mehr, unangenehmer Geruch, Ger√§usche beim Einschalten"></textarea>
                    </div>
                </div>

                <!-- Dellen-Dr√ºckung Felder -->
                <div id="dellen-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Dellen-Dr√ºckung Details
                    </div>

                    <div class="form-group">
                        <label for="dellenanzahl" class="form-label">Anzahl Dellen</label>
                        <input type="number" id="dellenanzahl" class="form-input" min="1" max="20" value="1">
                    </div>

                    <div class="form-group">
                        <label for="dellengroesse" class="form-label">Gr√∂√üte Delle</label>
                        <select id="dellengroesse" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="klein">Klein (< 5cm Durchmesser)</option>
                            <option value="mittel">Mittel (5-10cm Durchmesser)</option>
                            <option value="gross">Gro√ü (> 10cm Durchmesser)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="lackschaden" class="form-label">Lackschaden vorhanden?</label>
                        <select id="lackschaden" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="nein">Nein (nur Delle)</option>
                            <option value="ja">Ja (Delle + Lackschaden)</option>
                        </select>
                        <small style="color: var(--color-text-tertiary);">Bei Lackschaden ist zus√§tzliche Lackierung n√∂tig</small>
                    </div>

                    <div class="form-group">
                        <label for="dellenpositionen" class="form-label">Position(en) der Dellen</label>
                        <textarea id="dellenpositionen" class="form-input" rows="3" placeholder="z.B. Fahrert√ºr Mitte, Kotfl√ºgel rechts, Motorhaube links vorne"></textarea>
                    </div>
                </div>

                <!-- Mechanik-Service Felder -->
                <div id="mechanik-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Mechanik-Service Details
                    </div>

                    <div class="form-group">
                        <label for="mechanik-problem" class="form-label">Problembeschreibung</label>
                        <textarea id="mechanik-problem" class="form-input" rows="4" placeholder="z.B. Motor ruckelt, Bremsen quietschen, Lenkung schwerg√§ngig, Warnleuchte leuchtet..."></textarea>
                        <small style="color: var(--color-text-tertiary);">Bitte so detailliert wie m√∂glich beschreiben</small>
                    </div>

                    <div class="form-group">
                        <label for="mechanik-symptome" class="form-label">Symptome / Wann tritt das Problem auf?</label>
                        <input type="text" id="mechanik-symptome" class="form-input" placeholder="z.B. nur beim Kaltstart, bei hoher Geschwindigkeit, beim Bremsen">
                    </div>
                </div>

                <!-- Versicherung-Service Felder -->
                <div id="versicherung-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Versicherungsschaden Details
                    </div>

                    <div class="form-group">
                        <label for="versicherung-schadensnummer" class="form-label">Schadennummer</label>
                        <input type="text" id="versicherung-schadensnummer" class="form-input" placeholder="z.B. SCH-2024-123456">
                        <small style="color: var(--color-text-tertiary);">Von der Versicherung erhalten</small>
                    </div>

                    <div class="form-group">
                        <label for="versicherung-name" class="form-label">Versicherung</label>
                        <input type="text" id="versicherung-name" class="form-input" placeholder="z.B. Allianz, HUK, Ergo">
                    </div>

                    <div class="form-group">
                        <label for="versicherung-schadendatum" class="form-label">Schadendatum</label>
                        <input type="date" id="versicherung-schadendatum" class="form-input">
                    </div>

                    <div class="form-group">
                        <label for="versicherung-hergang" class="form-label">Unfallhergang / Schadenursache</label>
                        <textarea id="versicherung-hergang" class="form-input" rows="3" placeholder="z.B. Auffahrunfall, Parkrempler, Wildschaden, Hagel..."></textarea>
                    </div>
                </div>

                <!-- Pflege-Service Felder -->
                <div id="pflege-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Fahrzeugpflege Details
                    </div>

                    <div class="form-group">
                        <label for="pflege-paket" class="form-label">Pflege-Paket</label>
                        <select id="pflege-paket" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="basis">Basis (Au√üenw√§sche + Staubsaugen)</option>
                            <option value="premium">Premium (Basis + Innenraumreinigung + Politur)</option>
                            <option value="deluxe">Deluxe (Premium + Motorw√§sche + Unterbodenw√§sche + Versiegelung)</option>
                            <option value="aufbereitung">Komplett-Aufbereitung (Deluxe + Polsterreinigung + Lederpflege)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="pflege-zusatz" class="form-label">Zusatzleistungen</label>
                        <textarea id="pflege-zusatz" class="form-input" rows="2" placeholder="z.B. Polsterreinigung, Lederpflege, Geruchsneutralisierung, Scheinwerfer-Aufbereitung"></textarea>
                    </div>
                </div>

                <!-- T√úV-Service Felder -->
                <div id="tuev-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        T√úV/AU Details
                    </div>

                    <div class="form-group">
                        <label for="tuev-pruefart" class="form-label">Pr√ºfart</label>
                        <select id="tuev-pruefart" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="hu">HU (Hauptuntersuchung)</option>
                            <option value="au">AU (Abgasuntersuchung)</option>
                            <option value="hu-au">HU + AU (Kombi)</option>
                            <option value="nachpruefung">Nachpr√ºfung</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="tuev-faelligkeit" class="form-label">F√§lligkeit T√úV</label>
                        <input type="month" id="tuev-faelligkeit" class="form-input">
                        <small style="color: var(--color-text-tertiary);">Steht im Fahrzeugschein und auf T√úV-Plakette</small>
                    </div>

                    <div class="form-group">
                        <label for="tuev-maengel" class="form-label">Bekannte M√§ngel (optional)</label>
                        <textarea id="tuev-maengel" class="form-input" rows="2" placeholder="z.B. Beleuchtung defekt, Reifen abgefahren, Rost am Schweller"></textarea>
                    </div>
                </div>

                <!-- Auto Folierung Felder -->
                <div id="folierung-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Auto Folierung Details
                    </div>

                    <div class="form-group">
                        <label for="folierungArt" class="form-label">Art der Folierung <span class="required">*</span></label>
                        <select id="folierungArt" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="vollfolierung">üé® Vollfolierung (gesamtes Fahrzeug)</option>
                            <option value="teilfolierung">‚úÇÔ∏è Teilfolierung (bestimmte Teile)</option>
                            <option value="akzente">‚≠ê Akzente (Streifen, Logos)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="folierungMaterial" class="form-label">Materialqualit√§t <span class="required">*</span></label>
                        <select id="folierungMaterial" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="standard">üì¶ Standard (3-5 Jahre)</option>
                            <option value="premium">üíé Premium (5-7 Jahre)</option>
                            <option value="spezial">üåü Spezialfolie (Chrome, Carbon, Matt)</option>
                        </select>
                    </div>

                    <!-- Spezialfolientyp (nur wenn Material = 'spezial') -->
                    <div class="form-group" id="folierungSpezialTypGroup" style="display: none;">
                        <label for="folierungSpezialTyp" class="form-label">Spezialfolientyp <span class="required">*</span></label>
                        <select id="folierungSpezialTyp" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="chrome">‚ú® Chrome</option>
                            <option value="matt">üé≠ Matt</option>
                            <option value="hochglanz">üíé Hochglanz</option>
                            <option value="carbon">üèÅ Carbon</option>
                            <option value="brushed-metal">üîß Brushed Metal</option>
                        </select>
                    </div>

                    <!-- Bereiche (nur wenn Art != 'vollfolierung') -->
                    <div class="form-group" id="folierungBereicheGroup" style="display: none;">
                        <label class="form-label">Zu folierende Bereiche <span class="required">*</span></label>
                        <div class="checkbox-group" style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px;">
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="motorhaube"> Motorhaube
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="dach"> Dach
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="seitenspiegel"> Seitenspiegel
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="heckklappe"> Heckklappe
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="kotfluegel"> Kotfl√ºgel
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="spoiler"> Spoiler
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="tueren"> T√ºren
                            </label>
                            <label style="display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" name="folierungBereiche" value="seitenwand"> Seitenwand
                            </label>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="folierungFarbe" class="form-label">Farbauswahl <span class="required">*</span></label>
                        <input type="text" id="folierungFarbe" class="form-input" placeholder="z.B. Schwarz Matt, Blau Metallic, Rot Hochglanz">
                    </div>

                    <div class="form-group">
                        <label for="folierungDesign" class="form-label">Design-Vorstellungen</label>
                        <textarea id="folierungDesign" class="form-input" rows="3" placeholder="Muster, Streifen, Logos, etc."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="folierungInfo" class="form-label">Zus√§tzliche Informationen</label>
                        <textarea id="folierungInfo" class="form-input" rows="2" placeholder="Besondere Anforderungen, Zeitrahmen..."></textarea>
                    </div>
                </div>

                <!-- Steinschutzfolie Felder -->
                <div id="steinschutz-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Steinschutzfolie Details
                    </div>

                    <div class="form-group">
                        <label for="steinschutzUmfang" class="form-label">Schutzumfang <span class="required">*</span></label>
                        <select id="steinschutzUmfang" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="premium">üõ°Ô∏è Premium-Paket (Komplettschutz)</option>
                            <option value="standard">üì¶ Standard-Paket (Front, Motorhaube, Spiegel)</option>
                            <option value="minimal">‚ö° Minimal-Paket (nur Front)</option>
                            <option value="individuell">üéØ Individuell (Bereiche ausw√§hlen)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="steinschutzMaterial" class="form-label">Materialqualit√§t <span class="required">*</span></label>
                        <select id="steinschutzMaterial" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="standard">üì¶ Standard PPF (5 Jahre)</option>
                            <option value="premium">üíé Premium PPF (7 Jahre)</option>
                            <option value="self-healing">üîÑ Self-Healing (10 Jahre)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="steinschutzBereiche" class="form-label">Zu sch√ºtzende Bereiche</label>
                        <textarea id="steinschutzBereiche" class="form-input" rows="2" placeholder="z.B. Front-Sto√üstange, Motorhaube, Kotfl√ºgel, Spiegel..."></textarea>
                        <small style="color: var(--color-text-tertiary);">Nur bei individueller Auswahl</small>
                    </div>

                    <div class="form-group">
                        <label for="steinschutzInfo" class="form-label">Zus√§tzliche Informationen</label>
                        <textarea id="steinschutzInfo" class="form-input" rows="2" placeholder="Besondere Anforderungen, vorhandene Lacksch√§den..."></textarea>
                    </div>
                </div>

                <!-- Fahrzeugbeschriftung Felder -->
                <div id="werbebeklebung-felder" class="service-felder" style="display:none;">
                    <div class="section-title" style="margin-top: var(--space-4);">
                        <i data-feather="circle"></i>
                        Fahrzeugbeschriftung Details
                    </div>

                    <div class="form-group">
                        <label for="werbebeklebungUmfang" class="form-label">Umfang der Beklebung <span class="required">*</span></label>
                        <select id="werbebeklebungUmfang" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="vollbeklebung">üöö Vollbeklebung (alle Seiten)</option>
                            <option value="teilbeklebung">‚úÇÔ∏è Teilbeklebung (bestimmte Bereiche)</option>
                            <option value="logo-only">üè∑Ô∏è Nur Logo</option>
                            <option value="schriftzug">‚úçÔ∏è Schriftzug</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="werbebeklebungKomplexitaet" class="form-label">Design-Komplexit√§t <span class="required">*</span></label>
                        <select id="werbebeklebungKomplexitaet" class="form-select">
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="einfach">üìù Einfach (Text + Logo, 1-2 Farben)</option>
                            <option value="mittel">üé® Mittel (Logo + Text + Grafiken, 3-5 Farben)</option>
                            <option value="komplex">üåà Komplex (Vollfl√§chiges Design, 6+ Farben)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="werbebeklebungText" class="form-label">Textelemente <span class="required">*</span></label>
                        <textarea id="werbebeklebungText" class="form-input" rows="3" placeholder="Firmenname, Slogan, Kontaktdaten (Telefon, Website, E-Mail)..."></textarea>
                        <small style="color: var(--color-text-tertiary);">Alle Texte, die auf dem Fahrzeug erscheinen sollen</small>
                    </div>

                    <div class="form-group">
                        <label for="werbebeklebungFarbanzahl" class="form-label">Anzahl Farben</label>
                        <input type="number" id="werbebeklebungFarbanzahl" class="form-input" min="1" max="10" value="2" placeholder="Anzahl der verwendeten Farben">
                    </div>

                    <div class="form-group">
                        <label for="werbebeklebungInfo" class="form-label">Zus√§tzliche Informationen</label>
                        <textarea id="werbebeklebungInfo" class="form-input" rows="2" placeholder="Besondere W√ºnsche, Zeitrahmen, Referenzbilder..."></textarea>
                    </div>
                </div>

                <!-- ABHOLUNG -->
                <div class="section-title">
                    <i data-feather="truck"></i>
                    Fahrzeug-Abholung
                </div>

                <div class="form-group">
                    <label class="form-label">Fahrzeug abholen?</label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="fahrzeugAbholung" value="nein" checked onchange="toggleAbholungDetails()">
                            <span>Nein, Kunde bringt Fahrzeug selbst</span>
                        </label>
                        <label>
                            <input type="radio" name="fahrzeugAbholung" value="ja" onchange="toggleAbholungDetails()">
                            <span>Ja, Fahrzeug abholen</span>
                        </label>
                    </div>
                </div>

                <!-- Conditional Fields -->
                <div id="abholungDetails" style="display: none;">
                    <div class="form-group">
                        <label for="abholadresse" class="form-label">Abholadresse <span class="required">*</span></label>
                        <textarea id="abholadresse" class="form-textarea" placeholder="Stra√üe, Hausnummer&#10;PLZ, Ort" rows="3"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="abholdatum" class="form-label">Gew√ºnschtes Abholdatum</label>
                            <input type="date" id="abholdatum" class="form-input">
                        </div>

                        <div class="form-group">
                            <label for="abholzeit" class="form-label">Gew√ºnschte Abholzeit</label>
                            <input type="time" id="abholzeit" class="form-input">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="abholnotiz" class="form-label">Notiz zur Abholung (optional)</label>
                        <textarea id="abholnotiz" class="form-textarea" placeholder="z.B. Zufahrt, Besonderheiten, Ansprechpartner" rows="2"></textarea>
                    </div>
                </div>

                <!-- ERSATZFAHRZEUG -->
                <div class="section-title">
                    <i data-feather="refresh-cw"></i>
                    Ersatzfahrzeug
                </div>

                <div class="form-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="ersatzfahrzeugGewuenscht" name="ersatzfahrzeugGewuenscht">
                        <span>Kunde ben√∂tigt Ersatzfahrzeug</span>
                    </label>
                </div>

                <!-- üîß ENTFERNT (2025-11-27): √úbergabeadresse war redundant mit Abholadresse -->
                <!-- Ersatzfahrzeug-√úbergabe = Abholadresse (wenn Abholung) oder Werkstatt -->

                <!-- FAHRZEUGDATEN -->
                <div id="fahrzeugdaten-section" class="section-title">
                    <i data-feather="truck"></i>
                    Fahrzeugdaten
                </div>

                <!-- PDF-UPLOAD SECTION -->
                <div class="form-group" style="background: var(--color-bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <label class="form-label">
                        üìÑ DAT-Kalkulation hochladen (optional)
                        <span style="color: var(--color-text-tertiary); font-size: 12px; font-weight: normal; display: block; margin-top: 4px;">
                            Fahrzeugdaten werden automatisch ausgef√ºllt
                        </span>
                    </label>
                    <div class="pdf-upload-container" style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                        <button type="button" class="btn btn-secondary" style="font-size: 14px;"
                                onclick="document.getElementById('datPdfInput').click()">
                            üìÑ PDF ausw√§hlen
                        </button>
                        <input type="file" id="datPdfInput" accept="application/pdf" style="display: none;">
                        <span id="pdfFileName" class="pdf-filename" style="color: var(--color-success); font-size: 14px; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"></span>
                        <button type="button" id="pdfRemoveBtn" class="btn-icon-small"
                                style="display: none; background: transparent; border: none; cursor: pointer; font-size: 18px;"
                                onclick="removePdf()">‚ùå</button>
                    </div>
                </div>

                <!-- TEXT-PARSING SECTION -->
                <div class="form-group" style="background: var(--color-bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <label class="form-label">
                        üìã Oder: DAT-Auftrag Text einf√ºgen
                        <span style="color: var(--color-text-tertiary); font-size: 12px; font-weight: normal; display: block; margin-top: 4px;">
                            Kopiere den kompletten DAT-Kostenvoranschlag und klicke auf "Text auslesen"
                        </span>
                    </label>
                    <textarea id="datTextInput"
                              placeholder="F√ºge hier den DAT-Auftrag Text ein (Ersatzteile, Arbeitslohn, Lackierung)..."
                              style="
                                  width: 100%;
                                  min-height: 150px;
                                  padding: 12px;
                                  border: 2px solid var(--color-border);
                                  border-radius: 8px;
                                  background: var(--color-surface);
                                  color: var(--color-text-primary);
                                  font-family: 'Courier New', monospace;
                                  font-size: 12px;
                                  resize: vertical;
                                  margin-top: 10px;
                                  white-space: pre-wrap;
                                  word-break: break-all;
                                  overflow-wrap: anywhere;
                                  tab-size: 4;
                              "></textarea>
                    <script>
                    // FIX #1: Paste Event Sanitization (2025-11-11)
                    // Bereinigt Copy-Paste von Word/Excel/PDF
                    document.getElementById('datTextInput').addEventListener('paste', (e) => {
                        e.preventDefault();
                        const text = (e.clipboardData || window.clipboardData).getData('text/plain');

                        // Normalisierung
                        const cleaned = text
                            .replace(/\r\n/g, '\n')     // Windows ‚Üí Unix line endings
                            .replace(/\r/g, '\n')       // Old Mac ‚Üí Unix
                            .replace(/\u00a0/g, ' ')    // Non-breaking space ‚Üí regular
                            .replace(/\u2009/g, ' ')    // Thin space ‚Üí regular
                            .replace(/\u202F/g, ' ')    // Narrow no-break space ‚Üí regular
                            .replace(/\t/g, '    ')     // Tab ‚Üí 4 spaces
                            .replace(/[""]/g, '"')      // Smart quotes ‚Üí regular
                            .replace(/['']/g, "'");     // Smart apostrophes ‚Üí regular

                        document.execCommand('insertText', false, cleaned);

                        // Visual Feedback
                        if (window.showToast) {
                            showToast('‚úÖ Text eingef√ºgt und bereinigt', 'success');
                        }
                        const textarea = document.getElementById('datTextInput');
                        textarea.style.borderColor = 'var(--color-success)';
                        setTimeout(() => {
                            textarea.style.borderColor = '';
                        }, 2000);
                    });
                    </script>
                    <div style="display: flex; align-items: center; gap: 10px; margin-top: 10px;">
                        <button type="button" id="parseTextBtn" class="btn btn-primary" style="font-size: 14px;" onclick="handleTextParsing()">
                            üîç Text auslesen
                        </button>
                        <span id="textParseStatus" style="color: var(--color-success); font-size: 14px;"></span>
                        <button type="button" id="clearTextBtn" class="btn-icon-small"
                                style="display: none; background: transparent; border: none; cursor: pointer; font-size: 18px;"
                                onclick="clearDatText()">‚ùå</button>
                    </div>

                    <!-- ERSATZTEILE TABELLE (Permanent, Editierbar) -->
                    <div id="ersatzteileSection" style="margin-top: 20px; padding: 15px; background: rgba(79, 172, 254, 0.1); border-radius: 8px; border-left: 4px solid var(--color-primary);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="color: var(--color-primary); font-size: 16px; margin: 0; display: flex; align-items: center; gap: 8px;">
                                <svg data-feather="package" style="width: 20px; height: 20px;"></svg>
                                <span>Ersatzteile (<span id="ersatzteileCount">0</span>)</span>
                            </h4>
                            <button type="button" id="addErsatzteilBtn" onclick="addErsatzteilRow()" style="padding: 6px 12px; background: var(--color-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 12px; display: flex; align-items: center; gap: 4px;">
                                <svg data-feather="plus" style="width: 14px; height: 14px;"></svg>
                                Zeile hinzuf√ºgen
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="ersatzteileTable" style="width: 100%; border-collapse: collapse; font-size: 13px;">
                                <thead>
                                    <tr style="background: rgba(0,0,0,0.1); text-align: left;">
                                        <th style="padding: 8px; border-bottom: 2px solid var(--color-primary); width: 120px;">ETN</th>
                                        <th style="padding: 8px; border-bottom: 2px solid var(--color-primary);">Benennung</th>
                                        <th style="padding: 8px; border-bottom: 2px solid var(--color-primary); text-align: center; width: 80px;">Anzahl</th>
                                        <th style="padding: 8px; border-bottom: 2px solid var(--color-primary); text-align: right; width: 100px;">Einzelpreis</th>
                                        <th style="padding: 8px; border-bottom: 2px solid var(--color-primary); text-align: right; width: 100px;">Gesamtpreis</th>
                                        <th style="padding: 8px; border-bottom: 2px solid var(--color-primary); text-align: center; width: 60px;">Aktion</th>
                                    </tr>
                                </thead>
                                <tbody id="ersatzteileTableBody">
                                    <!-- Dynamisch gef√ºllt - Zeilen werden durch JavaScript hinzugef√ºgt -->
                                </tbody>
                                <tfoot style="background: rgba(79, 172, 254, 0.1); font-weight: 600;">
                                    <tr>
                                        <td colspan="4" style="padding: 8px; text-align: right;">SUMME:</td>
                                        <td style="padding: 8px; text-align: right; color: var(--color-primary);" id="ersatzteileSumme">0.00 ‚Ç¨</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                        <p style="font-size: 11px; color: var(--color-text-secondary); margin-top: 10px; font-style: italic;">
                            üí° Tipp: PDF hochladen bef√ºllt die Tabelle automatisch. Oder manuell Zeilen hinzuf√ºgen mit dem "+ Zeile hinzuf√ºgen" Button.
                        </p>
                    </div>

                    <!-- ARBEITSLOHN TABELLE (Permanent, Editierbar) -->
                    <div id="arbeitslohnSection" style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px; border-left: 4px solid #4caf50;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                            <h4 style="color: #4caf50; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                                <svg data-feather="clock" style="width: 20px; height: 20px;"></svg>
                                Arbeitslohn (<span id="arbeitslohnCount">0</span>)
                            </h4>
                            <button type="button" id="addArbeitslohnBtn" onclick="addArbeitslohnRow()" style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; background: #4caf50; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;">
                                <svg data-feather="plus" style="width: 16px; height: 16px;"></svg>
                                Zeile hinzuf√ºgen
                            </button>
                        </div>
                        <div style="overflow-x: auto;">
                            <table id="arbeitslohnTable" style="width: 100%; border-collapse: collapse; font-size: 13px; background: white; border-radius: 4px; overflow: hidden;">
                                <thead>
                                    <tr style="background: rgba(76, 175, 80, 0.1); text-align: left;">
                                        <th style="padding: 8px; border-bottom: 2px solid #4caf50;">Position</th>
                                        <th style="padding: 8px; border-bottom: 2px solid #4caf50; text-align: center;">Art</th>
                                        <th style="padding: 8px; border-bottom: 2px solid #4caf50; text-align: right;">Stunden</th>
                                        <th style="padding: 8px; border-bottom: 2px solid #4caf50; text-align: right;">Stundensatz</th>
                                        <th style="padding: 8px; border-bottom: 2px solid #4caf50; text-align: right;">Gesamtpreis</th>
                                        <th style="padding: 8px; border-bottom: 2px solid #4caf50; text-align: center; width: 60px;">Aktion</th>
                                    </tr>
                                </thead>
                                <tbody id="arbeitslohnTableBody">
                                    <!-- Dynamisch gef√ºllt -->
                                </tbody>
                                <tfoot style="background: rgba(76, 175, 80, 0.1); font-weight: 600;">
                                    <tr>
                                        <td colspan="4" style="padding: 8px; text-align: right;">SUMME:</td>
                                        <td style="padding: 8px; text-align: right; color: #4caf50;" id="arbeitslohnTotal">0.00 ‚Ç¨</td>
                                        <td></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- LACKIERUNG TABELLE (Permanent, Editierbar) -->
                <div id="lackierungSection" style="margin-top: 20px; padding: 15px; background: rgba(156, 39, 176, 0.1); border-radius: 8px; border-left: 4px solid #9c27b0;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4 style="color: #9c27b0; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                            <svg data-feather="droplet" style="width: 20px; height: 20px;"></svg>
                            Lackierung (<span id="lackierungCount">0</span>)
                        </h4>
                        <button type="button" id="addLackierungBtn" onclick="addLackierungRow()" style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; background: #9c27b0; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;">
                            <svg data-feather="plus" style="width: 16px; height: 16px;"></svg>
                            Zeile hinzuf√ºgen
                        </button>
                    </div>
                    <table id="lackierungTable" style="width: 100%; border-collapse: collapse; font-size: 13px; background: white; border-radius: 4px; overflow: hidden;">
                        <thead style="background: rgba(156, 39, 176, 0.1);">
                            <tr>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #9c27b0;">Position</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #9c27b0;">Bereich</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #9c27b0;">Stunden</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #9c27b0;">Stundensatz</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #9c27b0;">Gesamtpreis</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #9c27b0; width: 60px;">Aktion</th>
                            </tr>
                        </thead>
                        <tbody id="lackierungTableBody"></tbody>
                        <tfoot style="background: rgba(156, 39, 176, 0.15); font-weight: bold;">
                            <tr>
                                <td colspan="4" style="padding: 10px; text-align: right; border-top: 2px solid #9c27b0;">SUMME:</td>
                                <td id="lackierungTotal" style="padding: 10px; text-align: right; color: #9c27b0; font-size: 1.1em; border-top: 2px solid #9c27b0;">0.00 ‚Ç¨</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- MATERIALIEN TABELLE (Permanent, Editierbar) -->
                <div id="materialienSection" style="margin-top: 20px; padding: 15px; background: rgba(255, 152, 0, 0.1); border-radius: 8px; border-left: 4px solid #ff9800;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                        <h4 style="color: #ff9800; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                            <svg data-feather="package" style="width: 20px; height: 20px;"></svg>
                            Materialien (<span id="materialienCount">0</span>)
                        </h4>
                        <button type="button" id="addMaterialienBtn" onclick="addMaterialienRow()" style="display: flex; align-items: center; gap: 6px; padding: 8px 14px; background: #ff9800; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: 500; transition: all 0.2s;">
                            <svg data-feather="plus" style="width: 16px; height: 16px;"></svg>
                            Material hinzuf√ºgen
                        </button>
                    </div>
                    <table id="materialienTable" style="width: 100%; border-collapse: collapse; font-size: 13px; background: white; border-radius: 4px; overflow: hidden;">
                        <thead style="background: rgba(255, 152, 0, 0.1);">
                            <tr>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ff9800;">Material-Typ</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ff9800;">Menge</th>
                                <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ff9800;">Einheit</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ff9800;">Einheitspreis (‚Ç¨)</th>
                                <th style="padding: 10px; text-align: right; border-bottom: 2px solid #ff9800;">Gesamtpreis</th>
                                <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ff9800; width: 60px;">Aktion</th>
                            </tr>
                        </thead>
                        <tbody id="materialienTableBody"></tbody>
                        <tfoot style="background: rgba(255, 152, 0, 0.15); font-weight: bold;">
                            <tr>
                                <td colspan="4" style="padding: 10px; text-align: right; border-top: 2px solid #ff9800;">SUMME:</td>
                                <td id="materialienTotal" style="padding: 10px; text-align: right; color: #ff9800; font-size: 1.1em; border-top: 2px solid #ff9800;">0.00 ‚Ç¨</td>
                                <td></td>
                            </tr>
                        </tfoot>
                    </table>
                </div>

                <!-- GESAMTSUMME (GRAND TOTAL) -->
                <div id="gesamtsummePreview" style="display: none; margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.15)); border-radius: 12px; border: 3px solid #ffa500; box-shadow: 0 4px 12px rgba(255, 165, 0, 0.2);">
                    <h3 style="color: #ff8c00; margin: 0 0 15px 0; display: flex; align-items: center; gap: 10px;">
                        <svg data-feather="dollar-sign" style="width: 24px; height: 24px;"></svg>
                        KOSTEN√úBERSICHT - GESAMTSUMME
                    </h3>
                    <div style="background: white; border-radius: 8px; padding: 15px;">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tbody>
                                <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                    <td style="padding: 8px; color: #666;">Ersatzteile:</td>
                                    <td id="summeErsatzteile" style="padding: 8px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600; color: var(--color-primary);">0.00 ‚Ç¨</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                    <td style="padding: 8px; color: #666;">Arbeitslohn:</td>
                                    <td id="summeArbeitslohn" style="padding: 8px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600; color: #4caf50;">0.00 ‚Ç¨</td>
                                </tr>
                                <tr style="border-bottom: 1px solid rgba(0,0,0,0.1);">
                                    <td style="padding: 8px; color: #666;">Lackierung:</td>
                                    <td id="summeLackierung" style="padding: 8px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600; color: #9c27b0;">0.00 ‚Ç¨</td>
                                </tr>
                                <tr style="border-bottom: 2px solid #ffa500;">
                                    <td style="padding: 8px; color: #666;">Materialien:</td>
                                    <td id="summeMaterialien" style="padding: 8px; text-align: right; font-family: 'Courier New', monospace; font-weight: 600; color: #ff9800;">0.00 ‚Ç¨</td>
                                </tr>
                                <tr style="background: rgba(255, 165, 0, 0.1);">
                                    <td style="padding: 12px; font-size: 1.2em; font-weight: bold; color: #ff8c00;">
                                        <svg data-feather="star" style="width: 18px; height: 18px; vertical-align: middle; margin-right: 5px; fill: #ffa500;"></svg>
                                        GESAMTPREIS:
                                    </td>
                                    <td id="gesamtpreis" style="padding: 12px; text-align: right; font-family: 'Courier New', monospace; font-size: 1.3em; font-weight: bold; color: #ff8c00;">0.00 ‚Ç¨</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="marke" class="form-label">Marke <span class="required">*</span></label>
                        <select id="marke" class="form-select" required>
                            <option value="">-- Bitte w√§hlen --</option>
                            <option value="Audi">Audi</option>
                            <option value="BMW">BMW</option>
                            <option value="Citroen">Citroen</option>
                            <option value="Cupra">Cupra</option>
                            <option value="Fiat">Fiat</option>
                            <option value="Ford">Ford</option>
                            <option value="Honda">Honda</option>
                            <option value="Hyundai">Hyundai</option>
                            <option value="Kia">Kia</option>
                            <option value="Mazda">Mazda</option>
                            <option value="Mercedes-Benz">Mercedes-Benz</option>
                            <option value="MINI">MINI</option>
                            <option value="Nissan">Nissan</option>
                            <option value="Opel">Opel</option>
                            <option value="Peugeot">Peugeot</option>
                            <option value="Porsche">Porsche</option>
                            <option value="Renault">Renault</option>
                            <option value="Seat">Seat</option>
                            <option value="Skoda">Skoda</option>
                            <option value="Suzuki">Suzuki</option>
                            <option value="Toyota">Toyota</option>
                            <option value="Volkswagen">Volkswagen</option>
                            <option value="Volvo">Volvo</option>
                            <option value="Sonstige">Sonstige</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="modell" class="form-label">Modell <span class="required">*</span></label>
                        <input type="text" id="modell" class="form-input" placeholder="z.B. Golf 8, A4, 3er" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Baujahr</label>
                        <div style="display: flex; gap: var(--space-2); align-items: center;">
                            <select id="baujahrVon" class="form-select" style="flex: 1;">
                                <option value="">Von</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                                <option value="2017">2017</option>
                                <option value="2016">2016</option>
                                <option value="2015">2015</option>
                                <option value="2014">2014</option>
                                <option value="2013">2013</option>
                                <option value="2012">2012</option>
                                <option value="2011">2011</option>
                                <option value="2010">2010</option>
                                <option value="2009">2009</option>
                                <option value="2008">2008</option>
                                <option value="2007">2007</option>
                                <option value="2006">2006</option>
                                <option value="2005">2005</option>
                                <option value="2004">2004</option>
                                <option value="2003">2003</option>
                                <option value="2002">2002</option>
                                <option value="2001">2001</option>
                                <option value="2000">2000</option>
                                <option value="√Ñlter">√Ñlter als 2000</option>
                            </select>
                            <span style="font-weight: 600; color: var(--color-text-secondary);">-</span>
                            <select id="baujahrBis" class="form-select" style="flex: 1;">
                                <option value="">Bis</option>
                                <option value="2025">2025</option>
                                <option value="2024">2024</option>
                                <option value="2023">2023</option>
                                <option value="2022">2022</option>
                                <option value="2021">2021</option>
                                <option value="2020">2020</option>
                                <option value="2019">2019</option>
                                <option value="2018">2018</option>
                                <option value="2017">2017</option>
                                <option value="2016">2016</option>
                                <option value="2015">2015</option>
                                <option value="2014">2014</option>
                                <option value="2013">2013</option>
                                <option value="2012">2012</option>
                                <option value="2011">2011</option>
                                <option value="2010">2010</option>
                                <option value="2009">2009</option>
                                <option value="2008">2008</option>
                                <option value="2007">2007</option>
                                <option value="2006">2006</option>
                                <option value="2005">2005</option>
                                <option value="2004">2004</option>
                                <option value="2003">2003</option>
                                <option value="2002">2002</option>
                                <option value="2001">2001</option>
                                <option value="2000">2000</option>
                                <option value="√Ñlter">√Ñlter als 2000</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="kmstand" class="form-label">KM-Stand</label>
                        <input type="number" id="kmstand" class="form-input" placeholder="z.B. 45000">
                    </div>
                </div>

                <div class="form-group">
                    <label for="vin" class="form-label">VIN/FIN (optional)</label>
                    <input type="text" id="vin" class="form-input" placeholder="Fahrgestellnummer">
                </div>

                <!-- LACKIER-INFORMATIONEN (nur f√ºr Lackierung & Alle Services) -->
                <div id="lackierung-felder" class="service-felder" style="display:none;">
                    <div class="section-title">
                        <i data-feather="droplet"></i>
                        Lackier-Informationen
                    </div>

                    <div class="form-group">
                        <label for="farbname" class="form-label">Farbname</label>
                        <input type="text" id="farbname" class="form-input" placeholder="z.B. Silber Metallic, Tiefes Schwarz Perleffekt">
                    </div>

                    <div class="form-group">
                        <label for="farbvariante" class="form-label">üî¨ Farbvariante (f√ºr Lackierer)</label>
                        <input type="text" id="farbvariante" class="form-input" list="farbvarianten-liste" placeholder="z.B. Variante A, Mischung 1, Hell abget√∂nt">
                        <datalist id="farbvarianten-liste">
                            <option value="Standard">
                            <option value="Variante A">
                            <option value="Variante B">
                            <option value="Variante C">
                            <option value="Mischung 1">
                            <option value="Mischung 2">
                            <option value="Hell abget√∂nt">
                            <option value="Dunkel abget√∂nt">
                            <option value="Metallic-Effekt">
                            <option value="Matt-Finish">
                        </datalist>
                        <small style="color: var(--color-text-tertiary); font-size: var(--font-size-xs); display: block; margin-top: var(--space-1);">
                            üí° Notiz f√ºr Lackierer: Welche Mischvariante wurde verwendet?
                        </small>
                    </div>

                    <div class="form-group highlight">
                        <label for="farbnummer" class="form-label">üé® FARBNUMMER / FARBCODE <span class="required">*</span></label>
                        <input type="text" id="farbnummer" class="form-input" placeholder="z.B. LC9Z, C7A, A96, LY9B" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Lackart <span class="required">*</span></label>
                        <div class="radio-group">
                            <label>
                                <input type="radio" name="lackart" value="Uni" required>
                                <span>Uni / Solid</span>
                            </label>
                            <label>
                                <input type="radio" name="lackart" value="Metallic" checked>
                                <span>Metallic</span>
                            </label>
                            <label>
                                <input type="radio" name="lackart" value="Perleffekt">
                                <span>Perleffekt</span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- FOTOS -->
                <div class="section-title">
                    <i data-feather="camera"></i>
                    Fotos
                </div>

                <div id="photo-section" class="photo-section">
                    <label class="form-label">Schadensfotos (min. 1 Foto erforderlich)</label>
                    <div class="photo-grid" id="photoGrid">
                        <div class="photo-item empty" onclick="document.getElementById('photoInput').click()">
                            <i data-feather="camera"></i>
                            <span>Foto hinzuf√ºgen</span>
                        </div>
                    </div>
                    <input type="file" id="photoInput" accept="image/*" capture="environment" multiple>
                </div>

                <!-- NOTIZEN -->
                <div id="notizen-section" class="section-title">
                    <i data-feather="file-text"></i>
                    Schadensbeschreibung & Preis
                </div>

                <div class="form-group">
                    <label for="notizen" class="form-label">Notizen / Schadensbeschreibung</label>
                    <textarea id="notizen" class="form-textarea" placeholder="z.B. Delle an linker T√ºr, Kratzer am Kotfl√ºgel hinten rechts..."></textarea>
                </div>

                <!-- KOSTENAUFSCHL√úSSELUNG F√úR BUCHHALTUNG/STEUERBERATER -->
                <div id="kostenAufschluesselungSection" style="margin-top: 20px; padding: 20px; background: rgba(79, 172, 254, 0.05); border-radius: 8px; border-left: 4px solid var(--color-primary);">
                    <h4 style="display: flex; align-items: center; gap: 8px; margin-bottom: 15px; color: var(--color-text-primary);">
                        <svg data-feather="pie-chart" style="width: 20px; height: 20px;"></svg>
                        Kostenaufschl√ºsselung (f√ºr Buchhaltung/Steuerberater)
                    </h4>
                    <p style="font-size: 0.9em; color: var(--color-text-secondary); margin-bottom: 15px;">
                        Diese Werte werden automatisch aus dem DAT-PDF √ºbernommen und k√∂nnen bei Bedarf angepasst werden.
                    </p>

                    <!-- Netto-Positionen -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                        <div class="form-group">
                            <label for="kostenErsatzteile" class="form-label">üîß Ersatzteile (Netto)</label>
                            <input type="number" id="kostenErsatzteile" class="form-input" placeholder="0.00" step="0.01" min="0" readonly style="background: #f5f5f5;">
                            <small style="color: var(--color-text-tertiary);">Materialkosten</small>
                        </div>

                        <div class="form-group">
                            <label for="kostenArbeitslohn" class="form-label">üë∑ Arbeitslohn (Netto)</label>
                            <input type="number" id="kostenArbeitslohn" class="form-input" placeholder="0.00" step="0.01" min="0" readonly style="background: #f5f5f5;">
                            <small style="color: var(--color-text-tertiary);">Personalkosten</small>
                        </div>

                        <div class="form-group">
                            <label for="kostenLackierung" class="form-label">üé® Lackierung (Netto)</label>
                            <input type="number" id="kostenLackierung" class="form-input" placeholder="0.00" step="0.01" min="0" readonly style="background: #f5f5f5;">
                            <small style="color: var(--color-text-tertiary);">Lackierarbeiten</small>
                        </div>

                        <div class="form-group">
                            <label for="kostenMaterialien" class="form-label">üì¶ Materialien (Netto)</label>
                            <input type="number" id="kostenMaterialien" class="form-input" placeholder="0.00" step="0.01" min="0" readonly style="background: #f5f5f5;">
                            <small style="color: var(--color-text-tertiary);">Folien, Pflegeprodukte, etc.</small>
                        </div>
                    </div>

                    <!-- Netto-Summe -->
                    <div style="padding: 15px; background: rgba(255,255,255,0.8); border-radius: 6px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong style="font-size: 1.1em;">Summe Netto:</strong>
                            <input type="number" id="summeNetto" readonly style="background: transparent; border: none; text-align: right; font-size: 1.2em; font-weight: bold; color: var(--color-primary); width: 150px; padding: 0;">
                        </div>
                    </div>

                    <!-- MwSt-Berechnung -->
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label for="mwstSatz" class="form-label">üìä MwSt-Satz</label>
                            <select id="mwstSatz" class="form-input">
                                <option value="19">19% (Standard)</option>
                                <option value="7">7% (erm√§√üigt)</option>
                                <option value="0">0% (befreit)</option>
                            </select>
                            <small style="color: var(--color-text-tertiary);">Standard: 19%</small>
                        </div>

                        <div class="form-group">
                            <label for="mwstBetrag" class="form-label">üí∂ MwSt-Betrag</label>
                            <input type="number" id="mwstBetrag" class="form-input" placeholder="0.00" readonly style="background: #f5f5f5; font-weight: 600;">
                            <small style="color: var(--color-text-tertiary);">Automatisch berechnet</small>
                        </div>
                    </div>

                    <!-- Brutto-Summe (= Vereinbarter Preis) -->
                    <div style="padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 8px; color: white;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <strong style="font-size: 1.2em;">Summe Brutto (inkl. MwSt):</strong>
                            <span id="summeBrutto" style="font-size: 1.5em; font-weight: bold;">0.00 ‚Ç¨</span>
                        </div>
                        <small style="opacity: 0.9;">= Vereinbarter Preis</small>
                    </div>

                    <!-- Edit Button -->
                    <button type="button" id="btnEditKosten" style="margin-top: 15px; padding: 10px 20px; background: var(--color-primary); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.9em; display: flex; align-items: center; gap: 8px;">
                        <svg data-feather="edit-3" style="width: 16px; height: 16px;"></svg>
                        Werte manuell bearbeiten
                    </button>
                </div>

                <!-- VEREINBARTER PREIS (HYBRID: AUTO + MANUAL OVERRIDE) -->
                <div class="form-group" style="margin-top: 25px; padding: 20px; background: linear-gradient(135deg, rgba(255, 215, 0, 0.1), rgba(255, 165, 0, 0.1)); border-radius: 12px; border: 3px solid #ffa500;">
                    <label for="vereinbarterPreis" class="form-label" style="font-size: 1.2em; color: #ff8c00; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        üí∞ Vereinbarter Preis (Brutto) <span class="required">*</span>
                    </label>

                    <div style="display: flex; gap: 15px; align-items: center; margin-top: 10px;">
                        <input type="number" id="vereinbarterPreis" class="form-input" placeholder="0.00" step="0.01" min="0.01" required readonly
                               style="flex: 1; font-size: 1.5em; font-weight: bold; background: #f0f8ff; border: 2px solid var(--color-primary); text-align: right; padding: 12px;">

                        <label style="display: flex; align-items: center; gap: 8px; padding: 10px 15px; background: white; border-radius: 8px; cursor: pointer; user-select: none; border: 2px solid #ddd;">
                            <input type="checkbox" id="manualPriceOverride" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-weight: 500; white-space: nowrap;">Manuell √ºberschreiben</span>
                        </label>
                    </div>

                    <small style="color: var(--color-text-tertiary); display: block; margin-top: 10px; font-style: italic;">
                        ‚ú® Wird automatisch aus Tabellen berechnet (Netto + MwSt). Checkbox aktivieren zum manuellen Editieren.
                    </small>
                </div>

                <!-- UNTERSCHRIFT -->
                <div id="signature-section" class="section-title">
                    <i data-feather="edit-3"></i>
                    Unterschrift
                </div>

                <div class="signature-section">
                    <label class="form-label">Unterschrift Kunde <span class="required">*</span></label>
                    <canvas id="signatureCanvas" width="800" height="400"></canvas>
                    <div class="signature-buttons">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="clearSignature()">
                            <i data-feather="x"></i>
                            L√∂schen
                        </button>
                    </div>
                </div>

                <!-- ENTWURF QUICK MODE TOGGLE -->
                <div class="form-group" style="margin-top: 20px; padding: 15px; background: rgba(255, 193, 7, 0.1); border-radius: 8px; border-left: 4px solid #ffc107;">
                    <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 600;">
                        <input type="checkbox" id="quickModeToggle" onchange="toggleQuickMode()" style="width: 20px; height: 20px; cursor: pointer;">
                        <span>‚ö° Quick Mode (nur 3 Felder: Kennzeichen, Kunde, Email)</span>
                    </label>
                    <small style="display: block; margin-top: 8px; color: var(--color-text-secondary); margin-left: 30px;">
                        üí° Meister: Schnelle Entwurf-Erstellung mit Mindestdaten. B√ºro vervollst√§ndigt sp√§ter.
                    </small>
                </div>

                <div class="submit-buttons">
                    <button type="button" class="btn btn-warning btn-lg" onclick="saveAsDraft()" style="background: #ffc107; border-color: #ffc107;">
                        <i data-feather="file-plus"></i>
                        Als Entwurf speichern
                    </button>
                    <button type="button" class="btn btn-success btn-lg" onclick="saveAsDraftWithPDF()" style="background: #28a745; border-color: #28a745;">
                        <i data-feather="file-text"></i>
                        Entwurf speichern & PDF mit QR-Code erstellen
                    </button>
                </div>
            </div>
        </form>
    </div>

    <!-- üõ°Ô∏è PERFORMANCE FIX Phase 2: Ausgelagertes JavaScript -->
    <script src="js/annahme.js"></script>

    <!-- Error Handler & Storage Monitor -->
    <script src="error-handler.js"></script>
    <script src="storage-monitor.js"></script>

    <!-- AI Features -->
    <script src="js/ai-agent-tools.js"></script>
    <script src="js/ai-agent-engine.js"></script>
</body>
</html>
