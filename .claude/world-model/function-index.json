{
  "_meta": {
    "description": "Index aller wichtigen Funktionen in der Codebase",
    "version": "1.0",
    "lastUpdated": "2025-12-12",
    "totalFunctions": 500
  },

  "cloud_functions": {
    "description": "Firebase Cloud Functions (36 Exports)",
    "email": [
      { "name": "onStatusChange", "type": "firestore-trigger", "purpose": "Email bei Status-Änderung" },
      { "name": "onNewPartnerAnfrage", "type": "firestore-trigger", "purpose": "Email bei neuer Anfrage" },
      { "name": "sendEntwurfEmail", "type": "https", "purpose": "Entwurf-Email mit QR-Code" },
      { "name": "sendEntwurfBestaetigtNotification", "type": "https", "purpose": "Bestätigungs-Email" },
      { "name": "sendEntwurfAbgelehntNotification", "type": "https", "purpose": "Ablehnungs-Email" }
    ],
    "auth": [
      { "name": "createPartnerAutoLoginToken", "type": "https", "purpose": "QR-Code Token erstellen" },
      { "name": "validatePartnerAutoLoginToken", "type": "https", "purpose": "Token validieren" },
      { "name": "ensurePartnerAccount", "type": "https", "purpose": "Partner-Account erstellen" },
      { "name": "setPartnerClaims", "type": "https", "purpose": "Custom Claims setzen" },
      { "name": "setWerkstattClaims", "type": "https", "purpose": "Werkstatt Claims" },
      { "name": "setMitarbeiterClaims", "type": "https", "purpose": "Mitarbeiter Claims" }
    ],
    "ai": [
      { "name": "parseDATPDF", "type": "https", "purpose": "GPT-4 Vision PDF-Parsing", "requires": "OPENAI_API_KEY" },
      { "name": "whisperTranscribe", "type": "https", "purpose": "Sprache zu Text", "requires": "OPENAI_API_KEY" },
      { "name": "synthesizeSpeech", "type": "https", "purpose": "Text zu Sprache", "requires": "OPENAI_API_KEY" },
      { "name": "aiAgentExecute", "type": "https", "purpose": "AI Agent Ausführung" }
    ],
    "pdf": [
      { "name": "generateAngebotPDF", "type": "https", "purpose": "Angebot-PDF generieren" },
      { "name": "sendAngebotPDFToAdmin", "type": "https", "purpose": "PDF per Email" }
    ],
    "scheduled": [
      { "name": "monthlyBonusReset", "type": "pubsub", "schedule": "1st of month", "purpose": "Bonus-Reset" },
      { "name": "cleanupStaleSessions", "type": "scheduled", "schedule": "every 15 min", "purpose": "Session-Cleanup" },
      { "name": "processEmailRetryQueue", "type": "scheduled", "schedule": "every 5 min", "purpose": "Email-Retry" },
      { "name": "resetDailyRateLimits", "type": "scheduled", "schedule": "daily", "purpose": "Rate Limit Reset" },
      { "name": "monthlyPayrollGeneration", "type": "scheduled", "schedule": "monthly", "purpose": "Lohnabrechnung" },
      { "name": "releaseExpiredLeihfahrzeugReservations", "type": "scheduled", "purpose": "Leihfahrzeug Cleanup" },
      { "name": "activateServicePlanQueues", "type": "scheduled", "purpose": "Queue Aktivierung" }
    ],
    "sync": [
      { "name": "syncStatusToPartnerAnfragen", "type": "firestore-trigger", "purpose": "Status-Sync" },
      { "name": "fahrzeugStatusChanged", "type": "firestore-trigger", "purpose": "Status-Event" }
    ],
    "training": [
      { "name": "exportAllTrainingData", "type": "https", "purpose": "ML-Trainingsdaten Export", "requires": "admin" }
    ]
  },

  "core_ui_functions": {
    "kanban": {
      "card_management": ["createKanbanCard", "createVehicleCard", "updateCard"],
      "status": ["directStatusUpdate", "changeProcess", "getCurrentService", "findServiceForStatus"],
      "modal": ["closeAuftragModal", "closeBezahltModalKanban", "closePhotoModal", "closeLogistikPhotoModal"],
      "search": ["extractKeywords", "extractSearchWords", "generateSearchSuggestions"],
      "rechnung": ["autoCreateRechnung", "generateUniqueRechnungsnummer"]
    },
    "annahme": {
      "form": ["clearDraft", "clearSignature", "fillFormFromPdf"],
      "pdf": ["createPDF", "erstelleEntwurfPDF", "convertPdfToImage", "extractFahrzeugdaten"],
      "rows": ["addArbeitslohnRow", "addErsatzteilRow", "addLackierungRow", "addMaterialienRow"],
      "extraction": ["extractArbeitslohn", "extractErsatzteile", "extractErsatzteileFromRows"]
    },
    "liste": {
      "filter": ["applyFilters", "resetFilters", "toggleFilter"],
      "display": ["renderVehicleList", "updateVehicleCard", "sortVehicles"]
    },
    "tagesplanung": {
      "queue": ["categorizeVehicles", "moveToQueue", "reorderQueue"],
      "calendar": ["generateCalendarGrid", "updateCalendarView"]
    }
  },

  "helper_functions": {
    "firebase": {
      "getCollection": "Multi-Tenant Collection Helper",
      "getCollectionName": "Nur Collection-Name String",
      "formatFirestoreDate": "Timestamp zu deutschem Datum"
    },
    "navigation": {
      "safeNavigate": "Navigation mit Listener-Cleanup"
    },
    "validation": {
      "normalizeAndValidateServiceType": "Service-Typ Validierung",
      "escapeHtml": "XSS Prevention"
    },
    "ui": {
      "toast.success": "Erfolgs-Toast",
      "toast.error": "Fehler-Toast",
      "toast.warning": "Warnung-Toast"
    }
  },

  "test_functions": {
    "integration": {
      "vehicle-integration.spec.js": ["should create vehicle", "should update status", "should delete vehicle"],
      "multi-tenant.spec.js": ["should isolate data", "should use correct collection"],
      "partner-workflow.spec.js": ["should create anfrage", "should update KVA"],
      "leihfahrzeug-integration.spec.js": ["should reserve", "should release", "should track usage"]
    },
    "smoke": {
      "ui-smoke.spec.js": ["should load pages", "should have navigation", "should be accessible"]
    }
  }
}
