{
  "_meta": {
    "description": "Codebase-Weltmodell - VOLLSTÄNDIGE Übersicht aller Dateien",
    "version": "3.3",
    "lastUpdated": "2025-12-15",
    "totalFiles": 229,
    "totalLines": 215000,
    "analysisDepth": "complete",
    "htmlFiles": 101,
    "jsFiles": 87,
    "testFiles": 41,
    "learningsCount": 45,
    "categories": 20,
    "detailedFiles": 180
  },

  "core_workflow": {
    "description": "Hauptworkflow der Werkstatt-App",
    "files": {
      "annahme.html": {
        "lines": 10806,
        "purpose": "Fahrzeugannahme, PDF-Upload, Schadensdokumentation",
        "complexity": "very_high",
        "collections": ["fahrzeuge", "partnerAnfragen"],
        "criticalPatterns": ["multi-tenant", "serviceTyp-readonly", "firebase-init"],
        "dependencies": ["firebase-config.js", "service-types.js", "auth-manager.js"],
        "gitCommits": 154
      },
      "liste.html": {
        "lines": 4099,
        "purpose": "Fahrzeugliste, Filter, Suche",
        "complexity": "medium",
        "collections": ["fahrzeuge"],
        "criticalPatterns": ["multi-tenant", "listener-registry"],
        "dependencies": ["firebase-config.js", "service-types.js"],
        "gitCommits": 65
      },
      "kanban.html": {
        "lines": 11305,
        "purpose": "Drag & Drop Kanban Board, 12 Services, Status-Management",
        "complexity": "very_high",
        "collections": ["fahrzeuge", "partnerAnfragen"],
        "criticalPatterns": ["multi-tenant", "serviceTyp-readonly", "listener-registry", "background-sync"],
        "dependencies": ["firebase-config.js", "service-types.js", "listener-registry.js"],
        "riskLevel": "CRITICAL",
        "gitCommits": 20
      },
      "abnahme.html": {
        "lines": 4000,
        "purpose": "Fahrzeugübergabe, PDF-Generierung, Abschluss",
        "complexity": "high",
        "collections": ["fahrzeuge", "rechnungen"],
        "criticalPatterns": ["multi-tenant", "timestamp-handling"],
        "dependencies": ["firebase-config.js", "pdf-generator.js"]
      },
      "tagesplanung.html": {
        "lines": 6087,
        "purpose": "Tagesplanung, Queue-Management, Terminverschiebung",
        "complexity": "high",
        "collections": ["fahrzeuge"],
        "criticalPatterns": ["multi-tenant", "bounds-check", "null-checks"],
        "dependencies": ["firebase-config.js", "service-types.js"]
      },
      "kalkulation.html": {
        "lines": 21693,
        "purpose": "Kostenvoranschlag, Preisberechnung, Ersatzteile",
        "complexity": "very_high",
        "collections": ["fahrzeuge", "ersatzteile"],
        "criticalPatterns": ["multi-tenant", "number-handling"],
        "dependencies": ["firebase-config.js", "ersatzteile-db.js"]
      },
      "entwuerfe-bearbeiten.html": {
        "lines": 7009,
        "purpose": "Entwürfe bearbeiten, Kundenbestätigung",
        "complexity": "high",
        "collections": ["fahrzeuge"],
        "criticalPatterns": ["multi-tenant", "double-click-prevention"],
        "dependencies": ["firebase-config.js"]
      },
      "index.html": {
        "lines": 6221,
        "purpose": "Dashboard, Live-Statistiken, Schnellzugriff",
        "complexity": "high",
        "collections": ["fahrzeuge", "partnerAnfragen", "rechnungen", "leihfahrzeuge", "mitarbeiter", "activeSessions", "serviceSessions", "urlaubsAnfragen"],
        "criticalPatterns": ["multi-tenant", "realtime-listeners"],
        "dependencies": ["firebase-config.js", "auth-manager.js"]
      }
    }
  },

  "partner_app": {
    "description": "Partner-Portal für externe Anfragen",
    "basePath": "partner-app/",
    "files": {
      "index.html": {
        "lines": 1224,
        "purpose": "Partner Portal Login",
        "complexity": "medium",
        "criticalPatterns": ["partner-auth"]
      },
      "meine-anfragen.html": {
        "lines": 9814,
        "purpose": "Partner-Dashboard, Anfragen-Übersicht",
        "complexity": "very_high",
        "collections": ["partnerAnfragen"],
        "criticalPatterns": ["partner-auth", "werkstatt-daten-embed"],
        "note": "Partner haben KEIN Firebase Auth - spezielle Behandlung!"
      },
      "kva-erstellen.html": {
        "lines": 9997,
        "purpose": "KVA/Angebot-Erstellung durch Partner",
        "complexity": "very_high",
        "collections": ["partnerAnfragen"],
        "criticalPatterns": ["xss-prevention", "input-validation"],
        "dependencies": ["kva-erstellen.js"]
      },
      "anfrage-detail.html": {
        "lines": 6643,
        "purpose": "Detail-Ansicht einer Anfrage",
        "complexity": "high",
        "collections": ["partnerAnfragen"],
        "criticalPatterns": ["partner-auth"]
      },
      "admin-anfragen.html": {
        "lines": 4123,
        "purpose": "Admin-Ansicht aller Partner-Anfragen",
        "complexity": "high",
        "collections": ["partnerAnfragen"]
      },
      "anfrage.html": {
        "lines": 1362,
        "purpose": "Generisches Anfrage-Formular",
        "complexity": "medium"
      },
      "service-auswahl.html": {
        "lines": 541,
        "purpose": "Service-Typ Auswahl für neue Anfrage",
        "complexity": "low",
        "note": "Leitet zu spezifischen Formularen weiter"
      },
      "multi-service-anfrage.html": {
        "lines": 1703,
        "purpose": "Mehrere Services in einer Anfrage",
        "complexity": "high",
        "criticalPatterns": ["additionalServices-handling"]
      },
      "auto-login.html": {
        "lines": 650,
        "purpose": "QR-Code Auto-Login für Partner",
        "complexity": "medium",
        "criticalPatterns": ["token-validation"]
      },
      "einstellungen.html": {
        "lines": 882,
        "purpose": "Partner-Einstellungen",
        "complexity": "medium"
      },
      "rechnungen.html": {
        "lines": 1868,
        "purpose": "Partner-Rechnungen Übersicht",
        "complexity": "medium"
      },
      "teile-karte-demo.html": {
        "lines": 1297,
        "purpose": "Demo für Teile-Karten UI",
        "complexity": "low"
      },
      "delete-all-test-anfragen.html": {
        "lines": 433,
        "purpose": "Utility: Test-Anfragen löschen",
        "complexity": "low",
        "note": "Nur für Entwicklung/Testing"
      },
      "fix-partner-permissions.html": {
        "lines": 428,
        "purpose": "Utility: Partner-Permissions reparieren",
        "complexity": "low",
        "note": "Einmaliger Fix"
      }
    },
    "anfrage_formulare": {
      "description": "12 Service-spezifische Anfrageformulare",
      "full_forms": {
        "reifen-anfrage.html": { "lines": 2246, "serviceTyp": "reifen" },
        "pflege-anfrage.html": { "lines": 2246, "serviceTyp": "pflege" },
        "tuev-anfrage.html": { "lines": 2267, "serviceTyp": "tuev" },
        "versicherung-anfrage.html": { "lines": 2267, "serviceTyp": "versicherung" },
        "glas-anfrage.html": { "lines": 2155, "serviceTyp": "glas" },
        "mechanik-anfrage.html": { "lines": 1574, "serviceTyp": "mechanik" },
        "folierung-anfrage.html": { "lines": 1152, "serviceTyp": "folierung" },
        "steinschutz-anfrage.html": { "lines": 1157, "serviceTyp": "steinschutz" },
        "werbebeklebung-anfrage.html": { "lines": 1148, "serviceTyp": "werbebeklebung" }
      },
      "simplified_forms": {
        "dellen-anfrage-simplified.html": { "lines": 930, "serviceTyp": "dellen" },
        "glas-anfrage-simplified.html": { "lines": 832, "serviceTyp": "glas" },
        "klima-anfrage-simplified.html": { "lines": 862, "serviceTyp": "klima" }
      },
      "criticalPatterns": ["service-type-validation", "form-validation"]
    }
  },

  "admin": {
    "description": "Admin-Bereich und Einstellungen",
    "files": {
      "admin-einstellungen.html": {
        "lines": 3244,
        "purpose": "Werkstatt-Einstellungen, Preiskonfiguration",
        "complexity": "high",
        "collections": ["settings"],
        "criticalPatterns": ["admin-auth", "multi-tenant"]
      },
      "admin-dashboard.html": {
        "lines": 1686,
        "purpose": "Admin-Übersicht, Statistiken",
        "complexity": "medium",
        "collections": ["fahrzeuge", "kunden", "materialRequests", "mitarbeiter"]
      },
      "admin-bonus-auszahlungen.html": {
        "lines": 2187,
        "purpose": "Partner-Bonus Auszahlungen",
        "complexity": "medium",
        "collections": ["bonusAuszahlungen", "partnerAnfragen", "partners"]
      },
      "admin-datenqualitaet.html": {
        "purpose": "AGI Training Data - Datenqualitäts-Dashboard",
        "complexity": "medium",
        "collections": ["fahrzeuge", "arbeitszeiten"],
        "note": "Neu: Sprint 4 AGI Features"
      },
      "admin-arbeitszeiten.html": {
        "purpose": "Arbeitszeit-Reporting für ML-Training",
        "complexity": "medium",
        "collections": ["arbeitszeiten"],
        "note": "Neu: Sprint 4 AGI Features"
      },
      "nutzer-verwaltung.html": {
        "purpose": "Benutzer-Management, Rollen",
        "complexity": "high",
        "collections": ["users", "mitarbeiter"],
        "criticalPatterns": ["admin-auth", "role-management"]
      },
      "mitarbeiter-verwaltung.html": {
        "lines": 5806,
        "purpose": "Mitarbeiter-Management, Zeiterfassung",
        "complexity": "high",
        "collections": ["mitarbeiter", "zeiterfassung"],
        "criticalPatterns": ["multi-tenant"]
      },
      "rechnungen-admin.html": {
        "lines": 1922,
        "purpose": "Rechnungs-Verwaltung",
        "complexity": "medium",
        "collections": ["counters", "fahrzeuge", "partnerAnfragen", "partners"]
      },
      "pending-registrations.html": {
        "lines": 1089,
        "purpose": "Ausstehende Registrierungen",
        "complexity": "medium"
      }
    }
  },

  "steuerberater": {
    "description": "Steuerberater-Portal (read-only Finanzdaten)",
    "files": {
      "steuerberater-kosten.html": {
        "lines": 1492,
        "purpose": "Kosten-Übersicht für Steuerberater",
        "complexity": "medium",
        "criticalPatterns": ["role-steuerberater"]
      },
      "steuerberater-bilanz.html": {
        "lines": 1334,
        "purpose": "Bilanz-Daten",
        "complexity": "medium",
        "collections": ["bestellungen", "fahrzeuge"]
      },
      "steuerberater-statistiken.html": {
        "lines": 1248,
        "purpose": "Statistische Auswertungen",
        "complexity": "medium"
      },
      "steuerberater-export.html": {
        "lines": 1031,
        "purpose": "Daten-Export für Buchhaltung",
        "complexity": "medium"
      }
    }
  },

  "mitarbeiter": {
    "description": "Mitarbeiter-spezifische Seiten",
    "files": {
      "dienstplan.html": {
        "lines": 3514,
        "purpose": "Dienstplan-Verwaltung (Admin)",
        "complexity": "high",
        "collections": ["bereiche", "mitarbeiter", "schichtTausche", "schichtTypen", "schichtWuensche", "schichten"]
      },
      "mitarbeiter-dienstplan.html": {
        "lines": 3281,
        "purpose": "Dienstplan-Ansicht (Mitarbeiter)",
        "complexity": "high",
        "collections": ["mitarbeiter", "schichtTausche", "schichtTypen", "schichten", "stundennachweise", "urlaubsAnfragen", "zeiterfassung"]
      },
      "mitarbeiter-lohnhistorie.html": {
        "lines": 673,
        "purpose": "Lohnhistorie für Mitarbeiter",
        "complexity": "medium"
      },
      "registrierung.html": {
        "lines": 950,
        "purpose": "Mitarbeiter-Registrierung",
        "complexity": "medium",
        "criticalPatterns": ["form-validation"]
      }
    }
  },

  "kunden_und_leihfahrzeuge": {
    "description": "Kunden- und Leihfahrzeug-Management",
    "files": {
      "kunden.html": {
        "lines": 6378,
        "purpose": "Kunden-Verwaltung, Partner-Übersicht",
        "complexity": "high",
        "collections": ["partners"]
      },
      "leihfahrzeuge.html": {
        "lines": 1779,
        "purpose": "Leihfahrzeug-Verwaltung",
        "complexity": "medium",
        "status_values": ["verfuegbar", "reserviert", "ausgegeben", "pending", "genehmigt", "abgelehnt", "beendet"]
      }
    }
  },

  "javascript_modules": {
    "description": "Wiederverwendbare JavaScript-Module",
    "basePath": "js/",
    "core_modules": {
      "auth-manager.js": {
        "lines": 866,
        "purpose": "2-Stufen-Authentifizierung (Werkstatt + Mitarbeiter)",
        "exports": ["AuthManager", "checkAuth", "logout"],
        "criticalPatterns": ["session-management", "role-verification"],
        "usedBy": ["*.html"]
      },
      "service-types.js": {
        "lines": 758,
        "purpose": "12 Service-Typen + Normalisierung (40+ Aliases)",
        "exports": ["SERVICE_TYPES", "normalizeAndValidateServiceType", "getServiceTypeLabel"],
        "criticalPatterns": ["type-normalization"],
        "usedBy": ["annahme.html", "kanban.html", "liste.html", "partner-app/*"]
      },
      "settings-manager.js": {
        "lines": 619,
        "purpose": "Admin-Einstellungen laden/speichern",
        "exports": ["SettingsManager"],
        "collections": ["settings"],
        "criticalPatterns": ["multi-tenant", "caching"]
      },
      "toast.js": {
        "lines": 263,
        "purpose": "Toast-Benachrichtigungen",
        "exports": ["showToast"]
      },
      "types.js": {
        "lines": 325,
        "purpose": "TypeScript-artige Type Definitions"
      }
    },
    "agi_modules": {
      "damage-codes.js": {
        "lines": 846,
        "purpose": "Standardisierter Schadenskatalog (50+ Positionen, 20+ Schadensarten)",
        "exports": ["DAMAGE_POSITIONS", "DAMAGE_TYPES", "getDamageLabel"]
      },
      "damage-labeler.js": {
        "lines": 941,
        "purpose": "Labeling-UI für Schadensfotos (ML-Training)",
        "exports": ["DamageLabeler"]
      },
      "work-timer.js": {
        "lines": 895,
        "purpose": "Timer-Widget für Arbeitszeit-Tracking",
        "exports": ["WorkTimer"],
        "collections": ["arbeitszeiten"]
      },
      "kva-feedback.js": {
        "lines": 636,
        "purpose": "KVA-Feedback mit 10 Abweichungsgründen",
        "exports": ["KVAFeedback"]
      }
    },
    "ai_modules": {
      "ai-agent-engine.js": {
        "lines": 777,
        "purpose": "KI-Agent Engine für Assistenz",
        "exports": ["AIAgentEngine"]
      },
      "ai-agent-tools.js": {
        "lines": 1922,
        "purpose": "Tools/Actions für KI-Agent",
        "exports": ["various tools"]
      },
      "ai-chat-widget.js": {
        "lines": 442,
        "purpose": "Chat-Widget UI für KI-Assistent",
        "exports": ["AIChatWidget"]
      }
    },
    "helper_modules": {
      "lohnberechnung.js": {
        "lines": 670,
        "purpose": "Lohnberechnung",
        "exports": ["calculateWages"]
      },
      "lohnabrechnung-pdf.js": {
        "lines": 491,
        "purpose": "Lohnabrechnung PDF-Generierung"
      },
      "quota-display.js": {
        "lines": 449,
        "purpose": "Quota/Limits Anzeige"
      },
      "mitarbeiter-notifications.js": {
        "lines": 359,
        "purpose": "Mitarbeiter-Benachrichtigungen"
      },
      "app-events.js": {
        "lines": 352,
        "purpose": "App-weite Event-Handling"
      },
      "firebase-sync.js": {
        "lines": 170,
        "purpose": "Firebase Offline-Sync"
      },
      "permissions-helper.js": {
        "lines": 119,
        "purpose": "Berechtigungs-Helper"
      }
    },
    "utils": {
      "date-helpers.js": {
        "lines": 368,
        "purpose": "Datum/Zeit Utilities",
        "exports": ["formatDate", "formatTime", "formatDateTime", "calculateWorkHours", "timeToMinutes", "minutesToTime", "getWeekNumber", "getFirstDayOfWeek", "getLastDayOfWeek", "getWeekDays", "isWorkday", "calculateBusinessDays", "addBusinessDays", "isToday", "getRelativeDateString"]
      },
      "status-helpers.js": {
        "lines": 377,
        "purpose": "Status-Badges und -Labels",
        "exports": ["getStatusBadge", "getStatusColor", "getStatusBgColor", "getStatusIcon", "getStatusLabel", "getServiceBadge", "getNextStatuses", "isValidStatusTransition"]
      },
      "validation.js": {
        "lines": 308,
        "purpose": "Input-Validierung",
        "exports": ["validateEmail", "validatePhone", "validateKennzeichen", "validateFIN", "validatePLZ", "validateRequired", "validateDate", "validateNumber", "validateForm"]
      },
      "pdf-generator.js": {
        "lines": 350,
        "purpose": "PDF-Generierung Utilities",
        "exports": ["safeAddImage", "addPDFHeader", "addPDFFooter", "checkPageOverflow", "addDataRow", "generateCompletionPDF", "generateTimesheetPDF"]
      },
      "escape-html.js": {
        "lines": 69,
        "purpose": "XSS-Prevention",
        "exports": ["escapeHtml"]
      }
    }
  },

  "core_infrastructure": {
    "description": "Kern-Infrastruktur Dateien",
    "files": {
      "firebase-config.js": {
        "lines": 1745,
        "purpose": "Firebase Init + Multi-Tenant Helper (getCollection)",
        "exports": ["db", "auth", "storage", "getCollection", "firebaseInitialized", "werkstattId"],
        "criticalPatterns": ["multi-tenant"],
        "usedBy": ["ALLE Dateien mit Firebase-Zugriff"],
        "CRITICAL": "NIEMALS direkt db.collection() verwenden!"
      },
      "listener-registry.js": {
        "lines": 235,
        "purpose": "Memory Leak Prevention für Firestore Listeners",
        "exports": ["listenerRegistry", "safeNavigate", "confirmAndNavigate"],
        "criticalPatterns": ["memory-management"],
        "usedBy": ["kanban.html", "liste.html", "alle mit onSnapshot"]
      },
      "error-handler.js": {
        "lines": 420,
        "purpose": "Globaler Error Handler",
        "exports": ["errorHandler", "showToast"]
      },
      "ersatzteile-db.js": {
        "lines": 6301,
        "purpose": "Ersatzteile-Datenbank (Preise, Artikel)",
        "exports": ["ERSATZTEILE_DB"]
      },
      "storage-monitor.js": {
        "lines": 448,
        "purpose": "Storage-Überwachung",
        "exports": ["storageMonitor"]
      },
      "global-chat-notifications.js": {
        "lines": 366,
        "purpose": "Globale Chat-Benachrichtigungen",
        "exports": ["openChat"]
      },
      "dark-mode-toggle.js": {
        "lines": 314,
        "purpose": "Dark Mode Toggle",
        "exports": ["darkModeToggle"]
      },
      "sw.js": {
        "lines": 406,
        "purpose": "Service Worker für Offline-Support",
        "criticalPatterns": ["cache-management"]
      }
    }
  },

  "partner_app_js": {
    "description": "Partner-App JavaScript",
    "basePath": "partner-app/js/",
    "files": {
      "kva-erstellen.js": {
        "lines": 9308,
        "purpose": "KVA-Erstellung Logik (größte JS-Datei)",
        "complexity": "very_high",
        "criticalPatterns": ["price-calculation", "pdf-generation"]
      },
      "partner-chat-notifications.js": {
        "lines": 396,
        "purpose": "Partner-spezifische Chat-Benachrichtigungen"
      }
    }
  },

  "cloud_functions": {
    "description": "Firebase Cloud Functions",
    "basePath": "functions/",
    "files": {
      "index.js": {
        "lines": 6761,
        "purpose": "36+ Cloud Functions",
        "functions": {
          "email": ["onStatusChange", "onNewPartnerAnfrage", "sendEntwurfEmail", "sendEntwurfBestaetigtNotification", "sendEntwurfAbgelehntNotification"],
          "auth": ["createPartnerAutoLoginToken", "validatePartnerAutoLoginToken", "ensurePartnerAccount"],
          "pdf": ["parseDATPDF", "generateAngebotPDF"],
          "scheduled": ["monthlyBonusReset", "cleanupStaleSessions", "processEmailRetryQueue"],
          "agi": ["exportAllTrainingData"]
        },
        "secrets": ["AWS_ACCESS_KEY_ID", "AWS_SECRET_ACCESS_KEY", "OPENAI_API_KEY"]
      },
      "helpers/rate-limiter.js": {
        "lines": 400,
        "purpose": "Rate Limiting für Cloud Functions"
      }
    }
  },

  "tests": {
    "description": "Test-Suite (Playwright)",
    "basePath": "tests/",
    "totalTests": 194,
    "files": {
      "integration/vehicle-integration.spec.js": { "purpose": "Fahrzeug CRUD Tests" },
      "integration/multi-tenant.spec.js": { "purpose": "Multi-Tenant Isolation Tests" },
      "integration/partner-workflow.spec.js": { "purpose": "Partner-Workflow Tests" },
      "integration/werkstatt-workflow.spec.js": { "purpose": "Werkstatt-Workflow Tests" },
      "integration/data-pipeline.spec.js": { "purpose": "Daten-Pipeline Tests" },
      "integration/pipeline-data-flow.spec.js": { "purpose": "Pipeline Data Flow Tests" },
      "integration/leihfahrzeug-integration.spec.js": { "lines": 553, "purpose": "Leihfahrzeug Tests" },
      "integration/11-rechnungen-integration.spec.js": { "lines": 717, "purpose": "Rechnungen CRUD & PDF-Generation Tests" },
      "integration/12-kalkulation-integration.spec.js": { "lines": 727, "purpose": "Kalkulation, Preisberechnung, Ersatzteile Tests" },
      "integration/13-abnahme-workflow.spec.js": { "lines": 552, "purpose": "Abnahme Workflow & Fahrzeugübergabe Tests" },
      "integration/14-tagesplanung-integration.spec.js": { "lines": 739, "purpose": "Tagesplanung & Queue-Management Tests" },
      "integration/15-mitarbeiter-crud.spec.js": { "lines": 557, "purpose": "Mitarbeiter CRUD & Zeiterfassung Tests" },
      "integration/16-multi-role-auth.spec.js": { "lines": 459, "purpose": "Multi-Role Authentication Tests" },
      "integration/17-security-edge-cases.spec.js": { "lines": 471, "purpose": "XSS Prevention, NoSQL Injection, Input Validation" },
      "integration/18-email-integration.spec.js": { "lines": 409, "purpose": "Email Integration & AWS SES Tests" },
      "integration/19-offline-resilience.spec.js": { "lines": 454, "purpose": "Offline Resilience & Sync Tests" },
      "integration/20-performance-stress.spec.js": { "lines": 434, "purpose": "Performance & Stress Tests" },
      "integration/21-pdf-validation.spec.js": { "lines": 456, "purpose": "PDF Generation & Validation Tests" },
      "integration/22-steuerberater-export.spec.js": { "lines": 460, "purpose": "Steuerberater Export & Read-only Access Tests" },
      "smoke/ui-smoke.spec.js": { "purpose": "16 UI Accessibility Tests" },
      "helpers/firebase-helper.js": { "lines": 993, "purpose": "Test-Utilities für Firestore" },
      "helpers/service-helper.js": { "lines": 768, "purpose": "Service Test-Utilities" },
      "helpers/form-helper.js": { "lines": 606, "purpose": "Form Test-Utilities" }
    },
    "additionalTests": {
      "06-cascade-delete-race.spec.js": { "lines": 1309, "purpose": "Cascade Delete Race Conditions" },
      "05-transaction-failure.spec.js": { "lines": 990, "purpose": "Transaction Failure Tests" },
      "07-service-consistency-v32.spec.js": { "lines": 537, "purpose": "Service Consistency Tests" },
      "08-admin-einstellungen.spec.js": { "lines": 488, "purpose": "Admin Settings Tests" },
      "09-ki-chat-widget.spec.js": { "lines": 474, "purpose": "KI Chat Widget Tests" },
      "10-mobile-comprehensive.spec.js": { "lines": 424, "purpose": "Mobile Comprehensive Tests" }
    }
  },

  "migrations": {
    "description": "Daten-Migrations-Scripts (einmalige Ausführung)",
    "files": {
      "migrate-data-consistency.html": { "lines": 502, "purpose": "Daten-Konsistenz prüfen" },
      "migrate-fotos-to-firestore.html": { "lines": 629, "purpose": "Fotos zu Firestore migrieren" },
      "migrate-kennzeichen-uppercase.html": { "lines": 690, "purpose": "Kennzeichen auf Uppercase" },
      "migrate-mitarbeiter-to-firebase-auth.html": { "lines": 521, "purpose": "Mitarbeiter zu Firebase Auth" },
      "migrate-mitarbeiter.html": { "lines": 621, "purpose": "Mitarbeiter-Migration" },
      "migrate-multi-service-status.html": { "lines": 498, "purpose": "Multi-Service Status" },
      "migrate-partneranfrageid.html": { "lines": 351, "purpose": "Partner-Anfrage IDs" },
      "migrate-price-consistency.html": { "lines": 570, "purpose": "Preis-Konsistenz" },
      "migrate-status-consistency.html": { "lines": 474, "purpose": "Status-Konsistenz" },
      "partner-app/migrate-add-service-labels.html": { "lines": 454, "purpose": "Service Labels hinzufügen" },
      "partner-app/migrate-tuev-typo.html": { "lines": 409, "purpose": "TÜV Typo-Fix" }
    },
    "note": "NUR für manuelle Ausführung, nicht im normalen Workflow"
  },

  "static_pages": {
    "description": "Statische Seiten (Marketing, Legal)",
    "files": {
      "landing.html": { "lines": 800, "purpose": "Landing Page / Marketing" },
      "agb.html": { "purpose": "Allgemeine Geschäftsbedingungen" },
      "datenschutz.html": { "purpose": "Datenschutzerklärung (DSGVO)" },
      "impressum.html": { "purpose": "Impressum (legal required)" },
      "kontakt.html": { "purpose": "Kontaktformular" },
      "karriere.html": { "purpose": "Karriere/Jobs" },
      "presse.html": { "lines": 213, "purpose": "Presse-Bereich" },
      "ueber-uns.html": { "lines": 205, "purpose": "Über uns / Team" },
      "offline.html": { "lines": 294, "purpose": "Offline-Fallback (Service Worker)" }
    },
    "complexity": "low",
    "note": "Keine Firebase-Operationen"
  },

  "security_rules": {
    "description": "Firebase Security Rules",
    "files": {
      "firestore.rules": {
        "lines": 2105,
        "purpose": "Firestore Access Control, Role-based permissions",
        "complexity": "very_high",
        "criticalPatterns": ["rules-order", "custom-claims-priority", "multi-tenant-patterns"],
        "roles": ["superadmin", "admin", "werkstatt", "mitarbeiter", "partner", "kunde", "steuerberater"],
        "helperFunctions": ["getUserRole", "getUserStatus", "isAdmin", "isSuperAdmin", "isMitarbeiter", "isPartner", "isOwner"],
        "CRITICAL": "Spezifische Rules MÜSSEN vor generischen Wildcard-Rules stehen!"
      },
      "storage.rules": {
        "lines": 195,
        "purpose": "Firebase Storage Access Control",
        "complexity": "high",
        "paths": {
          "progress-photos": { "maxSize": "10MB", "auth": true, "mimeTypes": ["image/jpeg", "image/png", "image/webp"] },
          "fahrzeuge": { "maxSize": "10MB", "auth": true },
          "partner-anfragen": { "maxSize": "10MB", "auth": false, "note": "Partner haben KEIN Firebase Auth!" },
          "pdfs": { "maxSize": "50MB", "auth": true },
          "werkstatt-logos": { "maxSize": "2MB", "auth": true },
          "angebote": { "maxSize": "50MB", "auth": false },
          "material_photos": { "maxSize": "10MB", "auth": true },
          "entwuerfe": { "maxSize": "5MB", "auth": true },
          "entwurf-pdfs": { "maxSize": "50MB", "auth": true },
          "logistik-protokoll": { "maxSize": "10MB", "auth": true },
          "designs": { "maxSize": "10MB", "auth": true }
        }
      }
    }
  },

  "additional_tools": {
    "description": "Zusätzliche Werkzeuge und Seiten",
    "files": {
      "material.html": {
        "lines": 5920,
        "purpose": "Material-Verwaltung, Ersatzteile-Bestellung",
        "complexity": "high",
        "collections": ["material_requests"],
        "criticalPatterns": ["multi-tenant"]
      },
      "wissensdatenbank.html": {
        "lines": 3726,
        "purpose": "Knowledge Base, SOPs, Schichtübergaben",
        "complexity": "high",
        "collections": ["guidelines", "announcements", "shift_handovers"],
        "criticalPatterns": ["listener-cleanup"],
        "note": "Hat Listener Memory Leak Bug (fixed)"
      },
      "kalender.html": {
        "lines": 3725,
        "purpose": "Kalender-Ansicht, Terminplanung",
        "complexity": "medium",
        "collections": ["fahrzeuge", "kalender"],
        "criticalPatterns": ["listener-registry"]
      },
      "abteilungs-queue.html": {
        "purpose": "Abteilungs-Queue Management",
        "complexity": "medium",
        "collections": ["fahrzeuge"],
        "criticalPatterns": ["getCollection-vs-getCollectionName"],
        "note": "Bug gefixed: getCollection -> getCollectionName Verwechslung"
      },
      "seed-wissensdatenbank.html": {
        "lines": 1180,
        "purpose": "Seed-Daten für Wissensdatenbank",
        "complexity": "low"
      }
    }
  },

  "debug_and_utility": {
    "description": "Debug- und Utility-Seiten",
    "files": {
      "debug-marceltest1-hours.js": { "lines": 294, "purpose": "Debug Arbeitszeiten" },
      "debug-urlaubsanfragen.js": { "lines": 264, "purpose": "Debug Urlaubsanfragen" },
      "check_request.js": { "lines": 46, "purpose": "Request Debugging" },
      "image-optimizer.js": { "lines": 240, "purpose": "Bild-Optimierung" },
      "landing.js": { "lines": 263, "purpose": "Landing Page Logik" },
      "playwright.config.js": { "lines": 129, "purpose": "Playwright Test-Config" }
    }
  },

  "helper_pages": {
    "description": "Helper/Utility HTML-Seiten für Entwickler",
    "files": {
      "api-docs.html": {
        "lines": 279,
        "purpose": "API Dokumentation",
        "complexity": "low"
      },
      "component-library.html": {
        "lines": 479,
        "purpose": "UI Component Library (Apple Liquid Glass)",
        "complexity": "low",
        "note": "Design-System Referenz"
      },
      "dokumentation.html": {
        "lines": 268,
        "purpose": "Allgemeine Dokumentation",
        "complexity": "low"
      },
      "hilfe.html": {
        "lines": 260,
        "purpose": "Hilfe & FAQ für Benutzer",
        "complexity": "low"
      },
      "monitor-firebase-quota.html": {
        "lines": 390,
        "purpose": "Firebase Quota Monitor",
        "complexity": "medium",
        "note": "Überwacht Firestore/Storage Nutzung"
      }
    }
  },

  "email_templates": {
    "description": "Email-Templates für Cloud Functions",
    "basePath": "functions/email-templates/",
    "files": {
      "new-anfrage.html": {
        "lines": 136,
        "purpose": "Neue Partner-Anfrage Benachrichtigung",
        "variables": ["partnerName", "kennzeichen", "marke", "modell", "serviceTyp", "createdAt", "anfrageLink"]
      },
      "status-change.html": {
        "lines": 170,
        "purpose": "Status-Update Benachrichtigung",
        "variables": ["kundenName", "kennzeichen", "marke", "modell", "serviceTyp", "oldStatus", "newStatus", "quickViewLink"]
      },
      "user-approved.html": {
        "lines": 120,
        "purpose": "Account-Freischaltung Benachrichtigung",
        "variables": ["userName", "userEmail", "portalLink"]
      }
    },
    "note": "Handlebars-Syntax mit {{variable}}"
  },

  "recent_bug_patterns": {
    "description": "Häufige Bug-Patterns aus Git-Historie (2025-10-01 bis heute)",
    "bugCount": 58,
    "patterns": {
      "null_undefined_checks": {
        "count": 15,
        "files": ["annahme.html", "tagesplanung.html", "kanban.html"],
        "fix": "Optional chaining (?.) oder explizite null-checks"
      },
      "array_bounds": {
        "count": 8,
        "files": ["tagesplanung.html"],
        "fix": "Array.length prüfen vor Index-Zugriff"
      },
      "collection_sync": {
        "count": 6,
        "files": ["kanban.html", "tagesplanung.html"],
        "fix": "BEIDE Collections (fahrzeuge UND partnerAnfragen) aktualisieren"
      },
      "date_handling": {
        "count": 5,
        "files": ["kanban.html", "partner-app/*"],
        "fix": "formatFirestoreDate() Helper oder toDate() verwenden"
      },
      "radio_button_crash": {
        "count": 4,
        "files": ["annahme.html"],
        "fix": "?.value || 'default' Pattern"
      },
      "listener_memory_leak": {
        "count": 4,
        "files": ["wissensdatenbank.html", "liste.html"],
        "fix": "listenerRegistry und cleanup bei Navigation"
      }
    }
  }
}
