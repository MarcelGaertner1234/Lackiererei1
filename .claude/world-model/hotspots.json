{
  "_meta": {
    "description": "Bug-Hotspots - Dateien mit hohem Bug-Risiko basierend auf Git-Historie",
    "version": "2.0",
    "lastUpdated": "2025-12-12",
    "source": "Git commit history analysis + Phase 1 Bug-Fixes (95 Fixes)",
    "phase1_summary": {
      "total_fixes": 95,
      "total_commits": 15,
      "files_stabilized": 15,
      "date_completed": "2025-12-12"
    }
  },

  "risk_levels": {
    "critical": "Häufige Bugs, komplexe Logik, viele Abhängigkeiten",
    "high": "Regelmäßige Fixes nötig, mittlere Komplexität",
    "medium": "Gelegentliche Bugs, überschaubare Komplexität",
    "low": "Selten Probleme, einfache Logik"
  },

  "hotspots": {
    "kanban.html": {
      "risk": "medium",
      "lines": 11163,
      "bugCount": 15,
      "phase1_fixes": 7,
      "status": "✅ STABILIZED (Commit 93a5b7d)",
      "recentFixes": [
        "Phase 1: Multi-Tenant, Drag Lock, Firebase Init, Double-Click, Error Tracking",
        "48h-Filter bei Verschiebung",
        "Background Sync Tracker",
        "Drag & Drop Race Conditions",
        "serviceTyp Überschreiben",
        "Listener Memory Leaks"
      ],
      "commonBugTypes": [
        "Race Conditions bei Drag & Drop",
        "serviceTyp wird überschrieben (DATA LOSS!)",
        "Memory Leaks durch nicht aufgeräumte Listener",
        "Sync-Fehler zwischen fahrzeuge und partnerAnfragen"
      ],
      "preventionPatterns": [
        "NIEMALS serviceTyp ändern",
        "IMMER listenerRegistry verwenden",
        "Background Sync Tracker für stille Fehler",
        "Optimistic UI mit Rollback bei Fehler"
      ]
    },

    "tagesplanung.html": {
      "risk": "low",
      "lines": 6069,
      "bugCount": 8,
      "phase1_fixes": 3,
      "status": "✅ STABILIZED (Commit 8efd4d5)",
      "recentFixes": [
        "Phase 1: Bounds-Check, Optional Chaining",
        "T1 & T2 bounds check",
        "null-checks für Verschieben-Feature",
        "Array Index Out of Bounds"
      ],
      "commonBugTypes": [
        "Array bounds nicht geprüft",
        "null/undefined bei leeren Arrays",
        "Verschieben-Logik komplex"
      ],
      "preventionPatterns": [
        "IMMER bounds check bei Array-Zugriff",
        "Optional chaining (?.) verwenden",
        "Leere Arrays separat behandeln"
      ]
    },

    "annahme.html": {
      "risk": "low",
      "lines": 10774,
      "bugCount": 10,
      "phase1_fixes": 4,
      "status": "✅ STABILIZED (Commit 8efd4d5)",
      "recentFixes": [
        "Phase 1: Double-Click Prevention, Null-Safety, Array Bounds",
        "querySelector Null-Checks",
        "Radio Button Crash",
        "Double-Click Prevention"
      ],
      "commonBugTypes": [
        "querySelector null wenn Element fehlt",
        "Radio buttons ohne Auswahl",
        "Async-Operationen laufen doppelt"
      ],
      "preventionPatterns": [
        "?.value || 'default' für Radio Buttons",
        "Button disable während async",
        "Optional chaining für DOM-Queries"
      ]
    },

    "entwuerfe-bearbeiten.html": {
      "risk": "low",
      "lines": 7009,
      "bugCount": 5,
      "phase1_fixes": 24,
      "status": "✅ STABILIZED (Commit 84ae9b5) - MOST FIXES!",
      "recentFixes": [
        "Phase 1: 13 Multi-Tenant, Double-Click, PDF Timeout, Unsaved Warning, Array Bounds, URL Validation",
        "Keine 2 Preise mehr ohne Ersatzteile",
        "Preis-Konsistenz"
      ],
      "commonBugTypes": [
        "Preis-Logik inkonsistent",
        "Ersatzteile-Handling"
      ],
      "preventionPatterns": [
        "Preis-Validierung vor Speichern",
        "Ersatzteile-Array prüfen"
      ]
    },

    "kalkulation.html": {
      "risk": "low",
      "lines": 21693,
      "bugCount": 6,
      "phase1_fixes": 5,
      "status": "✅ STABILIZED (Commit c026a5e)",
      "recentFixes": [
        "Phase 1: 5x Double-Click Prevention für Save-Funktionen",
        "Preisberechnung",
        "Ersatzteile-Integration"
      ],
      "commonBugTypes": [
        "Numerische Präzision (Floats)",
        "Summen-Berechnung falsch",
        "Ersatzteile nicht synchron"
      ],
      "preventionPatterns": [
        "toFixed(2) für Preise",
        "parseFloat mit Fallback",
        "Ersatzteile-Summe separat validieren"
      ]
    },

    "partner-app/kva-erstellen.html": {
      "risk": "high",
      "bugCount": 4,
      "recentFixes": [
        "XSS Protection",
        "Dead Code Cleanup"
      ],
      "commonBugTypes": [
        "XSS bei User-Input",
        "Ungültige Eingaben"
      ],
      "preventionPatterns": [
        "escapeHtml() für alle User-Inputs",
        "Input-Validation serverseitig wiederholen"
      ]
    },

    "functions/index.js": {
      "risk": "high",
      "bugCount": 5,
      "recentFixes": [
        "Status-Mapping bereit_zur_abholung",
        "Email-Retry-Logik"
      ],
      "commonBugTypes": [
        "Status-Mapping unvollständig",
        "Email-Fehler nicht geloggt",
        "Rate Limiting"
      ],
      "preventionPatterns": [
        "ALLE Status in Mapping aufnehmen",
        "Fehler immer loggen",
        "Retry mit exponential backoff"
      ]
    },

    "liste.html": {
      "risk": "low",
      "lines": 4069,
      "bugCount": 3,
      "phase1_fixes": 4,
      "status": "✅ STABILIZED (Commit 05199c8)",
      "recentFixes": [
        "Phase 1: Array Access Null-Safety, Pagination Bounds, Timestamp Support, Double-Click"
      ],
      "commonBugTypes": [
        "Filter-Logik",
        "Listener nicht aufgeräumt"
      ],
      "preventionPatterns": [
        "listenerRegistry verwenden",
        "Filter-State konsistent halten"
      ]
    },

    "wissensdatenbank.html": {
      "risk": "low",
      "lines": 3726,
      "bugCount": 2,
      "phase1_fixes": 5,
      "status": "✅ STABILIZED (Commit 841b119) - FINAL FILE!",
      "recentFixes": [
        "Phase 1: 5x Double-Click Prevention für Guidelines, Announcements, Handover, Demontage, Category",
        "missing unsubscribeDemontage()"
      ],
      "commonBugTypes": [
        "Listener nicht aufgeräumt"
      ],
      "preventionPatterns": [
        "Alle unsubscribe-Funktionen aufrufen"
      ]
    },

    "dienstplan.html": {
      "risk": "low",
      "lines": 3514,
      "phase1_fixes": 10,
      "status": "✅ STABILIZED (Commit 541417e)",
      "recentFixes": [
        "Phase 1: 10x Double-Click/Race Condition Locks für Schicht-Funktionen"
      ]
    },

    "kalender.html": {
      "risk": "low",
      "lines": 3500,
      "phase1_fixes": 7,
      "status": "✅ STABILIZED (Commit 3c88183)",
      "recentFixes": [
        "Phase 1: Undefined Functions gefixt, Double-Click, Drag Race Condition"
      ]
    },

    "material.html": {
      "risk": "low",
      "lines": 6000,
      "phase1_fixes": 5,
      "status": "✅ STABILIZED (Commit b52dddb)",
      "recentFixes": [
        "Phase 1: Listener Registry, 4x Double-Click für Bestellungen"
      ]
    },

    "leihfahrzeuge.html": {
      "risk": "low",
      "lines": 1800,
      "phase1_fixes": 5,
      "status": "✅ STABILIZED (Commit cb049de)",
      "recentFixes": [
        "Phase 1: 5x Double-Click für Save, Return, Request, Approve, Reject"
      ]
    },

    "kunden.html": {
      "risk": "low",
      "lines": 6000,
      "phase1_fixes": 2,
      "status": "✅ STABILIZED (Commit 9c3bce3)",
      "recentFixes": [
        "Phase 1: Double-Click für Save + Delete"
      ]
    },

    "mitarbeiter-verwaltung.html": {
      "risk": "low",
      "lines": 6500,
      "phase1_fixes": 3,
      "status": "✅ STABILIZED (Commit 8e62ca3)",
      "recentFixes": [
        "Phase 1: Listener Registry, Delete Lock, SaveZeit Lock"
      ]
    },

    "rechnungen-admin.html": {
      "risk": "low",
      "lines": 1943,
      "phase1_fixes": 3,
      "status": "✅ STABILIZED (Commit f11442f)",
      "recentFixes": [
        "Phase 1: Double-Click für manualCreate, 2x Multi-Tenant"
      ]
    },

    "abnahme.html": {
      "risk": "low",
      "lines": 3700,
      "phase1_fixes": 1,
      "status": "✅ STABILIZED (Commit 12987d4)",
      "recentFixes": [
        "Phase 1: Double-Click für submitAbnahme"
      ]
    }
  },

  "patterns_causing_most_bugs": {
    "1_multi_tenant": {
      "description": "Direkter db.collection() statt window.getCollection()",
      "occurrences": 12,
      "severity": "critical",
      "files": ["kanban.html", "annahme.html", "liste.html"]
    },
    "2_null_checks": {
      "description": "Fehlende null/undefined Checks",
      "occurrences": 15,
      "severity": "high",
      "files": ["annahme.html", "tagesplanung.html", "kanban.html"]
    },
    "3_async_handling": {
      "description": "Double-Click, Race Conditions, fehlende awaits",
      "occurrences": 8,
      "severity": "high",
      "files": ["annahme.html", "kanban.html", "entwuerfe-bearbeiten.html"]
    },
    "4_listener_leaks": {
      "description": "Firestore Listener nicht aufgeräumt",
      "occurrences": 6,
      "severity": "medium",
      "files": ["kanban.html", "liste.html", "wissensdatenbank.html"]
    },
    "5_service_typ": {
      "description": "serviceTyp nach Erstellung geändert",
      "occurrences": 3,
      "severity": "critical",
      "files": ["kanban.html"]
    }
  },

  "safe_files": {
    "description": "Dateien mit geringem Bug-Risiko",
    "files": [
      "landing.html",
      "agb.html",
      "datenschutz.html",
      "impressum.html",
      "kontakt.html",
      "js/toast.js",
      "js/utils/escape-html.js"
    ],
    "reason": "Statische Seiten oder einfache Utilities ohne Firebase"
  }
}
