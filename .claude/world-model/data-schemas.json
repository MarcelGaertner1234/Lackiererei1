{
  "_meta": {
    "description": "Datenstrukturen und Schemas der wichtigsten Collections",
    "version": "2.1",
    "lastUpdated": "2025-12-16",
    "totalCollections": 35,
    "documentedCollections": 35,
    "note": "Extended with 25+ previously missing collections. v2.1: Marked leihfahrzeugBuchungen as PLANNED"
  },

  "fahrzeuge": {
    "description": "Haupt-Collection für Fahrzeuge im Werkstatt-Workflow",
    "topFields": {
      "kennzeichen": { "usage": 94, "type": "string", "required": true },
      "serviceTyp": { "usage": 74, "type": "string", "required": true, "READONLY": true },
      "additionalServices": { "usage": 128, "type": "array", "note": "Zusätzliche Services" },
      "serviceStatuses": { "usage": 54, "type": "object", "note": "Status pro Service" },
      "kva": { "usage": 74, "type": "object", "note": "Kostenvoranschlag-Daten" },
      "kalkulationData": { "usage": 49, "type": "object", "note": "Kalkulations-Details" },
      "marke": { "usage": 41, "type": "string" },
      "modell": { "usage": 42, "type": "string" },
      "prozessStatus": { "usage": 28, "type": "string", "values": ["anlieferung", "selbstbringer", "abholung"] },
      "servicePlan": { "usage": 14, "type": "array", "note": "Geplante Services" }
    },
    "timestamps": {
      "prozessTimestamps": { "usage": 20, "type": "object", "note": "Prozess-Zeitstempel" },
      "statusHistory": { "usage": 15, "type": "array", "note": "Status-Historie" },
      "geplantesAbnahmeDatum": { "usage": 15, "type": "timestamp" },
      "abholtermin": { "usage": 9, "type": "timestamp" }
    },
    "logistik": {
      "abholserviceGewuenscht": { "usage": 10, "type": "boolean" },
      "logistikDetails": { "usage": 11, "type": "object" }
    },
    "finanzen": {
      "vereinbarterPreis": { "usage": 21, "type": "number" },
      "rechnung": { "usage": 9, "type": "object" },
      "tagesmiete": { "usage": 11, "type": "number" }
    },
    "pdfs": {
      "pdfUrl": { "usage": 11, "type": "string" },
      "entwurfPdfUrl": { "usage": 8, "type": "string" }
    }
  },

  "partnerAnfragen": {
    "description": "Anfragen von externen Partnern",
    "topFields": {
      "kva": { "usage": 353, "type": "object", "note": "Kostenvoranschlag" },
      "serviceData": { "usage": 347, "type": "object", "note": "Service-spezifische Daten" },
      "serviceTyp": { "usage": 144, "type": "string", "required": true },
      "serviceDetails": { "usage": 137, "type": "object" },
      "serviceLabels": { "usage": 98, "type": "array", "note": "Service-Labels für UI" },
      "fahrzeug": { "usage": 98, "type": "object", "note": "Fahrzeug-Stammdaten" },
      "kennzeichen": { "usage": 89, "type": "string" },
      "status": { "usage": 74, "type": "string", "values": ["neu", "warte_kva", "kva_gesendet", "beauftragt", "abgelehnt", "storniert"] },
      "auftragsnummer": { "usage": 67, "type": "string" },
      "angebotDetails": { "usage": 57, "type": "object" }
    },
    "partner": {
      "partnerName": { "usage": 40, "type": "string" },
      "partnerId": { "type": "string", "note": "Referenz zum Partner" }
    },
    "logistik": {
      "ersatzfahrzeugGewuenscht": { "usage": 32, "type": "boolean" },
      "abholserviceGewuenscht": { "usage": 30, "type": "boolean" },
      "anliefertermin": { "usage": 47, "type": "timestamp" },
      "abholtermin": { "usage": 30, "type": "timestamp" }
    },
    "import": {
      "pdfImport": { "usage": 31, "type": "object", "note": "DAT-PDF Import Daten" }
    }
  },

  "users": {
    "description": "Firebase Auth Benutzer (GLOBAL - kein Multi-Tenant!)",
    "fields": {
      "email": { "type": "string", "required": true },
      "role": { "type": "string", "values": ["superadmin", "admin", "werkstatt", "mitarbeiter", "partner", "kunde", "steuerberater"] },
      "status": { "type": "string", "values": ["active", "inactive", "pending"] },
      "werkstattId": { "type": "string", "note": "Zuordnung zur Werkstatt" }
    }
  },

  "mitarbeiter": {
    "description": "Mitarbeiter-Stammdaten (Multi-Tenant)",
    "fields": {
      "name": { "type": "string", "required": true },
      "email": { "type": "string" },
      "abteilung": { "type": "string", "values": ["lackier", "karosserie", "mechanik", "logistik", "buero"] },
      "skillLevel": { "type": "string", "values": ["junior", "mittel", "senior", "meister"] },
      "status": { "type": "string", "values": ["active", "inactive"] }
    }
  },

  "arbeitszeiten": {
    "description": "Arbeitszeit-Tracking für ML-Training (Multi-Tenant)",
    "fields": {
      "fahrzeugId": { "type": "string", "required": true },
      "mitarbeiterId": { "type": "string", "required": true },
      "arbeitstyp": { "type": "string" },
      "startzeit": { "type": "timestamp" },
      "endzeit": { "type": "timestamp" },
      "dauerMinuten": { "type": "number" },
      "mitarbeiterSkillLevel": { "type": "string" },
      "schwierigkeit": { "type": "number", "range": "1-5" }
    },
    "note": "Neu: AGI Training Data Collection"
  },

  "partners": {
    "description": "Partner-Stammdaten (Multi-Tenant)",
    "usage": 20,
    "fields": {
      "name": { "type": "string", "required": true },
      "email": { "type": "string" },
      "telefon": { "type": "string" },
      "adresse": { "type": "object" },
      "bonusProzent": { "type": "number" },
      "status": { "type": "string", "values": ["active", "inactive"] }
    }
  },

  "bonusAuszahlungen": {
    "description": "Partner-Bonus-Auszahlungen (Multi-Tenant)",
    "fields": {
      "partnerId": { "type": "string", "required": true },
      "betrag": { "type": "number" },
      "status": { "type": "string" },
      "auszahlungsDatum": { "type": "timestamp" }
    }
  },

  "leihfahrzeugPool": {
    "description": "Verfügbare Leihfahrzeuge (Multi-Tenant)",
    "fields": {
      "kennzeichen": { "type": "string", "required": true },
      "marke": { "type": "string" },
      "modell": { "type": "string" },
      "status": { "type": "string", "values": ["verfuegbar", "verliehen", "wartung", "reserviert"] },
      "tagesmiete": { "type": "number" }
    }
  },

  "leihfahrzeugAnfragen": {
    "description": "Leihfahrzeug-Anfragen (Multi-Tenant)",
    "fields": {
      "fahrzeugId": { "type": "string" },
      "kundeId": { "type": "string" },
      "startDatum": { "type": "timestamp" },
      "endDatum": { "type": "timestamp" },
      "status": { "type": "string" }
    }
  },

  "leihfahrzeugBuchungen": {
    "description": "Aktive Leihfahrzeug-Buchungen (Multi-Tenant)",
    "status": "PLANNED - Not yet implemented in code (2025-12-16)",
    "note": "Booking data currently tracked in kalenderEvents and leihfahrzeugAnfragen instead",
    "fields": {
      "leihfahrzeugId": { "type": "string", "required": true },
      "kundeId": { "type": "string" },
      "startDatum": { "type": "timestamp" },
      "endDatum": { "type": "timestamp" },
      "tagesmiete": { "type": "number" }
    }
  },

  "bestellungen": {
    "description": "Material-Bestellungen (Multi-Tenant)",
    "usage": 20,
    "fields": {
      "artikel": { "type": "array" },
      "lieferant": { "type": "string" },
      "status": { "type": "string", "values": ["offen", "bestellt", "geliefert", "storniert"] },
      "bestellDatum": { "type": "timestamp" },
      "lieferDatum": { "type": "timestamp" }
    }
  },

  "materialRequests": {
    "description": "Materialanforderungen von Mitarbeitern (Multi-Tenant)",
    "usage": 17,
    "fields": {
      "fahrzeugId": { "type": "string" },
      "mitarbeiterId": { "type": "string" },
      "artikel": { "type": "array" },
      "status": { "type": "string" },
      "dringlichkeit": { "type": "string" }
    }
  },

  "ersatzteile": {
    "description": "Ersatzteile-Katalog (GLOBAL - kein Multi-Tenant!)",
    "usage": 12,
    "multiTenant": false,
    "note": "Zentrale Ersatzteile-Datenbank für alle Werkstätten",
    "fields": {
      "name": { "type": "string", "required": true },
      "kategorie": { "type": "string" },
      "preis": { "type": "number" },
      "lieferant": { "type": "string" }
    }
  },

  "schichten": {
    "description": "Schichtpläne (Multi-Tenant)",
    "usage": 19,
    "fields": {
      "datum": { "type": "timestamp", "required": true },
      "mitarbeiterId": { "type": "string", "required": true },
      "schichtTypId": { "type": "string" },
      "bereichId": { "type": "string" },
      "startzeit": { "type": "string" },
      "endzeit": { "type": "string" }
    }
  },

  "schichtTypen": {
    "description": "Schichttyp-Definitionen (Multi-Tenant)",
    "fields": {
      "name": { "type": "string", "required": true },
      "startzeit": { "type": "string" },
      "endzeit": { "type": "string" },
      "farbe": { "type": "string" }
    }
  },

  "schichtWuensche": {
    "description": "Schicht-Wünsche von Mitarbeitern (Multi-Tenant)",
    "fields": {
      "mitarbeiterId": { "type": "string", "required": true },
      "datum": { "type": "timestamp" },
      "wunschTyp": { "type": "string" },
      "status": { "type": "string" }
    }
  },

  "schichtTausche": {
    "description": "Schicht-Tausch-Anfragen (Multi-Tenant)",
    "fields": {
      "vonMitarbeiterId": { "type": "string", "required": true },
      "zuMitarbeiterId": { "type": "string", "required": true },
      "schichtId": { "type": "string" },
      "status": { "type": "string" }
    }
  },

  "kunden": {
    "description": "Kundenstammdaten (Multi-Tenant)",
    "usage": 15,
    "fields": {
      "name": { "type": "string", "required": true },
      "email": { "type": "string" },
      "telefon": { "type": "string" },
      "adresse": { "type": "object" },
      "fahrzeuge": { "type": "array", "note": "Referenzen zu Kunden-Fahrzeugen" }
    }
  },

  "rechnungen": {
    "description": "Rechnungen (Multi-Tenant)",
    "fields": {
      "fahrzeugId": { "type": "string", "required": true },
      "rechnungsNummer": { "type": "string" },
      "betrag": { "type": "number" },
      "status": { "type": "string", "values": ["offen", "bezahlt", "storniert"] },
      "erstelltAm": { "type": "timestamp" }
    }
  },

  "kalender": {
    "description": "Kalendereinträge (Multi-Tenant)",
    "fields": {
      "titel": { "type": "string" },
      "datum": { "type": "timestamp" },
      "typ": { "type": "string" },
      "referenzId": { "type": "string", "note": "fahrzeugId oder anfrageId" }
    }
  },

  "kalenderEvents": {
    "description": "Kalender-Events (Multi-Tenant)",
    "fields": {
      "titel": { "type": "string" },
      "start": { "type": "timestamp" },
      "end": { "type": "timestamp" },
      "typ": { "type": "string" },
      "color": { "type": "string" }
    }
  },

  "zeiterfassung": {
    "description": "Zeiterfassung für Mitarbeiter (Multi-Tenant)",
    "fields": {
      "mitarbeiterId": { "type": "string", "required": true },
      "datum": { "type": "timestamp" },
      "arbeitsbeginn": { "type": "timestamp" },
      "arbeitsende": { "type": "timestamp" },
      "pauseMinuten": { "type": "number" }
    }
  },

  "stundennachweise": {
    "description": "Monatliche Stundennachweise (Multi-Tenant)",
    "fields": {
      "mitarbeiterId": { "type": "string", "required": true },
      "monat": { "type": "string" },
      "sollStunden": { "type": "number" },
      "istStunden": { "type": "number" },
      "ueberstunden": { "type": "number" }
    }
  },

  "urlaubsAnfragen": {
    "description": "Urlaubsanträge (Multi-Tenant)",
    "fields": {
      "mitarbeiterId": { "type": "string", "required": true },
      "startDatum": { "type": "timestamp" },
      "endDatum": { "type": "timestamp" },
      "status": { "type": "string", "values": ["beantragt", "genehmigt", "abgelehnt"] },
      "grund": { "type": "string" }
    }
  },

  "counters": {
    "description": "Auto-Increment Counter (Multi-Tenant)",
    "fields": {
      "name": { "type": "string" },
      "currentValue": { "type": "number" }
    },
    "note": "Für Rechnungsnummern, Auftragsnummern etc."
  },

  "settings": {
    "description": "Werkstatt-Einstellungen (GLOBAL per werkstattId)",
    "multiTenant": false,
    "fields": {
      "werkstattName": { "type": "string" },
      "adresse": { "type": "object" },
      "bankdaten": { "type": "object" },
      "steuernummer": { "type": "string" },
      "emailSettings": { "type": "object" }
    }
  },

  "einstellungen": {
    "description": "Alternative Settings-Collection (Multi-Tenant)",
    "fields": {
      "key": { "type": "string" },
      "value": { "type": "any" }
    }
  },

  "guidelines": {
    "description": "Wissensdatenbank-Richtlinien (Multi-Tenant)",
    "fields": {
      "titel": { "type": "string", "required": true },
      "inhalt": { "type": "string" },
      "kategorie": { "type": "string" },
      "erstelltVon": { "type": "string" },
      "erstelltAm": { "type": "timestamp" }
    }
  },

  "announcements": {
    "description": "Ankündigungen (Multi-Tenant)",
    "fields": {
      "titel": { "type": "string", "required": true },
      "inhalt": { "type": "string" },
      "wichtig": { "type": "boolean" },
      "gueltigBis": { "type": "timestamp" }
    }
  },

  "shift_handovers": {
    "description": "Schichtübergaben (Multi-Tenant)",
    "fields": {
      "vonMitarbeiterId": { "type": "string" },
      "zuMitarbeiterId": { "type": "string" },
      "datum": { "type": "timestamp" },
      "notizen": { "type": "string" },
      "offenePunkte": { "type": "array" }
    }
  },

  "demontage_anleitungen": {
    "description": "Demontage-Anleitungen (Multi-Tenant)",
    "fields": {
      "fahrzeugTyp": { "type": "string" },
      "bauteil": { "type": "string" },
      "schritte": { "type": "array" },
      "bilder": { "type": "array" }
    }
  },

  "categories": {
    "description": "Wissensdatenbank-Kategorien (Multi-Tenant)",
    "fields": {
      "name": { "type": "string", "required": true },
      "beschreibung": { "type": "string" },
      "sortierung": { "type": "number" }
    }
  },

  "partnerAutoLoginTokens": {
    "description": "Auto-Login Tokens für Partner (GLOBAL)",
    "multiTenant": false,
    "fields": {
      "token": { "type": "string", "required": true },
      "partnerId": { "type": "string" },
      "anfrageId": { "type": "string" },
      "werkstattId": { "type": "string" },
      "expiresAt": { "type": "timestamp" }
    },
    "note": "7-Tage TTL, wird von Cloud Function validiert"
  },

  "email_logs": {
    "description": "Email-Protokolle (GLOBAL)",
    "multiTenant": false,
    "fields": {
      "to": { "type": "string" },
      "subject": { "type": "string" },
      "status": { "type": "string" },
      "sentAt": { "type": "timestamp" },
      "messageId": { "type": "string" }
    }
  },

  "emailRetryQueue": {
    "description": "Email-Retry-Queue (GLOBAL)",
    "multiTenant": false,
    "fields": {
      "emailData": { "type": "object" },
      "retryCount": { "type": "number" },
      "lastError": { "type": "string" },
      "nextRetryAt": { "type": "timestamp" }
    }
  }
}
