{"date":"2025-12-11T10:00:00+01:00","type":"setup","category":"meta-learning","pattern":"Meta-Learning System implementiert","context":"Hooks, Rules, Session-Reminder für persistentes Wissen","files":[".claude/settings.json",".claude/session-reminder.md",".claude/rules/*"],"impact":"high","learned_by":"system"}
{"date":"2025-12-11T10:00:01+01:00","type":"pattern","category":"multi-tenant","pattern":"IMMER window.getCollection() verwenden","context":"Direkter db.collection() Zugriff führt zu Daten-Leaks zwischen Werkstätten","files":["firebase-config.js"],"impact":"critical","learned_by":"production-bug"}
{"date":"2025-12-11T10:00:02+01:00","type":"pattern","category":"firebase","pattern":"await window.firebaseInitialized vor Firebase-Ops","context":"Race Condition ohne await führt zu undefined werkstattId","files":["*.html","*.js"],"impact":"high","learned_by":"production-bug"}
{"date":"2025-12-11T10:00:03+01:00","type":"gotcha","category":"data-integrity","pattern":"serviceTyp ist READ-ONLY nach Erstellung","context":"Überschreiben führt zu Datenverlust im Kanban - Fahrzeug verschwindet","files":["kanban.html","annahme.html"],"impact":"critical","learned_by":"production-bug"}
{"date":"2025-12-11T10:00:04+01:00","type":"gotcha","category":"validation","pattern":"Bug-Screening hat 75% false positive rate","context":"IMMER im Code verifizieren bevor Fix implementiert wird","files":["*"],"impact":"medium","learned_by":"experience"}
{"date":"2025-12-11T10:00:05+01:00","type":"pattern","category":"testing","pattern":"npm run test:all MUSS 100% sein vor Push","context":"56 Tests - Integration + Smoke - keine Ausnahmen","files":["tests/*"],"impact":"critical","learned_by":"process"}
{"date":"2025-12-11T23:28:13+01:00","type":"learning","category":"meta-learning","pattern":"Meta-Learning System erfolgreich getestet","context":"Alle Komponenten funktionieren: Hooks, Rules, Learnings","files":[".claude/*"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:36:45+01:00","type":"learning","category":"meta-learning","pattern":"Codebase-Weltmodell implementiert","context":"file-map, dependencies, hotspots, patterns-by-file + Query-Script für strukturiertes Codebase-Verständnis","files":[".claude/world-model/*"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:45:54+01:00","type":"learning","category":"meta-learning","pattern":"Erweitertes Weltmodell implementiert","context":"update.sh, analyze-complexity.sh, analyze-learnings.py, predict-bugs.py, session-tracker.sh, context-generator.sh","files":[".claude/world-model/*"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:35+01:00","type":"learning","category":"gotcha","pattern":"Tagesplanung bounds check","context":"T1 & T2 Arrays müssen bounds-gecheckt werden bevor Index-Zugriff","files":["tagesplanung.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:36+01:00","type":"learning","category":"pattern","pattern":"Collection Sync fahrzeuge/partnerAnfragen","context":"Bei Verschiebung müssen BEIDE Collections (fahrzeuge UND partnerAnfragen) aktualisiert werden","files":["tagesplanung.html,kanban.html"],"impact":"critical","learned_by":"developer"}
{"date":"2025-12-11T23:54:36+01:00","type":"learning","category":"gotcha","pattern":"Invalid Date Prevention","context":"Firestore Timestamps mit toDate() oder new Date() prüfen - formatFirestoreDate() Helper nutzen","files":["kanban.html,partner-app/*"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:44+01:00","type":"learning","category":"pattern","pattern":"Queue-Position Reset bei Fertig","context":"Bei Multi-Service Workflow: queuePosition auf 1 setzen wenn Service fertig und nächster beginnt","files":["kanban.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:46+01:00","type":"learning","category":"gotcha","pattern":"Leihfahrzeug-Objekt Zugriff","context":"leihfahrzeug ist ein Object mit kennzeichen-Property, nicht direkt ein String","files":["kanban.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-11T23:54:46+01:00","type":"learning","category":"gotcha","pattern":"servicePlan Array-Format","context":"servicePlan kann Array von Objects oder Array von Strings sein - beide Formate prüfen","files":["tagesplanung.html,kanban.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:55+01:00","type":"learning","category":"pattern","pattern":"additionalServices in Berechnungen","context":"Bei Service-Logik immer auch additionalServices Array berücksichtigen, nicht nur Haupt-serviceTyp","files":["tagesplanung.html,kanban.html,annahme.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:55+01:00","type":"learning","category":"pattern","pattern":"Pipeline Status-Gating","context":"Status-Übergänge validieren - nicht jeder Status ist von jedem anderen erreichbar","files":["kanban.html,functions/index.js"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:54:56+01:00","type":"learning","category":"gotcha","pattern":"fertigstellungsdatum bei Verschiebung","context":"Beim Verschieben von Terminen auch fertigstellungsdatum und geplantesAbnahmeDatum aktualisieren","files":["tagesplanung.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:56:41+01:00","type":"learning","category":"pattern","pattern":"Security Rules Order","context":"Spezifischere Rules MÜSSEN vor generischen Wildcard-Rules stehen (z.B. bonusAuszahlungen vor generischer Collection-Rule)","files":["firestore.rules"],"impact":"critical","learned_by":"developer"}
{"date":"2025-12-11T23:56:42+01:00","type":"learning","category":"pattern","pattern":"Custom Claims Priority","context":"getUserRole() prüft erst Custom Claims (schneller), dann Firestore Fallback - verhindert zu viele get() Calls","files":["firestore.rules"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:56:43+01:00","type":"learning","category":"gotcha","pattern":"Partner ohne Firebase Auth","context":"Partner nutzen KEIN Firebase Auth - Storage Rules für partner-anfragen/ haben daher keinen Auth-Check, nur Size+MIME Validation","files":["storage.rules,partner-app/*"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:57:50+01:00","type":"learning","category":"gotcha","pattern":"truncateText null check","context":"truncateText() muss null/undefined Input handeln bevor .substring() aufgerufen wird","files":["*.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-11T23:57:51+01:00","type":"learning","category":"gotcha","pattern":"getCollection vs getCollectionName","context":"getCollection() gibt db.collection() zurück, getCollectionName() nur den String - verwechseln führt zu Fehlern","files":["abteilungs-queue.html,*.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:57:53+01:00","type":"learning","category":"pattern","pattern":"Toast API Migration","context":"showToast() ist deprecated - verwende toast.success(), toast.error(), toast.warning()","files":["*.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-11T23:58:03+01:00","type":"learning","category":"pattern","pattern":"Leihfahrzeug Datum Fallbacks","context":"Leihfahrzeug-Übergabe hat 4 Fallbacks: abholdatum, anliefertermin, fertigstellungsdatum, geplantesAbnahmeDatum","files":["kanban.html,tagesplanung.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:58:04+01:00","type":"learning","category":"gotcha","pattern":"servicePlan aus Entwurf übernehmen","context":"Beim Erstellen eines Fahrzeugs aus Entwurf muss servicePlan explizit kopiert werden","files":["annahme.html,entwuerfe-bearbeiten.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:58:05+01:00","type":"learning","category":"gotcha","pattern":"ersatzfahrzeugGewuenscht Variable","context":"Variable heißt ersatzfahrzeugGewuenscht (nicht ersatzFahrzeug oder leihfahrzeug) - führt zu prozessStatus: anlieferung","files":["annahme.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-11T23:59:37+01:00","type":"learning","category":"pattern","pattern":"Firestore Timestamp vs ISO String","context":"56 korrekte Timestamp.now() vs 414 toISOString() - bei Datum-Feldern die sortiert werden müssen Timestamp verwenden","files":["*.html,*.js"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-11T23:59:38+01:00","type":"learning","category":"pattern","pattern":"safeNavigate Pattern","context":"261 Verwendungen von safeNavigate() - für Navigation mit Listener-Cleanup verwenden statt window.location.href","files":["*.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-12T00:02:49+01:00","type":"learning","category":"pattern","pattern":"Cloud Functions - 36 Exports","context":"36 Cloud Functions: 9 Firestore Triggers, 5 Scheduled, 22 HTTP - bei neuen Functions auf Rate Limiting achten","files":["functions/index.js"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:02:49+01:00","type":"learning","category":"testing","pattern":"Test Coverage","context":"71 Tests: 55 Integration (6 Dateien), 16 Smoke - npm run test:all muss 100% sein","files":["tests/*"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:02:50+01:00","type":"learning","category":"pattern","pattern":"Error Handling Stats","context":"991 try-catch Blöcke, 1197 console.error, 67 toast.error - konsistentes Error Handling Pattern verwenden","files":["*.html,*.js"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-12T00:02:57+01:00","type":"learning","category":"pattern","pattern":"Partner-App 10 Service-Formulare","context":"10 Service-spezifische Formulare (1148-2267 Zeilen) - bei Änderungen alle prüfen","files":["partner-app/*-anfrage.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-12T00:02:58+01:00","type":"learning","category":"pattern","pattern":"191 Modal-Dialoge","context":"191 Modal-Dialoge im Projekt - einheitliches Modal-Pattern mit close-Button und Overlay-Click verwenden","files":["*.html"],"impact":"low","learned_by":"developer"}
{"date":"2025-12-12T00:04:26+01:00","type":"learning","category":"pattern","pattern":"window.werkstattId Init","context":"window.werkstattId wird 61x gesetzt - IMMER await window.firebaseInitialized VOR Zugriff","files":["*.html"],"impact":"critical","learned_by":"developer"}
{"date":"2025-12-12T00:04:27+01:00","type":"learning","category":"gotcha","pattern":"escapeHtml Definitionen","context":"3 escapeHtml Definitionen (kalkulation, functions, global-chat) - einheitliche Version aus js/utils/escape-html.js verwenden","files":["kalkulation.html,functions/index.js"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-12T00:14:33+01:00","type":"learning","category":"pattern","pattern":"571 async functions","context":"571 async Funktionen - IMMER try-catch verwenden, besonders bei Firebase-Operationen","files":["*.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:14:34+01:00","type":"learning","category":"pattern","pattern":"localStorage 475x genutzt","context":"localStorage für werkstattId, selectedMitarbeiterId, theme - bei Login/Logout korrekt setzen/clearen","files":["*.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:14:35+01:00","type":"learning","category":"pattern","pattern":"2180 Fallback-Werte","context":"2180 Fallback-Patterns (|| und ??) - defensive Coding Standard in dieser Codebase","files":["*.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-17T12:00:00+01:00","type":"fix","category":"gotcha","pattern":"Auftragsstart Fallback-Chain: anliefertermin ZUERST (ist START), nicht abholtermin (ist END)","context":"saveVerschiebung setzt anliefertermin=firstService.datum und abholtermin=lastService.datum. Die Fallback-Chain muss anliefertermin ZUERST prüfen: anliefertermin || abholdatum || geplantesStartDatum","files":["kanban.html","tagesplanung.html"],"impact":"high","learned_by":"production-bug"}
{"date":"2025-12-12T00:14:48+01:00","type":"learning","category":"pattern","pattern":"Queue Management 505 Refs","context":"505 Queue-Referenzen - abteilungs_queue, tagesplanung_queue, kanban_columns - bei Änderungen Konsistenz prüfen","files":["tagesplanung.html,kanban.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:14:49+01:00","type":"learning","category":"gotcha","pattern":"setTimeout/setInterval 277x","context":"277 Timer-Aufrufe - clearTimeout/clearInterval bei Cleanup nicht vergessen (Memory Leak Gefahr)","files":["*.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-12T00:14:50+01:00","type":"learning","category":"pattern","pattern":"prozessStatus 134 Refs","context":"prozessStatus: anlieferung|selbstbringer|abholung - wird durch ersatzfahrzeugGewuenscht/abholserviceGewuenscht bestimmt","files":["annahme.html,kanban.html"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:15:02+01:00","type":"learning","category":"pattern","pattern":"DAT PDF Import 120 Refs","context":"DAT-PDF Import: uploadPdf → parseDATPDF (GPT-4 Vision) → fillFormFromPdf - OpenAI Key erforderlich","files":["annahme.html,entwuerfe-bearbeiten.html,functions/index.js"],"impact":"high","learned_by":"developer"}
{"date":"2025-12-12T00:15:02+01:00","type":"learning","category":"pattern","pattern":"SortableJS Drag&Drop","context":"40 draggable + 35 Sortable Refs - SortableJS Library für Queue-Reordering im Kanban","files":["kanban.html,tagesplanung.html"],"impact":"medium","learned_by":"developer"}
{"date":"2025-12-12T00:15:03+01:00","type":"learning","category":"gotcha","pattern":"Firefox/Safari Kompatibilität","context":"Firefox 69%, Safari Mobile 74% Testrate - Optional Chaining (?) in älteren Browsern problematisch","files":["*.html"],"impact":"medium","learned_by":"developer"}
{"date":"2026-01-09T22:20:17+01:00","type":"learning","category":"feature","pattern":"Draft Auto-Save für Partner-Formulare","context":"localStorage Auto-Save alle 30s in allen partner-app/*-anfrage.html","files":["partner-app/*-anfrage.html"],"impact":"high","learned_by":"developer"}
