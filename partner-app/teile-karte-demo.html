<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isometrische Teile-Karte - SilverDAT Style</title>
    <style>
        :root {
            --bg-color: #e8e8e8;
            --card-bg: #ffffff;
            --text-color: #333333;
            --text-secondary: #666666;
            --border-color: #d0d0d0;
            --accent-color: #2563eb;
            --accent-hover: #1d4ed8;
            --selected-color: #dc2626;
            --selected-hover: #b91c1c;
            --shadow: 0 4px 20px rgba(0,0,0,0.1);

            /* Part Colors */
            --karosserie-fill: #c4c4c4;
            --karosserie-stroke: #888888;
            --glas-fill: rgba(135, 206, 235, 0.6);
            --glas-stroke: #5cacee;
            --innenraum-fill: #d4a574;
            --innenraum-stroke: #8b6914;
            --mechanik-fill: #4a4a4a;
            --mechanik-stroke: #2a2a2a;
            --rad-fill: #333333;
            --rad-stroke: #1a1a1a;
            --beleuchtung-fill: #fffacd;
            --beleuchtung-stroke: #ffd700;
            --ruecklicht-fill: #ff6b6b;
            --ruecklicht-stroke: #cc0000;

            /* Category Colors for Legend */
            --cat-karosserie: #3498db;
            --cat-verglasung: #9b59b6;
            --cat-beleuchtung: #f1c40f;
            --cat-innenraum: #e67e22;
            --cat-mechanik: #2c3e50;
        }

        [data-theme="dark"] {
            --bg-color: #0f172a;
            --card-bg: #1e293b;
            --text-color: #e2e8f0;
            --text-secondary: #94a3b8;
            --border-color: #334155;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --selected-color: #ef4444;
            --selected-hover: #dc2626;
            --shadow: 0 4px 20px rgba(0,0,0,0.4);

            --karosserie-fill: #475569;
            --karosserie-stroke: #64748b;
            --glas-fill: rgba(100, 149, 237, 0.4);
            --glas-stroke: #6495ed;
            --innenraum-fill: #78350f;
            --innenraum-stroke: #92400e;
            --mechanik-fill: #1f2937;
            --mechanik-stroke: #374151;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--bg-color);
            color: var(--text-color);
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 15px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            background: var(--card-bg);
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 15px;
        }

        .header h1 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .theme-toggle, .view-mode-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 14px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            color: var(--text-color);
            transition: all 0.2s ease;
        }

        .theme-toggle:hover, .view-mode-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        .view-mode-btn.active {
            background: var(--accent-color);
            color: white;
        }

        /* Main Layout */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 15px;
        }

        @media (max-width: 1100px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        /* Car Container */
        .car-container {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
        }

        .controls-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .category-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .category-btn {
            padding: 6px 12px;
            border: 2px solid var(--border-color);
            border-radius: 20px;
            background: var(--bg-color);
            cursor: pointer;
            font-size: 0.8rem;
            color: var(--text-color);
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .category-btn:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        .category-btn.active {
            background: var(--accent-color);
            border-color: var(--accent-color);
            color: white;
        }

        .category-btn .dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .zoom-controls {
            display: flex;
            gap: 5px;
        }

        .zoom-btn {
            width: 32px;
            height: 32px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            background: var(--bg-color);
            cursor: pointer;
            font-size: 1.1rem;
            color: var(--text-color);
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: var(--accent-color);
            color: white;
        }

        /* SVG Container */
        .svg-wrapper {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
            background: linear-gradient(135deg, var(--bg-color) 0%, var(--card-bg) 100%);
            min-height: 500px;
        }

        .svg-container {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            transform-origin: center center;
            transition: transform 0.3s ease;
        }

        .car-svg {
            max-width: 100%;
            height: auto;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.2));
        }

        /* Part Styling */
        .car-part {
            cursor: pointer;
            transition: all 0.15s ease;
            stroke-linejoin: round;
        }

        .car-part:hover {
            filter: brightness(1.2);
            stroke-width: 3;
        }

        .car-part.selected {
            stroke: var(--selected-color) !important;
            stroke-width: 4;
            filter: drop-shadow(0 0 8px var(--selected-color));
        }

        .car-part.dimmed {
            opacity: 0.2;
            pointer-events: none;
        }

        /* Karosserie */
        .part-karosserie {
            fill: var(--karosserie-fill);
            stroke: var(--karosserie-stroke);
            stroke-width: 2;
        }

        /* Verglasung */
        .part-glas {
            fill: var(--glas-fill);
            stroke: var(--glas-stroke);
            stroke-width: 1.5;
        }

        /* Innenraum */
        .part-innenraum {
            fill: var(--innenraum-fill);
            stroke: var(--innenraum-stroke);
            stroke-width: 1.5;
        }

        /* Mechanik */
        .part-mechanik {
            fill: var(--mechanik-fill);
            stroke: var(--mechanik-stroke);
            stroke-width: 2;
        }

        /* Beleuchtung */
        .part-beleuchtung {
            fill: var(--beleuchtung-fill);
            stroke: var(--beleuchtung-stroke);
            stroke-width: 1.5;
        }

        .part-ruecklicht {
            fill: var(--ruecklicht-fill);
            stroke: var(--ruecklicht-stroke);
            stroke-width: 1.5;
        }

        /* R√§der */
        .part-rad {
            fill: var(--rad-fill);
            stroke: var(--rad-stroke);
            stroke-width: 2;
        }

        /* Static Elements (non-clickable) */
        .car-outline {
            fill: none;
            stroke: var(--karosserie-stroke);
            stroke-width: 1;
            opacity: 0.3;
        }

        /* Sidebar */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .sidebar-card {
            background: var(--card-bg);
            border-radius: 12px;
            padding: 15px;
            box-shadow: var(--shadow);
        }

        .sidebar-card h3 {
            font-size: 0.95rem;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .parts-count {
            background: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75rem;
            margin-left: auto;
        }

        /* Selected List */
        .selected-list {
            list-style: none;
            max-height: 250px;
            overflow-y: auto;
        }

        .selected-list::-webkit-scrollbar {
            width: 6px;
        }

        .selected-list::-webkit-scrollbar-track {
            background: var(--bg-color);
            border-radius: 3px;
        }

        .selected-list::-webkit-scrollbar-thumb {
            background: var(--border-color);
            border-radius: 3px;
        }

        .selected-list li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 10px;
            margin-bottom: 6px;
            background: var(--bg-color);
            border-radius: 6px;
            font-size: 0.85rem;
            animation: slideIn 0.2s ease;
        }

        .selected-list li .category-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .selected-list li .part-info {
            display: flex;
            align-items: center;
            flex: 1;
        }

        .selected-list li .remove-btn {
            background: none;
            border: none;
            color: var(--selected-color);
            cursor: pointer;
            font-size: 1.1rem;
            padding: 0 5px;
            opacity: 0.7;
            transition: all 0.2s ease;
        }

        .selected-list li .remove-btn:hover {
            opacity: 1;
            transform: scale(1.2);
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-10px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .empty-state {
            text-align: center;
            padding: 20px;
            color: var(--text-secondary);
            font-size: 0.85rem;
        }

        .empty-state .icon {
            font-size: 2rem;
            margin-bottom: 8px;
        }

        /* Quick Select */
        .quick-select {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .quick-select h4 {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .quick-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .quick-btn {
            padding: 5px 10px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.75rem;
            color: var(--text-color);
            transition: all 0.2s ease;
        }

        .quick-btn:hover {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }

        /* Action Buttons */
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--accent-hover);
        }

        .btn-danger {
            background: var(--selected-color);
            color: white;
        }

        .btn-danger:hover {
            background: var(--selected-hover);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-outline:hover {
            border-color: var(--accent-color);
            color: var(--accent-color);
        }

        /* Legend */
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .legend-color {
            width: 14px;
            height: 14px;
            border-radius: 3px;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: var(--card-bg);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            box-shadow: var(--shadow);
            pointer-events: none;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.15s ease;
            border: 1px solid var(--border-color);
            max-width: 200px;
        }

        .tooltip.visible {
            opacity: 1;
        }

        .tooltip .tooltip-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .tooltip .tooltip-category {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        /* Stats */
        .stats-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.8rem;
        }

        .stats-row:last-child {
            border-bottom: none;
        }

        .stats-label {
            color: var(--text-secondary);
        }

        .stats-value {
            font-weight: 600;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>
                <span>üöó</span>
                Isometrische Teile-Karte
                <span style="font-size: 0.7rem; color: var(--text-secondary); font-weight: normal;">(SilverDAT Style)</span>
            </h1>
            <div class="header-controls">
                <button class="view-mode-btn active" id="explodedBtn" onclick="setViewMode('exploded')">
                    üí• Explosionsansicht
                </button>
                <button class="view-mode-btn" id="assembledBtn" onclick="setViewMode('assembled')">
                    üöô Kompakt
                </button>
                <button class="theme-toggle" onclick="toggleTheme()">
                    <span id="themeIcon">üåô</span>
                    <span id="themeText">Dark</span>
                </button>
            </div>
        </header>

        <div class="main-content">
            <div class="car-container">
                <div class="controls-row">
                    <div class="category-filters">
                        <button class="category-btn active" data-category="all" onclick="filterCategory('all')">
                            Alle
                        </button>
                        <button class="category-btn" data-category="karosserie" onclick="filterCategory('karosserie')">
                            <span class="dot" style="background: var(--cat-karosserie)"></span>
                            Karosserie
                        </button>
                        <button class="category-btn" data-category="verglasung" onclick="filterCategory('verglasung')">
                            <span class="dot" style="background: var(--cat-verglasung)"></span>
                            Verglasung
                        </button>
                        <button class="category-btn" data-category="beleuchtung" onclick="filterCategory('beleuchtung')">
                            <span class="dot" style="background: var(--cat-beleuchtung)"></span>
                            Beleuchtung
                        </button>
                        <button class="category-btn" data-category="innenraum" onclick="filterCategory('innenraum')">
                            <span class="dot" style="background: var(--cat-innenraum)"></span>
                            Innenraum
                        </button>
                        <button class="category-btn" data-category="mechanik" onclick="filterCategory('mechanik')">
                            <span class="dot" style="background: var(--cat-mechanik)"></span>
                            Mechanik
                        </button>
                    </div>
                    <div class="zoom-controls">
                        <button class="zoom-btn" onclick="zoomIn()">+</button>
                        <button class="zoom-btn" onclick="zoomOut()">‚àí</button>
                        <button class="zoom-btn" onclick="resetZoom()">‚ü≤</button>
                    </div>
                </div>

                <div class="svg-wrapper">
                    <div class="svg-container" id="svgContainer">
                        <!-- Isometric SVG -->
                        <svg viewBox="0 0 900 700" class="car-svg" id="carSvg">
                            <!-- Background Grid (subtle) -->
                            <defs>
                                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="var(--border-color)" stroke-width="0.5" opacity="0.3"/>
                                </pattern>
                            </defs>

                            <!-- ============================================ -->
                            <!-- FAHRZEUG - ISOMETRISCHE EXPLOSIONSANSICHT -->
                            <!-- ============================================ -->

                            <!-- LAYER 1: FAHRWERK & MECHANIK (unten) -->
                            <g id="layer-mechanik" class="exploded-layer" data-explode-y="80">
                                <!-- Vorderachse -->
                                <g class="car-part part-mechanik" data-part="vorderachse" data-category="mechanik">
                                    <path d="M 200 520 L 280 480 L 400 480 L 480 520 L 400 530 L 280 530 Z"/>
                                    <rect x="230" y="495" width="220" height="20" rx="5" fill="var(--mechanik-fill)"/>
                                </g>

                                <!-- Hinterachse -->
                                <g class="car-part part-mechanik" data-part="hinterachse" data-category="mechanik">
                                    <path d="M 500 540 L 580 500 L 700 500 L 780 540 L 700 550 L 580 550 Z"/>
                                    <rect x="530" y="515" width="220" height="20" rx="5" fill="var(--mechanik-fill)"/>
                                </g>

                                <!-- Auspuffanlage -->
                                <g class="car-part part-mechanik" data-part="auspuff" data-category="mechanik">
                                    <path d="M 400 560 L 750 560 L 760 570 L 780 570 L 780 580 L 400 580 Z"/>
                                    <ellipse cx="770" cy="575" rx="15" ry="8"/>
                                </g>

                                <!-- Kraftstofftank -->
                                <rect class="car-part part-mechanik" data-part="tank" data-category="mechanik"
                                    x="550" y="530" width="100" height="40" rx="8"/>

                                <!-- Motor -->
                                <g class="car-part part-mechanik" data-part="motor" data-category="mechanik">
                                    <path d="M 220 430 L 280 400 L 400 400 L 460 430 L 460 500 L 400 530 L 280 530 L 220 500 Z"/>
                                    <rect x="290" y="430" width="100" height="60" rx="5" fill="#3a3a3a"/>
                                    <rect x="310" y="410" width="60" height="25" rx="3" fill="#5a5a5a"/>
                                </g>

                                <!-- Getriebe -->
                                <g class="car-part part-mechanik" data-part="getriebe" data-category="mechanik">
                                    <path d="M 400 450 L 450 420 L 520 420 L 570 450 L 570 510 L 520 540 L 450 540 L 400 510 Z"/>
                                </g>

                                <!-- K√ºhler -->
                                <rect class="car-part part-mechanik" data-part="kuehler" data-category="mechanik"
                                    x="180" y="390" width="80" height="60" rx="5"/>

                                <!-- Batterie -->
                                <rect class="car-part part-mechanik" data-part="batterie" data-category="mechanik"
                                    x="420" y="390" width="50" height="40" rx="3"/>

                                <!-- Klimakompressor -->
                                <ellipse class="car-part part-mechanik" data-part="klimakompressor" data-category="mechanik"
                                    cx="350" cy="480" rx="30" ry="20"/>
                            </g>

                            <!-- LAYER 2: R√ÑDER -->
                            <g id="layer-raeder">
                                <!-- Rad vorne links -->
                                <g class="car-part part-rad" data-part="rad-vl" data-category="mechanik">
                                    <ellipse cx="180" cy="420" rx="50" ry="30"/>
                                    <ellipse cx="180" cy="420" rx="30" ry="18" fill="#555"/>
                                    <ellipse cx="180" cy="420" rx="15" ry="9" fill="#333"/>
                                </g>

                                <!-- Rad vorne rechts -->
                                <g class="car-part part-rad" data-part="rad-vr" data-category="mechanik">
                                    <ellipse cx="500" cy="380" rx="50" ry="30"/>
                                    <ellipse cx="500" cy="380" rx="30" ry="18" fill="#555"/>
                                    <ellipse cx="500" cy="380" rx="15" ry="9" fill="#333"/>
                                </g>

                                <!-- Rad hinten links -->
                                <g class="car-part part-rad" data-part="rad-hl" data-category="mechanik">
                                    <ellipse cx="480" cy="480" rx="50" ry="30"/>
                                    <ellipse cx="480" cy="480" rx="30" ry="18" fill="#555"/>
                                    <ellipse cx="480" cy="480" rx="15" ry="9" fill="#333"/>
                                </g>

                                <!-- Rad hinten rechts -->
                                <g class="car-part part-rad" data-part="rad-hr" data-category="mechanik">
                                    <ellipse cx="780" cy="440" rx="50" ry="30"/>
                                    <ellipse cx="780" cy="440" rx="30" ry="18" fill="#555"/>
                                    <ellipse cx="780" cy="440" rx="15" ry="9" fill="#333"/>
                                </g>

                                <!-- Bremsen -->
                                <circle class="car-part part-mechanik" data-part="bremse-vl" data-category="mechanik"
                                    cx="180" cy="420" r="20" fill="#8b0000" stroke="#5a0000"/>
                                <circle class="car-part part-mechanik" data-part="bremse-vr" data-category="mechanik"
                                    cx="500" cy="380" r="20" fill="#8b0000" stroke="#5a0000"/>
                                <circle class="car-part part-mechanik" data-part="bremse-hl" data-category="mechanik"
                                    cx="480" cy="480" r="20" fill="#8b0000" stroke="#5a0000"/>
                                <circle class="car-part part-mechanik" data-part="bremse-hr" data-category="mechanik"
                                    cx="780" cy="440" r="20" fill="#8b0000" stroke="#5a0000"/>
                            </g>

                            <!-- LAYER 3: INNENRAUM -->
                            <g id="layer-innenraum" class="exploded-layer" data-explode-y="-60">
                                <!-- Fahrersitz -->
                                <g class="car-part part-innenraum" data-part="sitz-fahrer" data-category="innenraum">
                                    <path d="M 280 280 L 320 260 L 380 260 L 420 280 L 420 340 L 380 360 L 320 360 L 280 340 Z"/>
                                    <path d="M 290 290 L 320 275 L 370 275 L 400 290 L 400 330 L 370 345 L 320 345 L 290 330 Z" fill="#a0522d"/>
                                </g>

                                <!-- Beifahrersitz -->
                                <g class="car-part part-innenraum" data-part="sitz-beifahrer" data-category="innenraum">
                                    <path d="M 420 250 L 460 230 L 520 230 L 560 250 L 560 310 L 520 330 L 460 330 L 420 310 Z"/>
                                    <path d="M 430 260 L 460 245 L 510 245 L 540 260 L 540 300 L 510 315 L 460 315 L 430 300 Z" fill="#a0522d"/>
                                </g>

                                <!-- R√ºcksitzbank -->
                                <g class="car-part part-innenraum" data-part="ruecksitzbank" data-category="innenraum">
                                    <path d="M 500 320 L 560 290 L 700 290 L 760 320 L 760 380 L 700 410 L 560 410 L 500 380 Z"/>
                                    <path d="M 520 330 L 570 305 L 690 305 L 740 330 L 740 370 L 690 395 L 570 395 L 520 370 Z" fill="#a0522d"/>
                                </g>

                                <!-- Armaturenbrett -->
                                <g class="car-part part-innenraum" data-part="armaturenbrett" data-category="innenraum">
                                    <path d="M 200 220 L 280 180 L 550 180 L 630 220 L 630 250 L 550 290 L 280 290 L 200 250 Z"/>
                                    <rect x="350" y="200" width="100" height="40" rx="5" fill="#2a2a2a"/>
                                    <rect x="280" y="210" width="50" height="30" rx="3" fill="#1a1a1a"/>
                                </g>

                                <!-- Lenkrad -->
                                <g class="car-part part-innenraum" data-part="lenkrad" data-category="innenraum">
                                    <ellipse cx="300" cy="240" rx="35" ry="25" fill="#2a2a2a" stroke="#1a1a1a" stroke-width="3"/>
                                    <ellipse cx="300" cy="240" rx="20" ry="14" fill="none" stroke="#3a3a3a" stroke-width="8"/>
                                </g>

                                <!-- Mittelkonsole -->
                                <rect class="car-part part-innenraum" data-part="mittelkonsole" data-category="innenraum"
                                    x="380" y="260" width="60" height="100" rx="5"/>

                                <!-- Himmel -->
                                <path class="car-part part-innenraum" data-part="himmel" data-category="innenraum"
                                    d="M 250 100 L 340 60 L 680 60 L 770 100 L 770 130 L 680 170 L 340 170 L 250 130 Z"
                                    fill="#e8e8e8" stroke="#cccccc"/>

                                <!-- T√ºrverkleidungen -->
                                <rect class="car-part part-innenraum" data-part="tuerverkleidung-vl" data-category="innenraum"
                                    x="220" y="250" width="20" height="100" rx="3" fill="#8b7355"/>
                                <rect class="car-part part-innenraum" data-part="tuerverkleidung-vr" data-category="innenraum"
                                    x="590" y="220" width="20" height="100" rx="3" fill="#8b7355"/>
                                <rect class="car-part part-innenraum" data-part="tuerverkleidung-hl" data-category="innenraum"
                                    x="440" y="320" width="20" height="100" rx="3" fill="#8b7355"/>
                                <rect class="car-part part-innenraum" data-part="tuerverkleidung-hr" data-category="innenraum"
                                    x="770" y="290" width="20" height="100" rx="3" fill="#8b7355"/>
                            </g>

                            <!-- LAYER 4: KAROSSERIE UNTEN -->
                            <g id="layer-karosserie-unten">
                                <!-- Schweller links -->
                                <path class="car-part part-karosserie" data-part="schweller-l" data-category="karosserie"
                                    d="M 200 380 L 230 360 L 500 360 L 530 380 L 530 400 L 500 420 L 230 420 L 200 400 Z"/>

                                <!-- Schweller rechts -->
                                <path class="car-part part-karosserie" data-part="schweller-r" data-category="karosserie"
                                    d="M 520 340 L 550 320 L 820 320 L 850 340 L 850 360 L 820 380 L 550 380 L 520 360 Z"/>
                            </g>

                            <!-- LAYER 5: T√úREN -->
                            <g id="layer-tueren" class="exploded-layer" data-explode-x="-40">
                                <!-- T√ºr vorne links -->
                                <path class="car-part part-karosserie" data-part="tuer-vl" data-category="karosserie"
                                    d="M 200 200 L 280 160 L 400 160 L 480 200 L 480 350 L 400 390 L 280 390 L 200 350 Z"/>

                                <!-- T√ºr hinten links -->
                                <path class="car-part part-karosserie" data-part="tuer-hl" data-category="karosserie"
                                    d="M 400 200 L 480 160 L 600 160 L 680 200 L 680 350 L 600 390 L 480 390 L 400 350 Z"/>
                            </g>

                            <g id="layer-tueren-rechts" class="exploded-layer" data-explode-x="40">
                                <!-- T√ºr vorne rechts -->
                                <path class="car-part part-karosserie" data-part="tuer-vr" data-category="karosserie"
                                    d="M 480 170 L 560 130 L 680 130 L 760 170 L 760 320 L 680 360 L 560 360 L 480 320 Z"/>

                                <!-- T√ºr hinten rechts -->
                                <path class="car-part part-karosserie" data-part="tuer-hr" data-category="karosserie"
                                    d="M 680 170 L 760 130 L 880 130 L 850 170 L 850 320 L 880 360 L 760 360 L 680 320 Z"/>
                            </g>

                            <!-- LAYER 6: KOTFL√úGEL -->
                            <g id="layer-kotfluegel">
                                <!-- Kotfl√ºgel vorne links -->
                                <path class="car-part part-karosserie" data-part="kotfluegel-vl" data-category="karosserie"
                                    d="M 150 250 L 200 220 L 280 220 L 200 250 L 200 380 L 150 400 L 100 380 L 100 320 Q 100 270 150 250 Z"/>

                                <!-- Kotfl√ºgel vorne rechts -->
                                <path class="car-part part-karosserie" data-part="kotfluegel-vr" data-category="karosserie"
                                    d="M 480 220 L 560 180 L 600 180 L 600 220 L 560 340 L 480 380 L 440 340 Q 440 280 480 220 Z"/>

                                <!-- Kotfl√ºgel hinten links -->
                                <path class="car-part part-karosserie" data-part="kotfluegel-hl" data-category="karosserie"
                                    d="M 600 250 L 680 220 L 750 220 L 680 250 L 680 420 L 600 460 L 530 420 L 530 320 Q 530 280 600 250 Z"/>

                                <!-- Kotfl√ºgel hinten rechts -->
                                <path class="car-part part-karosserie" data-part="kotfluegel-hr" data-category="karosserie"
                                    d="M 760 220 L 840 180 L 870 180 L 870 220 L 840 380 L 760 420 L 720 380 Q 720 280 760 220 Z"/>
                            </g>

                            <!-- LAYER 7: MOTORHAUBE & HECKKLAPPE -->
                            <g id="layer-hauben" class="exploded-layer" data-explode-y="-80">
                                <!-- Motorhaube -->
                                <path class="car-part part-karosserie" data-part="motorhaube" data-category="karosserie"
                                    d="M 100 180 L 200 130 L 550 130 L 650 180 L 650 220 L 550 270 L 200 270 L 100 220 Z"/>

                                <!-- Heckklappe -->
                                <path class="car-part part-karosserie" data-part="heckklappe" data-category="karosserie"
                                    d="M 750 180 L 830 140 L 870 140 L 870 250 L 830 290 L 750 290 Z"/>
                            </g>

                            <!-- LAYER 8: STO√üSTANGEN -->
                            <g id="layer-stossstangen" class="exploded-layer" data-explode-y="40">
                                <!-- Sto√üstange vorne -->
                                <path class="car-part part-karosserie" data-part="stossstange-vorne" data-category="karosserie"
                                    d="M 80 220 L 140 190 L 580 190 L 640 220 L 640 260 L 580 290 L 140 290 L 80 260 Z"/>

                                <!-- Sto√üstange hinten -->
                                <path class="car-part part-karosserie" data-part="stossstange-hinten" data-category="karosserie"
                                    d="M 750 300 L 810 270 L 880 270 L 880 350 L 810 380 L 750 380 Z"/>
                            </g>

                            <!-- LAYER 9: DACH -->
                            <g id="layer-dach" class="exploded-layer" data-explode-y="-120">
                                <!-- Dach -->
                                <path class="car-part part-karosserie" data-part="dach" data-category="karosserie"
                                    d="M 220 80 L 320 30 L 700 30 L 800 80 L 800 120 L 700 170 L 320 170 L 220 120 Z"/>

                                <!-- A-S√§ule links -->
                                <path class="car-part part-karosserie" data-part="a-saeule-l" data-category="karosserie"
                                    d="M 200 180 L 230 160 L 270 100 L 300 80 L 280 80 L 230 120 L 180 180 Z"/>

                                <!-- A-S√§ule rechts -->
                                <path class="car-part part-karosserie" data-part="a-saeule-r" data-category="karosserie"
                                    d="M 600 150 L 630 130 L 670 70 L 700 50 L 680 50 L 630 90 L 580 150 Z"/>

                                <!-- B-S√§ule links -->
                                <rect class="car-part part-karosserie" data-part="b-saeule-l" data-category="karosserie"
                                    x="395" y="100" width="20" height="160" rx="3" transform="skewY(-15)"/>

                                <!-- B-S√§ule rechts -->
                                <rect class="car-part part-karosserie" data-part="b-saeule-r" data-category="karosserie"
                                    x="675" y="70" width="20" height="150" rx="3" transform="skewY(-15)"/>

                                <!-- C-S√§ule links -->
                                <path class="car-part part-karosserie" data-part="c-saeule-l" data-category="karosserie"
                                    d="M 680 180 L 700 160 L 720 100 L 740 80 L 720 80 L 690 120 L 660 180 Z"/>

                                <!-- C-S√§ule rechts -->
                                <path class="car-part part-karosserie" data-part="c-saeule-r" data-category="karosserie"
                                    d="M 800 150 L 820 130 L 840 80 L 850 60 L 830 60 L 800 100 L 780 150 Z"/>
                            </g>

                            <!-- LAYER 10: VERGLASUNG -->
                            <g id="layer-verglasung" class="exploded-layer" data-explode-y="-100">
                                <!-- Windschutzscheibe -->
                                <path class="car-part part-glas" data-part="windschutzscheibe" data-category="verglasung"
                                    d="M 200 150 L 300 100 L 620 100 L 720 150 L 680 180 L 340 180 L 240 180 Z"/>

                                <!-- Heckscheibe -->
                                <path class="car-part part-glas" data-part="heckscheibe" data-category="verglasung"
                                    d="M 720 130 L 780 100 L 830 100 L 830 180 L 780 210 L 720 180 Z"/>

                                <!-- Seitenscheibe vorne links -->
                                <path class="car-part part-glas" data-part="scheibe-vl" data-category="verglasung"
                                    d="M 250 180 L 300 150 L 380 150 L 380 200 L 300 240 L 250 240 Z"/>

                                <!-- Seitenscheibe vorne rechts -->
                                <path class="car-part part-glas" data-part="scheibe-vr" data-category="verglasung"
                                    d="M 550 150 L 600 120 L 680 120 L 680 170 L 600 210 L 550 210 Z"/>

                                <!-- Seitenscheibe hinten links -->
                                <path class="car-part part-glas" data-part="scheibe-hl" data-category="verglasung"
                                    d="M 400 180 L 450 150 L 580 150 L 580 200 L 450 240 L 400 240 Z"/>

                                <!-- Seitenscheibe hinten rechts -->
                                <path class="car-part part-glas" data-part="scheibe-hr" data-category="verglasung"
                                    d="M 700 150 L 750 120 L 830 120 L 830 170 L 750 210 L 700 210 Z"/>

                                <!-- Dreiecksfenster links -->
                                <polygon class="car-part part-glas" data-part="dreiecksfenster-l" data-category="verglasung"
                                    points="240,180 280,155 280,180"/>

                                <!-- Dreiecksfenster rechts -->
                                <polygon class="car-part part-glas" data-part="dreiecksfenster-r" data-category="verglasung"
                                    points="540,150 580,125 580,150"/>
                            </g>

                            <!-- LAYER 11: BELEUCHTUNG -->
                            <g id="layer-beleuchtung">
                                <!-- Scheinwerfer links -->
                                <ellipse class="car-part part-beleuchtung" data-part="scheinwerfer-l" data-category="beleuchtung"
                                    cx="120" cy="230" rx="35" ry="25"/>

                                <!-- Scheinwerfer rechts -->
                                <ellipse class="car-part part-beleuchtung" data-part="scheinwerfer-r" data-category="beleuchtung"
                                    cx="600" cy="200" rx="35" ry="25"/>

                                <!-- Nebelscheinwerfer links -->
                                <ellipse class="car-part part-beleuchtung" data-part="nebelscheinwerfer-l" data-category="beleuchtung"
                                    cx="100" cy="260" rx="15" ry="12"/>

                                <!-- Nebelscheinwerfer rechts -->
                                <ellipse class="car-part part-beleuchtung" data-part="nebelscheinwerfer-r" data-category="beleuchtung"
                                    cx="620" cy="230" rx="15" ry="12"/>

                                <!-- R√ºckleuchte links -->
                                <rect class="car-part part-ruecklicht" data-part="rueckleuchte-l" data-category="beleuchtung"
                                    x="755" y="250" width="30" height="50" rx="5"/>

                                <!-- R√ºckleuchte rechts -->
                                <rect class="car-part part-ruecklicht" data-part="rueckleuchte-r" data-category="beleuchtung"
                                    x="855" y="220" width="30" height="50" rx="5"/>

                                <!-- 3. Bremsleuchte -->
                                <rect class="car-part part-ruecklicht" data-part="bremsleuchte-3" data-category="beleuchtung"
                                    x="800" y="100" width="40" height="12" rx="3"/>

                                <!-- Blinker Spiegel links -->
                                <rect class="car-part part-beleuchtung" data-part="blinker-spiegel-l" data-category="beleuchtung"
                                    x="190" y="200" width="12" height="8" rx="2"/>

                                <!-- Blinker Spiegel rechts -->
                                <rect class="car-part part-beleuchtung" data-part="blinker-spiegel-r" data-category="beleuchtung"
                                    x="530" y="170" width="12" height="8" rx="2"/>
                            </g>

                            <!-- LAYER 12: SPIEGEL -->
                            <g id="layer-spiegel">
                                <!-- Au√üenspiegel links -->
                                <g class="car-part part-karosserie" data-part="seitenspiegel-l" data-category="karosserie">
                                    <rect x="185" y="195" width="25" height="18" rx="4"/>
                                </g>

                                <!-- Au√üenspiegel rechts -->
                                <g class="car-part part-karosserie" data-part="seitenspiegel-r" data-category="karosserie">
                                    <rect x="525" y="165" width="25" height="18" rx="4"/>
                                </g>
                            </g>
                        </svg>
                    </div>
                </div>
            </div>

            <div class="sidebar">
                <!-- Selected Parts -->
                <div class="sidebar-card">
                    <h3>
                        üìã Ausgew√§hlte Teile
                        <span class="parts-count" id="partsCount">0</span>
                    </h3>
                    <ul class="selected-list" id="selectedList">
                        <li class="empty-state">
                            <div>
                                <div class="icon">üëÜ</div>
                                <div>Klicken Sie auf Fahrzeugteile</div>
                            </div>
                        </li>
                    </ul>

                    <div class="quick-select">
                        <h4>Schnellauswahl</h4>
                        <div class="quick-buttons">
                            <button class="quick-btn" onclick="selectGroup('front')">Front</button>
                            <button class="quick-btn" onclick="selectGroup('rear')">Heck</button>
                            <button class="quick-btn" onclick="selectGroup('left')">Links</button>
                            <button class="quick-btn" onclick="selectGroup('right')">Rechts</button>
                            <button class="quick-btn" onclick="selectGroup('exterior')">Au√üen</button>
                            <button class="quick-btn" onclick="selectGroup('interior')">Innen</button>
                        </div>
                    </div>
                </div>

                <!-- Stats -->
                <div class="sidebar-card">
                    <h3>üìä Statistik</h3>
                    <div class="stats-row">
                        <span class="stats-label">Verf√ºgbare Teile:</span>
                        <span class="stats-value" id="totalParts">0</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Ausgew√§hlt:</span>
                        <span class="stats-value" id="selectedCount">0</span>
                    </div>
                    <div class="stats-row">
                        <span class="stats-label">Kategorie-Filter:</span>
                        <span class="stats-value" id="activeFilter">Alle</span>
                    </div>
                </div>

                <!-- Actions -->
                <div class="sidebar-card">
                    <h3>‚ö° Aktionen</h3>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="confirmSelection()">
                            ‚úì Auswahl best√§tigen
                        </button>
                        <button class="btn btn-danger" onclick="clearSelection()">
                            üóëÔ∏è Alle l√∂schen
                        </button>
                        <button class="btn btn-outline" onclick="exportSelection()">
                            üì§ JSON Export
                        </button>
                    </div>
                </div>

                <!-- Legend -->
                <div class="sidebar-card">
                    <h3>üé® Legende</h3>
                    <div class="legend-grid">
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--cat-karosserie)"></div>
                            <span>Karosserie</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--cat-verglasung)"></div>
                            <span>Verglasung</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--cat-beleuchtung)"></div>
                            <span>Beleuchtung</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--cat-innenraum)"></div>
                            <span>Innenraum</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--cat-mechanik)"></div>
                            <span>Mechanik</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: var(--selected-color)"></div>
                            <span>Ausgew√§hlt</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        // ============================================
        // TEILE-KATALOG (60+ Teile)
        // ============================================
        const carParts = {
            // KAROSSERIE (20 Teile)
            'stossstange-vorne': { name: 'Sto√üstange vorne', category: 'karosserie', groups: ['front', 'exterior'] },
            'stossstange-hinten': { name: 'Sto√üstange hinten', category: 'karosserie', groups: ['rear', 'exterior'] },
            'motorhaube': { name: 'Motorhaube', category: 'karosserie', groups: ['front', 'exterior'] },
            'heckklappe': { name: 'Heckklappe', category: 'karosserie', groups: ['rear', 'exterior'] },
            'dach': { name: 'Dach', category: 'karosserie', groups: ['exterior'] },
            'kotfluegel-vl': { name: 'Kotfl√ºgel vorne links', category: 'karosserie', groups: ['front', 'left', 'exterior'] },
            'kotfluegel-vr': { name: 'Kotfl√ºgel vorne rechts', category: 'karosserie', groups: ['front', 'right', 'exterior'] },
            'kotfluegel-hl': { name: 'Kotfl√ºgel hinten links', category: 'karosserie', groups: ['rear', 'left', 'exterior'] },
            'kotfluegel-hr': { name: 'Kotfl√ºgel hinten rechts', category: 'karosserie', groups: ['rear', 'right', 'exterior'] },
            'tuer-vl': { name: 'T√ºr vorne links', category: 'karosserie', groups: ['left', 'exterior'] },
            'tuer-vr': { name: 'T√ºr vorne rechts', category: 'karosserie', groups: ['right', 'exterior'] },
            'tuer-hl': { name: 'T√ºr hinten links', category: 'karosserie', groups: ['left', 'exterior'] },
            'tuer-hr': { name: 'T√ºr hinten rechts', category: 'karosserie', groups: ['right', 'exterior'] },
            'schweller-l': { name: 'Schweller links', category: 'karosserie', groups: ['left', 'exterior'] },
            'schweller-r': { name: 'Schweller rechts', category: 'karosserie', groups: ['right', 'exterior'] },
            'a-saeule-l': { name: 'A-S√§ule links', category: 'karosserie', groups: ['left', 'exterior'] },
            'a-saeule-r': { name: 'A-S√§ule rechts', category: 'karosserie', groups: ['right', 'exterior'] },
            'b-saeule-l': { name: 'B-S√§ule links', category: 'karosserie', groups: ['left', 'exterior'] },
            'b-saeule-r': { name: 'B-S√§ule rechts', category: 'karosserie', groups: ['right', 'exterior'] },
            'c-saeule-l': { name: 'C-S√§ule links', category: 'karosserie', groups: ['left', 'exterior'] },
            'c-saeule-r': { name: 'C-S√§ule rechts', category: 'karosserie', groups: ['right', 'exterior'] },
            'seitenspiegel-l': { name: 'Au√üenspiegel links', category: 'karosserie', groups: ['left', 'exterior'] },
            'seitenspiegel-r': { name: 'Au√üenspiegel rechts', category: 'karosserie', groups: ['right', 'exterior'] },

            // VERGLASUNG (8 Teile)
            'windschutzscheibe': { name: 'Windschutzscheibe', category: 'verglasung', groups: ['front', 'exterior'] },
            'heckscheibe': { name: 'Heckscheibe', category: 'verglasung', groups: ['rear', 'exterior'] },
            'scheibe-vl': { name: 'Seitenscheibe vorne links', category: 'verglasung', groups: ['left', 'exterior'] },
            'scheibe-vr': { name: 'Seitenscheibe vorne rechts', category: 'verglasung', groups: ['right', 'exterior'] },
            'scheibe-hl': { name: 'Seitenscheibe hinten links', category: 'verglasung', groups: ['left', 'exterior'] },
            'scheibe-hr': { name: 'Seitenscheibe hinten rechts', category: 'verglasung', groups: ['right', 'exterior'] },
            'dreiecksfenster-l': { name: 'Dreiecksfenster links', category: 'verglasung', groups: ['left', 'exterior'] },
            'dreiecksfenster-r': { name: 'Dreiecksfenster rechts', category: 'verglasung', groups: ['right', 'exterior'] },

            // BELEUCHTUNG (10 Teile)
            'scheinwerfer-l': { name: 'Scheinwerfer links', category: 'beleuchtung', groups: ['front', 'left', 'exterior'] },
            'scheinwerfer-r': { name: 'Scheinwerfer rechts', category: 'beleuchtung', groups: ['front', 'right', 'exterior'] },
            'nebelscheinwerfer-l': { name: 'Nebelscheinwerfer links', category: 'beleuchtung', groups: ['front', 'left', 'exterior'] },
            'nebelscheinwerfer-r': { name: 'Nebelscheinwerfer rechts', category: 'beleuchtung', groups: ['front', 'right', 'exterior'] },
            'rueckleuchte-l': { name: 'R√ºckleuchte links', category: 'beleuchtung', groups: ['rear', 'left', 'exterior'] },
            'rueckleuchte-r': { name: 'R√ºckleuchte rechts', category: 'beleuchtung', groups: ['rear', 'right', 'exterior'] },
            'bremsleuchte-3': { name: '3. Bremsleuchte', category: 'beleuchtung', groups: ['rear', 'exterior'] },
            'blinker-spiegel-l': { name: 'Spiegelblinker links', category: 'beleuchtung', groups: ['left', 'exterior'] },
            'blinker-spiegel-r': { name: 'Spiegelblinker rechts', category: 'beleuchtung', groups: ['right', 'exterior'] },

            // INNENRAUM (12 Teile)
            'sitz-fahrer': { name: 'Fahrersitz', category: 'innenraum', groups: ['left', 'interior'] },
            'sitz-beifahrer': { name: 'Beifahrersitz', category: 'innenraum', groups: ['right', 'interior'] },
            'ruecksitzbank': { name: 'R√ºcksitzbank', category: 'innenraum', groups: ['rear', 'interior'] },
            'armaturenbrett': { name: 'Armaturenbrett', category: 'innenraum', groups: ['front', 'interior'] },
            'lenkrad': { name: 'Lenkrad', category: 'innenraum', groups: ['left', 'interior'] },
            'mittelkonsole': { name: 'Mittelkonsole', category: 'innenraum', groups: ['interior'] },
            'himmel': { name: 'Himmel (Dachhimmel)', category: 'innenraum', groups: ['interior'] },
            'tuerverkleidung-vl': { name: 'T√ºrverkleidung vorne links', category: 'innenraum', groups: ['left', 'interior'] },
            'tuerverkleidung-vr': { name: 'T√ºrverkleidung vorne rechts', category: 'innenraum', groups: ['right', 'interior'] },
            'tuerverkleidung-hl': { name: 'T√ºrverkleidung hinten links', category: 'innenraum', groups: ['left', 'interior'] },
            'tuerverkleidung-hr': { name: 'T√ºrverkleidung hinten rechts', category: 'innenraum', groups: ['right', 'interior'] },

            // MECHANIK & FAHRWERK (15+ Teile)
            'motor': { name: 'Motor', category: 'mechanik', groups: ['front'] },
            'getriebe': { name: 'Getriebe', category: 'mechanik', groups: ['front'] },
            'auspuff': { name: 'Auspuffanlage', category: 'mechanik', groups: ['rear'] },
            'vorderachse': { name: 'Vorderachse', category: 'mechanik', groups: ['front'] },
            'hinterachse': { name: 'Hinterachse', category: 'mechanik', groups: ['rear'] },
            'rad-vl': { name: 'Rad vorne links', category: 'mechanik', groups: ['front', 'left'] },
            'rad-vr': { name: 'Rad vorne rechts', category: 'mechanik', groups: ['front', 'right'] },
            'rad-hl': { name: 'Rad hinten links', category: 'mechanik', groups: ['rear', 'left'] },
            'rad-hr': { name: 'Rad hinten rechts', category: 'mechanik', groups: ['rear', 'right'] },
            'bremse-vl': { name: 'Bremse vorne links', category: 'mechanik', groups: ['front', 'left'] },
            'bremse-vr': { name: 'Bremse vorne rechts', category: 'mechanik', groups: ['front', 'right'] },
            'bremse-hl': { name: 'Bremse hinten links', category: 'mechanik', groups: ['rear', 'left'] },
            'bremse-hr': { name: 'Bremse hinten rechts', category: 'mechanik', groups: ['rear', 'right'] },
            'tank': { name: 'Kraftstofftank', category: 'mechanik', groups: ['rear'] },
            'batterie': { name: 'Batterie', category: 'mechanik', groups: ['front'] },
            'kuehler': { name: 'K√ºhler', category: 'mechanik', groups: ['front'] },
            'klimakompressor': { name: 'Klimakompressor', category: 'mechanik', groups: ['front'] }
        };

        // ============================================
        // STATE
        // ============================================
        let selectedParts = new Set();
        let currentCategory = 'all';
        let currentViewMode = 'exploded';
        let zoomLevel = 1;

        // ============================================
        // CATEGORY COLORS
        // ============================================
        const categoryColors = {
            'karosserie': 'var(--cat-karosserie)',
            'verglasung': 'var(--cat-verglasung)',
            'beleuchtung': 'var(--cat-beleuchtung)',
            'innenraum': 'var(--cat-innenraum)',
            'mechanik': 'var(--cat-mechanik)'
        };

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initTheme();
            setupParts();
            updateStats();
        });

        function initTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeUI(savedTheme);
        }

        function setupParts() {
            document.querySelectorAll('.car-part').forEach(part => {
                const partId = part.getAttribute('data-part');
                if (!partId) return;

                part.addEventListener('click', () => togglePart(partId));
                part.addEventListener('mouseenter', (e) => showTooltip(e, partId));
                part.addEventListener('mouseleave', hideTooltip);
                part.addEventListener('mousemove', moveTooltip);
            });
        }

        // ============================================
        // THEME
        // ============================================
        function toggleTheme() {
            const current = document.documentElement.getAttribute('data-theme');
            const newTheme = current === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeUI(newTheme);
        }

        function updateThemeUI(theme) {
            document.getElementById('themeIcon').textContent = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            document.getElementById('themeText').textContent = theme === 'dark' ? 'Light' : 'Dark';
        }

        // ============================================
        // VIEW MODE
        // ============================================
        function setViewMode(mode) {
            currentViewMode = mode;
            document.querySelectorAll('.view-mode-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(mode === 'exploded' ? 'explodedBtn' : 'assembledBtn').classList.add('active');

            // Apply/remove explosion transforms
            document.querySelectorAll('.exploded-layer').forEach(layer => {
                if (mode === 'exploded') {
                    const explodeY = layer.getAttribute('data-explode-y') || 0;
                    const explodeX = layer.getAttribute('data-explode-x') || 0;
                    layer.style.transform = `translate(${explodeX}px, ${explodeY}px)`;
                    layer.style.transition = 'transform 0.5s ease';
                } else {
                    layer.style.transform = 'translate(0, 0)';
                    layer.style.transition = 'transform 0.5s ease';
                }
            });
        }

        // ============================================
        // ZOOM
        // ============================================
        function zoomIn() {
            zoomLevel = Math.min(zoomLevel + 0.2, 2);
            applyZoom();
        }

        function zoomOut() {
            zoomLevel = Math.max(zoomLevel - 0.2, 0.5);
            applyZoom();
        }

        function resetZoom() {
            zoomLevel = 1;
            applyZoom();
        }

        function applyZoom() {
            document.getElementById('svgContainer').style.transform = `scale(${zoomLevel})`;
        }

        // ============================================
        // CATEGORY FILTER
        // ============================================
        function filterCategory(category) {
            currentCategory = category;

            // Update buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-category') === category);
            });

            // Filter parts
            document.querySelectorAll('.car-part').forEach(part => {
                const partId = part.getAttribute('data-part');
                const partInfo = carParts[partId];

                if (category === 'all' || (partInfo && partInfo.category === category)) {
                    part.classList.remove('dimmed');
                } else {
                    part.classList.add('dimmed');
                }
            });

            updateStats();
        }

        // ============================================
        // PART SELECTION
        // ============================================
        function togglePart(partId) {
            if (selectedParts.has(partId)) {
                selectedParts.delete(partId);
                document.querySelectorAll(`[data-part="${partId}"]`).forEach(el => {
                    el.classList.remove('selected');
                });
            } else {
                selectedParts.add(partId);
                document.querySelectorAll(`[data-part="${partId}"]`).forEach(el => {
                    el.classList.add('selected');
                });
            }
            updateSelectedList();
            updateStats();
        }

        function updateSelectedList() {
            const list = document.getElementById('selectedList');
            const count = document.getElementById('partsCount');

            count.textContent = selectedParts.size;

            if (selectedParts.size === 0) {
                list.innerHTML = `
                    <li class="empty-state">
                        <div>
                            <div class="icon">üëÜ</div>
                            <div>Klicken Sie auf Fahrzeugteile</div>
                        </div>
                    </li>
                `;
                return;
            }

            list.innerHTML = '';
            selectedParts.forEach(partId => {
                const partInfo = carParts[partId];
                const li = document.createElement('li');
                const catColor = categoryColors[partInfo?.category] || '#888';
                li.innerHTML = `
                    <div class="part-info">
                        <span class="category-dot" style="background: ${catColor}"></span>
                        <span>${partInfo?.name || partId}</span>
                    </div>
                    <button class="remove-btn" onclick="togglePart('${partId}')" title="Entfernen">√ó</button>
                `;
                list.appendChild(li);
            });
        }

        // ============================================
        // GROUP SELECTION
        // ============================================
        function selectGroup(groupName) {
            Object.entries(carParts).forEach(([partId, info]) => {
                if (info.groups && info.groups.includes(groupName) && !selectedParts.has(partId)) {
                    selectedParts.add(partId);
                    document.querySelectorAll(`[data-part="${partId}"]`).forEach(el => {
                        el.classList.add('selected');
                    });
                }
            });
            updateSelectedList();
            updateStats();
        }

        // ============================================
        // STATS
        // ============================================
        function updateStats() {
            document.getElementById('totalParts').textContent = Object.keys(carParts).length;
            document.getElementById('selectedCount').textContent = selectedParts.size;
            document.getElementById('activeFilter').textContent =
                currentCategory === 'all' ? 'Alle' :
                currentCategory.charAt(0).toUpperCase() + currentCategory.slice(1);
        }

        // ============================================
        // TOOLTIP
        // ============================================
        function showTooltip(event, partId) {
            const tooltip = document.getElementById('tooltip');
            const partInfo = carParts[partId];

            if (partInfo) {
                tooltip.innerHTML = `
                    <div class="tooltip-title">${partInfo.name}</div>
                    <div class="tooltip-category">Kategorie: ${partInfo.category.charAt(0).toUpperCase() + partInfo.category.slice(1)}</div>
                `;
            } else {
                tooltip.innerHTML = `<div class="tooltip-title">${partId}</div>`;
            }

            tooltip.classList.add('visible');
            moveTooltip(event);
        }

        function moveTooltip(event) {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.left = (event.clientX + 15) + 'px';
            tooltip.style.top = (event.clientY + 15) + 'px';
        }

        function hideTooltip() {
            document.getElementById('tooltip').classList.remove('visible');
        }

        // ============================================
        // ACTIONS
        // ============================================
        function clearSelection() {
            selectedParts.clear();
            document.querySelectorAll('.car-part.selected').forEach(el => {
                el.classList.remove('selected');
            });
            updateSelectedList();
            updateStats();
        }

        function confirmSelection() {
            if (selectedParts.size === 0) {
                alert('Bitte w√§hlen Sie mindestens ein Teil aus.');
                return;
            }

            const parts = Array.from(selectedParts).map(id => ({
                id,
                name: carParts[id]?.name || id,
                category: carParts[id]?.category || 'unknown'
            }));

            const byCategory = {};
            parts.forEach(p => {
                if (!byCategory[p.category]) byCategory[p.category] = [];
                byCategory[p.category].push(p.name);
            });

            let message = `‚úÖ ${parts.length} Teil(e) ausgew√§hlt:\n\n`;
            Object.entries(byCategory).forEach(([cat, names]) => {
                message += `üìÅ ${cat.toUpperCase()}:\n`;
                names.forEach(n => message += `   ‚Ä¢ ${n}\n`);
                message += '\n';
            });

            alert(message);
            console.log('Ausgew√§hlte Teile:', parts);
        }

        function exportSelection() {
            const data = {
                timestamp: new Date().toISOString(),
                partsCount: selectedParts.size,
                parts: Array.from(selectedParts).map(id => ({
                    id,
                    name: carParts[id]?.name || id,
                    category: carParts[id]?.category || 'unknown',
                    groups: carParts[id]?.groups || []
                }))
            };

            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `fahrzeugteile-auswahl-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Initialize exploded view
        setTimeout(() => setViewMode('exploded'), 100);
    </script>
</body>
</html>
