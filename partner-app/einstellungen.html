<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Einstellungen | Partner Portal</title>

    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Design System -->
    <link rel="stylesheet" href="../design-system.css?v=partner-portal-v1">
    <link rel="stylesheet" href="../components.css?v=partner-portal-v1">
    <link rel="stylesheet" href="../animations.css?v=partner-portal-v1">
    <link rel="stylesheet" href="../mobile-first.css?v=partner-portal-v1">

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* ============================================
           PARTNER EINSTELLUNGEN PAGE STYLES
           Identisch mit meine-anfragen.html Design
           ============================================ */

        body {
            min-height: 100vh;
            background: var(--color-background);
            color: var(--color-text-primary);
            font-family: var(--font-text);
            padding: var(--space-6);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header (identisch mit meine-anfragen.html) */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 18px;
            border-bottom: 2px solid var(--color-border);
        }

        .header-left h1 {
            font-size: var(--font-size-3xl);
            font-weight: var(--font-weight-bold);
            margin: 0 0 var(--space-2) 0;
            color: var(--color-text-primary);
        }

        .header-left p {
            font-size: var(--font-size-sm);
            color: var(--color-text-secondary);
            margin: 0;
        }

        .header-actions {
            display: flex;
            gap: var(--space-3);
            align-items: center;
        }

        /* Tabs Container */
        .tabs-container {
            background: var(--color-surface);
            border-radius: var(--radius-card);
            padding: var(--space-4);
            margin-bottom: var(--space-6);
            border: 1px solid var(--color-border);
        }

        .tabs {
            display: flex;
            gap: var(--space-2);
            border-bottom: 2px solid var(--color-border);
            padding-bottom: 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: var(--space-3) var(--space-5);
            background: transparent;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--color-text-secondary);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all var(--duration-base) var(--ease-out);
            margin-bottom: -2px;
        }

        .tab:hover {
            color: var(--color-text-primary);
            background: rgba(var(--color-primary-rgb), 0.05);
        }

        .tab.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
            font-weight: var(--font-weight-semibold);
        }

        /* Content Sections */
        .content-section {
            display: none;
            background: var(--color-surface);
            border-radius: var(--radius-card);
            padding: var(--space-6);
            border: 1px solid var(--color-border);
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s var(--ease-out);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .section-title {
            font-size: var(--font-size-xl);
            font-weight: var(--font-weight-semibold);
            margin: 0 0 var(--space-6) 0;
            color: var(--color-text-primary);
        }

        .section-subtitle {
            font-size: var(--font-size-lg);
            font-weight: var(--font-weight-medium);
            margin: var(--space-6) 0 var(--space-4) 0;
            color: var(--color-text-primary);
            padding-bottom: var(--space-2);
            border-bottom: 1px solid var(--color-border);
        }

        /* Form Groups */
        .form-group {
            margin-bottom: var(--space-5);
        }

        .form-group label {
            display: block;
            font-weight: var(--font-weight-medium);
            margin-bottom: var(--space-2);
            color: var(--color-text-primary);
            font-size: var(--font-size-sm);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: var(--space-3) var(--space-4);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
            border-radius: var(--radius-input);
            font-size: var(--font-size-base);
            color: var(--color-text-primary);
            font-family: inherit;
            transition: all var(--duration-base) var(--ease-out);
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(var(--color-primary-rgb), 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-group small {
            display: block;
            margin-top: var(--space-1);
            font-size: var(--font-size-xs);
            color: var(--color-text-tertiary);
        }

        /* Checkbox/Toggle Styles */
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--space-3);
            margin-bottom: var(--space-4);
            padding: var(--space-3);
            border-radius: var(--radius-button);
            background: var(--color-surface);
            border: 1px solid var(--color-border);
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
            flex: 1;
        }

        /* Buttons */
        .btn-group {
            display: flex;
            gap: var(--space-3);
            margin-top: var(--space-6);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--color-primary-hover) 100%);
            color: white;
            border: none;
            padding: var(--space-3) var(--space-6);
            border-radius: var(--radius-button);
            font-weight: var(--font-weight-semibold);
            font-size: var(--font-size-base);
            cursor: pointer;
            transition: all var(--duration-base) var(--ease-out);
            box-shadow: 0 2px 8px rgba(var(--color-primary-rgb), 0.2);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(var(--color-primary-rgb), 0.3);
        }

        .btn-secondary {
            background: var(--color-surface);
            color: var(--color-text-primary);
            border: 1px solid var(--color-border);
            padding: var(--space-3) var(--space-5);
            border-radius: var(--radius-button);
            font-weight: var(--font-weight-medium);
            font-size: var(--font-size-sm);
            cursor: pointer;
            transition: all var(--duration-base) var(--ease-out);
        }

        .btn-secondary:hover {
            background: var(--color-surface-hover);
            transform: translateY(-2px);
        }

        /* Theme Toggle (identisch mit meine-anfragen.html) */
        .btn-theme-toggle {
            width: 44px;
            height: 44px;
            position: relative;
            overflow: hidden;
        }

        .btn-theme-toggle .sun-icon,
        .btn-theme-toggle .moon-icon {
            width: 20px;
            height: 20px;
            color: var(--color-text-primary);
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            transition: all var(--duration-base) var(--ease-out);
        }

        :root .btn-theme-toggle .sun-icon {
            opacity: 0;
            transform: translate(-50%, -50%) rotate(180deg) scale(0.5);
        }

        :root .btn-theme-toggle .moon-icon {
            opacity: 1;
            transform: translate(-50%, -50%) rotate(0deg) scale(1);
        }

        [data-theme="dark"] .btn-theme-toggle .sun-icon {
            opacity: 1;
            transform: translate(-50%, -50%) rotate(0deg) scale(1);
        }

        [data-theme="dark"] .btn-theme-toggle .moon-icon {
            opacity: 0;
            transform: translate(-50%, -50%) rotate(-180deg) scale(0.5);
        }

        /* Success Message */
        .success-message {
            background: rgba(52, 199, 89, 0.1);
            border: 1px solid rgba(52, 199, 89, 0.3);
            border-radius: var(--radius-card);
            padding: var(--space-4);
            margin-bottom: var(--space-5);
            display: none;
            color: #34c759;
            font-weight: var(--font-weight-medium);
        }

        .success-message.show {
            display: block;
            animation: slideIn 0.3s var(--ease-out);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: var(--space-4);
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: var(--space-4);
            }

            .header-actions {
                width: 100%;
                flex-wrap: wrap;
            }

            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .tab {
                white-space: nowrap;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn-primary,
            .btn-secondary {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1>⚙️ Einstellungen</h1>
                <p id="partnerName">Partner Portal</p>
            </div>
            <div class="header-actions">
                <a href="meine-anfragen.html" class="btn btn-secondary">
                    <i data-lucide="arrow-left"></i> Zurück
                </a>
                <button class="btn btn-secondary" onclick="logout()">Abmelden</button>
                <button id="themeToggle" class="btn btn-secondary btn-theme-toggle" title="Theme umschalten">
                    <i data-lucide="sun" class="sun-icon"></i>
                    <i data-lucide="moon" class="moon-icon"></i>
                </button>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="profil">
                    <i data-lucide="building-2"></i> Profil & Kontakt
                </button>
                <button class="tab" data-tab="sicherheit">
                    <i data-lucide="shield"></i> Sicherheit
                </button>
                <button class="tab" data-tab="benachrichtigungen">
                    <i data-lucide="bell"></i> Benachrichtigungen
                </button>
            </div>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="success-message">
            ✅ Änderungen erfolgreich gespeichert!
        </div>

        <!-- Tab 1: Profil & Kontakt -->
        <div id="section-profil" class="content-section active">
            <h2 class="section-title">Profil & Kontakt</h2>

            <form id="profilForm" onsubmit="saveProfile(event)">
                <h3 class="section-subtitle">Firmendaten</h3>

                <div class="form-group">
                    <label for="firmenname">Firmenname *</label>
                    <input type="text" id="firmenname" required placeholder="z.B. Auto Müller GmbH">
                </div>

                <div class="form-group">
                    <label for="website">Website</label>
                    <input type="url" id="website" placeholder="https://www.beispiel.de">
                    <small>Ihre Firmen-Website (optional)</small>
                </div>

                <div class="form-group">
                    <label for="oeffnungszeiten">Öffnungszeiten</label>
                    <textarea id="oeffnungszeiten" placeholder="Mo-Fr: 08:00-18:00 Uhr&#10;Sa: 09:00-13:00 Uhr"></textarea>
                    <small>Ihre Öffnungszeiten im Freitext (optional)</small>
                </div>

                <h3 class="section-subtitle">Ansprechpartner</h3>

                <div class="form-group">
                    <label for="ap_name">Name *</label>
                    <input type="text" id="ap_name" required placeholder="z.B. Max Mustermann">
                </div>

                <div class="form-group">
                    <label for="ap_position">Position</label>
                    <input type="text" id="ap_position" placeholder="z.B. Geschäftsführer">
                </div>

                <div class="form-group">
                    <label for="ap_telefon">Telefon *</label>
                    <input type="tel" id="ap_telefon" required placeholder="z.B. 06261 123456">
                </div>

                <div class="form-group">
                    <label for="ap_mobil">Mobil</label>
                    <input type="tel" id="ap_mobil" placeholder="z.B. 0171 1234567">
                </div>

                <h3 class="section-subtitle">Adresse</h3>

                <div class="form-group">
                    <label for="strasse">Straße *</label>
                    <input type="text" id="strasse" required placeholder="z.B. Hauptstraße">
                </div>

                <div class="form-group">
                    <label for="hausnummer">Hausnummer *</label>
                    <input type="text" id="hausnummer" required placeholder="z.B. 123">
                </div>

                <div class="form-group">
                    <label for="plz">PLZ *</label>
                    <input type="text" id="plz" required placeholder="z.B. 74821" pattern="[0-9]{5}" maxlength="5">
                </div>

                <div class="form-group">
                    <label for="ort">Ort *</label>
                    <input type="text" id="ort" required placeholder="z.B. Mosbach">
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn-primary">
                        <i data-lucide="save"></i> Änderungen speichern
                    </button>
                </div>
            </form>
        </div>

        <!-- Tab 2: Sicherheit -->
        <div id="section-sicherheit" class="content-section">
            <h2 class="section-title">Sicherheit</h2>

            <p style="color: var(--color-text-secondary); margin-bottom: var(--space-6);">
                Verwalten Sie hier Ihr Passwort und Ihre Login-Daten.
            </p>

            <div class="form-group">
                <label>Aktuelle Email-Adresse</label>
                <input type="email" id="current_email" disabled>
                <small>Ihre Email-Adresse kann derzeit nicht geändert werden. Bitte kontaktieren Sie die Werkstatt.</small>
            </div>

            <div class="btn-group">
                <button type="button" class="btn-primary" onclick="openPasswordModal()">
                    <i data-lucide="key"></i> Passwort ändern
                </button>
            </div>
        </div>

        <!-- Tab 3: Benachrichtigungen -->
        <div id="section-benachrichtigungen" class="content-section">
            <h2 class="section-title">Benachrichtigungen</h2>

            <form id="benachrichtigungenForm" onsubmit="saveBenachrichtigungen(event)">
                <p style="color: var(--color-text-secondary); margin-bottom: var(--space-6);">
                    Wählen Sie, welche Email-Benachrichtigungen Sie erhalten möchten.
                </p>

                <div class="checkbox-group">
                    <input type="checkbox" id="email_neues_kva" checked>
                    <label for="email_neues_kva">
                        <strong>Neues Kostenangebot (KVA)</strong><br>
                        <small style="color: var(--color-text-secondary);">Sie erhalten eine Email, wenn ein neues Kostenangebot erstellt wurde.</small>
                    </label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="email_statusaenderung" checked>
                    <label for="email_statusaenderung">
                        <strong>Statusänderung</strong><br>
                        <small style="color: var(--color-text-secondary);">Sie erhalten eine Email bei jeder Statusänderung Ihrer Anfragen.</small>
                    </label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="email_fahrzeug_fertig" checked>
                    <label for="email_fahrzeug_fertig">
                        <strong>Fahrzeug fertiggestellt</strong><br>
                        <small style="color: var(--color-text-secondary);">Sie erhalten eine Email, wenn Ihr Fahrzeug abholbereit ist.</small>
                    </label>
                </div>

                <div class="checkbox-group">
                    <input type="checkbox" id="email_chatnachrichten" checked>
                    <label for="email_chatnachrichten">
                        <strong>Neue Chat-Nachrichten</strong><br>
                        <small style="color: var(--color-text-secondary);">Sie erhalten eine Email bei neuen Nachrichten im Chat.</small>
                    </label>
                </div>

                <div class="form-group" style="margin-top: var(--space-6);">
                    <label for="email_frequenz">Benachrichtigungs-Frequenz</label>
                    <select id="email_frequenz">
                        <option value="sofort">Sofort (Echtzeit)</option>
                        <option value="taeglich">Täglich (Zusammenfassung)</option>
                    </select>
                    <small>Wie oft möchten Sie Benachrichtigungen erhalten?</small>
                </div>

                <div class="btn-group">
                    <button type="submit" class="btn-primary">
                        <i data-lucide="save"></i> Einstellungen speichern
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <!-- App Scripts -->
    <script src="../firebase-config.js"></script>
    <script src="../listener-registry.js"></script>

    <script>
        // ========================================
        // INITIALIZATION
        // ========================================

        let partner = null;

        // Initialize Lucide Icons
        lucide.createIcons();

        // Theme Toggle
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);

        document.getElementById('themeToggle')?.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            lucide.createIcons();
        });

        // Tab Navigation Event Listeners
        document.querySelectorAll('.tab').forEach(tabButton => {
            tabButton.addEventListener('click', () => {
                const tabName = tabButton.getAttribute('data-tab');
                switchTab(tabName);
            });
        });

        // ========================================
        // PRE-INITIALIZE werkstattId from localStorage
        // ========================================
        // CRITICAL: Set werkstattId BEFORE firebaseReady event!
        const storedPartner = JSON.parse(localStorage.getItem('partner') || 'null');
        window.werkstattId = (storedPartner && storedPartner.werkstattId) || 'mosbach';
        console.log('✅ [EINSTELLUNGEN] werkstattId pre-initialized:', window.werkstattId);

        // ========================================
        // AUTH & DATA LOADING
        // ========================================

        window.addEventListener('firebaseReady', async () => {
            // window.db is already set by firebase-config.js

            // Load partner from localStorage
            partner = JSON.parse(localStorage.getItem('partner') || 'null');

            if (!partner) {
                alert('Bitte melden Sie sich erneut an.');
                window.location.href = 'index.html';
                return;
            }

            // Set werkstattId from partner object (with fallback)
            window.werkstattId = (partner && partner.werkstattId) || 'mosbach';
            console.log('✅ [EINSTELLUNGEN] werkstattId from partner:', window.werkstattId);

            // Update header
            document.getElementById('partnerName').textContent = partner.name || 'Partner Portal';
            document.getElementById('current_email').value = partner.email || '';

            // Load data
            await loadPartnerData();
        });

        // ========================================
        // TAB SWITCHING
        // ========================================

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update content sections
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(`section-${tabName}`).classList.add('active');

            // Re-render icons
            lucide.createIcons();
        }

        // ========================================
        // LOAD PARTNER DATA
        // ========================================

        async function loadPartnerData() {
            try {
                const partnerDoc = await window.getCollection('partners').doc(partner.partnerId || partner.email).get();

                if (partnerDoc.exists) {
                    const data = partnerDoc.data();

                    // Load Profil data
                    if (data.profil) {
                        document.getElementById('firmenname').value = data.profil.firmenname || '';
                        document.getElementById('website').value = data.profil.website || '';
                        document.getElementById('oeffnungszeiten').value = data.profil.oeffnungszeiten || '';

                        if (data.profil.ansprechpartner) {
                            document.getElementById('ap_name').value = data.profil.ansprechpartner.name || '';
                            document.getElementById('ap_position').value = data.profil.ansprechpartner.position || '';
                            document.getElementById('ap_telefon').value = data.profil.ansprechpartner.telefon || '';
                            document.getElementById('ap_mobil').value = data.profil.ansprechpartner.mobil || '';
                        }

                        if (data.profil.adresse) {
                            document.getElementById('strasse').value = data.profil.adresse.strasse || '';
                            document.getElementById('hausnummer').value = data.profil.adresse.hausnummer || '';
                            document.getElementById('plz').value = data.profil.adresse.plz || '';
                            document.getElementById('ort').value = data.profil.adresse.ort || '';
                        }
                    }

                    // Load Benachrichtigungen data
                    if (data.benachrichtigungen && data.benachrichtigungen.email) {
                        document.getElementById('email_neues_kva').checked = data.benachrichtigungen.email.neuesKVA !== false;
                        document.getElementById('email_statusaenderung').checked = data.benachrichtigungen.email.statusaenderung !== false;
                        document.getElementById('email_fahrzeug_fertig').checked = data.benachrichtigungen.email.fahrzeugFertig !== false;
                        document.getElementById('email_chatnachrichten').checked = data.benachrichtigungen.email.chatnachrichten !== false;
                        document.getElementById('email_frequenz').value = data.benachrichtigungen.frequenz || 'sofort';
                    }
                }
            } catch (error) {
                console.error('Fehler beim Laden der Partner-Daten:', error);
            }
        }

        // ========================================
        // SAVE FUNCTIONS
        // ========================================

        async function saveProfile(event) {
            event.preventDefault();

            try {
                await window.getCollection('partners').doc(partner.partnerId || partner.email).update({
                    profil: {
                        firmenname: document.getElementById('firmenname').value,
                        website: document.getElementById('website').value,
                        oeffnungszeiten: document.getElementById('oeffnungszeiten').value,
                        ansprechpartner: {
                            name: document.getElementById('ap_name').value,
                            position: document.getElementById('ap_position').value,
                            telefon: document.getElementById('ap_telefon').value,
                            mobil: document.getElementById('ap_mobil').value
                        },
                        adresse: {
                            strasse: document.getElementById('strasse').value,
                            hausnummer: document.getElementById('hausnummer').value,
                            plz: document.getElementById('plz').value,
                            ort: document.getElementById('ort').value
                        }
                    },
                    lastModifiedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showSuccessMessage();
            } catch (error) {
                console.error('Fehler beim Speichern:', error);
                alert('❌ Fehler beim Speichern: ' + error.message);
            }
        }

        async function saveBenachrichtigungen(event) {
            event.preventDefault();

            try {
                await window.getCollection('partners').doc(partner.partnerId || partner.email).update({
                    benachrichtigungen: {
                        email: {
                            neuesKVA: document.getElementById('email_neues_kva').checked,
                            statusaenderung: document.getElementById('email_statusaenderung').checked,
                            fahrzeugFertig: document.getElementById('email_fahrzeug_fertig').checked,
                            chatnachrichten: document.getElementById('email_chatnachrichten').checked
                        },
                        frequenz: document.getElementById('email_frequenz').value
                    },
                    lastModifiedAt: firebase.firestore.FieldValue.serverTimestamp()
                });

                showSuccessMessage();
            } catch (error) {
                console.error('Fehler beim Speichern:', error);
                alert('❌ Fehler beim Speichern: ' + error.message);
            }
        }

        function showSuccessMessage() {
            const msg = document.getElementById('successMessage');
            msg.classList.add('show');
            setTimeout(() => {
                msg.classList.remove('show');
            }, 3000);
        }

        // ========================================
        // PASSWORD CHANGE
        // ========================================

        function openPasswordModal() {
            const newPassword = prompt('Neues Passwort eingeben (min. 6 Zeichen):');

            if (!newPassword) return;

            if (newPassword.length < 6) {
                alert('❌ Passwort muss mindestens 6 Zeichen lang sein.');
                return;
            }

            const user = firebase.auth().currentUser;

            user.updatePassword(newPassword).then(() => {
                alert('✅ Passwort erfolgreich geändert!');
            }).catch((error) => {
                console.error('Fehler beim Ändern des Passworts:', error);
                alert('❌ Fehler: ' + error.message + '\n\nBitte melden Sie sich erneut an und versuchen Sie es dann nochmal.');
            });
        }

        // ========================================
        // LOGOUT
        // ========================================

        function logout() {
            if (confirm('Möchten Sie sich wirklich abmelden?')) {
                firebase.auth().signOut().then(() => {
                    localStorage.removeItem('partner');
                    window.location.href = 'index.html';
                });
            }
        }
    </script>
</body>
</html>
