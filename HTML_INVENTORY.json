{
  "metadata": {
    "project": "Fahrzeugannahme App - Auto-Lackierzentrum Mosbach",
    "generated": "2025-11-27",
    "total_root_html_files": 51,
    "total_lines_analyzed": "~121,000 lines",
    "description": "Complete inventory of all root-level HTML files with functions, collections, and form inputs"
  },
  "files": {
    "annahme.html": {
      "purpose": "Vehicle intake form (Fahrzeug-Annahme) - Core data collection for service requests",
      "lines": 10217,
      "title": "Fahrzeug-Annahme | Auto-Lackierzentrum Mosbach",
      "importance": "CRITICAL",
      "functions": {
        "total": 116,
        "key_functions": [
          "getFormData - Collects all form data (vehicle, customer, service)",
          "createPDF - Generates intake PDF with QR code",
          "saveErsatzteileToCentralDB - Stores spare parts to central DB",
          "autoConvertErsatzteileToBestellungen - Auto-converts spare parts to orders",
          "parseWithOpenAI - AI-based DAT PDF parsing",
          "parseDatPdf - Extracts vehicle data from PDF",
          "fillFormFromPdf - Pre-fills form from uploaded PDF",
          "loadDraft - Loads saved draft vehicles",
          "saveDraft - Saves vehicle as draft (quick mode)",
          "createArbeitsauftrag - Creates work order",
          "extractErsatzteile - Extracts spare parts from various sources",
          "updateGesamtsumme - Updates total cost calculation",
          "updateKostenaufschluesselung - Updates cost breakdown"
        ]
      },
      "firestore_collections": [
        "fahrzeuge (read/write)",
        "partnerAnfragen (read/write)",
        "ersatzteile (read/write)",
        "materialRequests (read/write)",
        "bestellungen (read/write)",
        "calendar (read/write)"
      ],
      "form_inputs": {
        "total": 74,
        "categories": {
          "vehicle_data": [
            "kennzeichen (License plate)",
            "marke (Brand)",
            "modell (Model)",
            "baujahr (Year of manufacture)",
            "schaden_beschreibung (Damage description)"
          ],
          "customer_data": [
            "kundenname (Customer name)",
            "kundenEmail (Email)",
            "kundenTelefon (Phone)",
            "kundennummer (Customer number)"
          ],
          "service_selection": [
            "serviceTyp (Main service type)",
            "additionalServices (Additional services)",
            "dellenanzahl, dellengroesse, dellenpositionen (Dent details)"
          ],
          "costs": [
            "arbeitslohn (Labor cost)",
            "ersatzteile (Spare parts)",
            "lackierung (Painting)",
            "materialien (Materials)"
          ],
          "scheduling": [
            "abholdatum (Pickup date)",
            "abholzeit (Pickup time)",
            "abholadresse (Pickup address)"
          ]
        }
      },
      "data_flows": [
        "Vehicle Creation → Kanban Board",
        "Draft Creation → Entwürfe Bearbeiten Page",
        "Spare Parts → Partner Portal (KVA)",
        "PDF Upload → OpenAI Parsing → Form Pre-fill",
        "Auto-Entwurf Creation (Quick Mode)"
      ],
      "known_issues": [
        "PDF Emoji encoding (Unicode → Latin-1 issue) - FIXED in Bug #44",
        "Quick Mode missing kundenname validation - FIXED in Bug #46",
        "Y-position overlap with QR code - FIXED in Bug #44"
      ]
    },
    "kanban.html": {
      "purpose": "Kanban board for process monitoring and status tracking",
      "lines": 8946,
      "title": "Prozessüberwachung - Kanban Board | Auto-Lackierzentrum Mosbach",
      "importance": "CRITICAL",
      "functions": {
        "total": 88,
        "key_functions": [
          "directStatusUpdate - Updates vehicle status with validation",
          "autoCreateRechnung - Auto-creates invoice when status='fertig'",
          "createKanbanCard - Renders vehicle card in Kanban column",
          "dragStartHandler, dragEndHandler - Drag & drop handlers",
          "buildServiceBadgeWithStatus - Renders service status badges",
          "hasService - Checks if vehicle has specific service",
          "allServicesComplete - Validates all services are done",
          "isValidTransition - Validates status transitions (Pattern #50)"
        ]
      },
      "firestore_collections": [
        "fahrzeuge (read/write)",
        "partnerAnfragen (read/write)",
        "partners (read)",
        "bestellungen (read)",
        "counters (read/write)"
      ],
      "kanban_columns": [
        "anlieferung (Delivery)",
        "neu (New)",
        "angenommen (Accepted)",
        "in_arbeit (In Progress)",
        "qualitaetskontrolle (Quality Control)",
        "fertig (Finished)"
      ],
      "known_issues": [
        "serviceTyp Overwrite Bug - FIXED (Pattern #21, Commits 750d7b2, 7083778)",
        "Status Transition Validation - FIXED (Pattern #50, Commit bf067ad)",
        "Background Sync Failures - Pattern #57 (Commit 83dd29c)"
      ]
    },
    "index.html": {
      "purpose": "Login page and main dashboard with werkstatt/employee selection",
      "lines": 6097,
      "title": "Fahrzeugannahme-App | Auto-Lackierzentrum Mosbach",
      "importance": "CRITICAL",
      "functions": {
        "total": 76,
        "key_functions": [
          "checkLogin - 2-stage authentication (werkstatt + employee)",
          "createAdminSession - Creates admin session for testing",
          "selectService - Service selection interface",
          "loadDashboardStats - Loads vehicle/customer statistics",
          "setupRealtimeListeners - Real-time Firebase updates",
          "initFABScrollBehavior - Floating action button behavior",
          "calculateUrlaubsTage - Vacation days calculation"
        ]
      },
      "firestore_collections": [
        "activeSessions (read/write)",
        "fahrzeuge (read)",
        "mitarbeiter (read)",
        "partnerAnfragen (read)",
        "serviceSessions (read/write)",
        "urlaubsAnfragen (read)",
        "rechnungen (read)",
        "leihfahrzeuge (read)"
      ],
      "authentication": [
        "Stage 1: Werkstatt selection (localStorage-based)",
        "Stage 2: Employee selection (Firebase Auth optional)",
        "Admin access: Password prompt"
      ]
    },
    "kunden.html": {
      "purpose": "Customer management - Partner directory with ratings and conditions",
      "lines": 6373,
      "title": "Kundenverwaltung | Auto-Lackierzentrum Mosbach",
      "importance": "HIGH",
      "functions": {
        "total": 79,
        "key_functions": [
          "loadKunden - Loads all partners/customers",
          "filterKunden - Advanced filtering by name/rating/service",
          "editKunde - Edit customer details",
          "deleteKunde - Delete customer",
          "addTagToKunde - Tag-based organization",
          "calculateKundenUmsatz - Calculates customer revenue",
          "exportKundenToCSV - CSV export function",
          "autoAssignTags - Auto-tagging algorithm",
          "copyPartnerPassword - Partner password management"
        ]
      },
      "firestore_collections": [
        "partners (read/write)"
      ],
      "form_inputs": {
        "total": 28,
        "key_fields": [
          "kundenName, kundenEmail, kundenTelefon",
          "partnerCode, kundenNotizen",
          "rabattStufe1Ab, rabattStufe1Bonus (Discount tiers)",
          "konditionenGeprueft, konditionenDatum"
        ]
      }
    },
    "material.html": {
      "purpose": "Material ordering and spare parts management",
      "lines": 5456,
      "title": "Material nachbestellen | Auto-Lackierzentrum Mosbach",
      "importance": "HIGH",
      "functions": {
        "total": 62,
        "key_functions": [
          "loadMaterialRequests - Loads all material requests",
          "convertToBestellung - Converts request to order",
          "markAsAngeliefert - Marks as delivered",
          "loadZentraleErsatzteile - Loads central spare parts DB",
          "applyErsatzteileFilters - Filter spare parts",
          "calculateManualGesamtpreis - Cost calculation"
        ]
      },
      "firestore_collections": [
        "materialRequests (read/write)",
        "bestellungen (read/write)",
        "fahrzeuge (read)",
        "calendar (read/write)"
      ],
      "features": [
        "Photo upload for material requests",
        "Supplier management",
        "Delivery tracking",
        "Price history"
      ]
    },
    "mitarbeiter-verwaltung.html": {
      "purpose": "Employee management - Wages, time tracking, vacation",
      "lines": 5699,
      "title": "Mitarbeiter-Verwaltung | Auto-Lackierzentrum Mosbach",
      "importance": "HIGH",
      "functions": {
        "total": 67,
        "key_functions": [
          "loadMitarbeiter - Loads all employees",
          "createNewMitarbeiter - Creates new employee",
          "editMitarbeiter - Edit employee details",
          "deleteMitarbeiter - Delete employee",
          "approveVacation - Approves vacation requests",
          "calculateShiftHours - Calculates work hours",
          "erstelleLohnabrechnungFuerMitarbeiter - Wage statement generation",
          "actuallyGeneratePDFNew - PDF generation with annotations"
        ]
      },
      "firestore_collections": [
        "mitarbeiter (read/write)",
        "zeiterfassung (read/write)",
        "urlaubsAnfragen (read/write)",
        "schichten (read/write)",
        "schichtTypen (read)",
        "stundennachweise (read/write)",
        "lohnabrechnungen (read/write)",
        "einstellungen (read)"
      ],
      "features": [
        "Time tracking (SOLL/IST hours)",
        "Vacation management",
        "Shift planning",
        "PDF payroll statements with annotations",
        "Wage calculations"
      ]
    },
    "mitarbeiter-dienstplan.html": {
      "purpose": "Employee time clock and personal shift management",
      "lines": 3282,
      "title": "Mein Dienstplan | Auto-Lackierzentrum",
      "importance": "MEDIUM",
      "functions": {
        "total": 66,
        "key_functions": [
          "startWork - Clock in",
          "endWork - Clock out",
          "endBreak - End break",
          "generatePreviewPDF - PDF preview of timesheet",
          "calculateShiftHours - Work hours calculation",
          "addAnnotation - Add error annotations",
          "clearSignature - Signature clearing"
        ]
      },
      "firestore_collections": [
        "zeiterfassung (read/write)",
        "mitarbeiter (read)",
        "schichten (read)",
        "schichtTypen (read)",
        "urlaubsAnfragen (read)",
        "stundennachweise (read/write)"
      ]
    },
    "admin-einstellungen.html": {
      "purpose": "Admin settings - Configuration, email templates, service toggles",
      "lines": 2812,
      "title": "Admin-Einstellungen | Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": {
        "total": 23,
        "key_functions": [
          "loadAllSettings - Loads all configuration",
          "saveAllSettings - Saves all settings",
          "handleLogoUpload - Logo upload to Storage",
          "testOpenAIKey - OpenAI API key validation",
          "resetAllSettings - Factory reset",
          "exportFahrzeugeCSV, exportKundenCSV - CSV export",
          "deleteOldFahrzeuge - Data cleanup"
        ]
      },
      "firestore_collections": [
        "fahrzeuge (read/write)",
        "kunden (read)"
      ],
      "configuration": [
        "Email templates (Abschluss, Bestätigung, Erinnerung)",
        "Service toggles (Enable/disable 12 service types)",
        "Payment methods (Bank transfer, cash, card)",
        "Accounting fields (Geschäftsführer, Steuernummer)",
        "OpenAI integration"
      ]
    },
    "admin-dashboard.html": {
      "purpose": "Admin dashboard with statistics and quick actions",
      "lines": 1666,
      "title": "Admin-Dashboard | Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": {
        "total": 21,
        "key_functions": [
          "loadDashboardStats - Loads all statistics",
          "renderStatsGrid - Renders stat cards",
          "renderChartsHTML - Renders Chart.js charts",
          "setupRealtimeListeners - Real-time updates",
          "refreshDashboard - Dashboard refresh"
        ]
      },
      "firestore_collections": [
        "fahrzeuge (read)",
        "kunden (read)",
        "partners (read)",
        "mitarbeiter (read)",
        "materialRequests (read)"
      ],
      "charts": [
        "Vehicle status distribution",
        "Service type breakdown",
        "Top customers by revenue",
        "Trend analysis"
      ]
    },
    "admin-bonus-auszahlungen.html": {
      "purpose": "Partner bonus management and payouts",
      "lines": 2185,
      "title": "Bonus-Verwaltung - Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": {
        "total": 18,
        "key_functions": [
          "loadBonuses - Loads all bonus records",
          "renderBonuses - Renders bonus table",
          "calculatePartnerUmsatz - Revenue calculation per partner",
          "confirmAuszahlung - Confirms bonus payout",
          "scanPartnersForBonuses - Scans for eligible bonuses",
          "createBonusManually - Manual bonus creation"
        ]
      },
      "firestore_collections": [
        "bonusAuszahlungen (read/write)",
        "partnerAnfragen (read)",
        "partners (read)"
      ]
    },
    "rechnungen-admin.html": {
      "purpose": "Invoice management for workshops",
      "lines": 1923,
      "title": "Rechnungsverwaltung | Werkstatt Admin",
      "importance": "HIGH",
      "functions": {
        "total": 27,
        "key_functions": [
          "loadRechnungen - Loads invoices",
          "renderTable - Invoice table rendering",
          "openBezahltModal - Payment status update",
          "getStatus - Status determination",
          "generateUniqueRechnungsnummer - Invoice number generation"
        ]
      },
      "firestore_collections": [
        "fahrzeuge (read)",
        "partnerAnfragen (read)",
        "partners (read)",
        "counters (read/write)"
      ],
      "known_issues": [
        "PDF Failure Flags - Pattern #52 (Commit 2c04a59)",
        "Status Sync Validation - Pattern #50 (Commit bf067ad)"
      ]
    },
    "leihfahrzeuge.html": {
      "purpose": "Loaner vehicle management",
      "lines": 1746,
      "title": "Leihfahrzeuge verwalten | Auto-Lackierzentrum Mosbach",
      "importance": "LOW",
      "functions": {
        "total": 28,
        "key_functions": [
          "loadPoolVehicles - Loads loaner pool",
          "loadIncomingRequests - Loads rental requests",
          "assignVehicle - Assigns vehicle to customer",
          "returnVehicle - Processes vehicle return",
          "approveRequest - Approves rental request"
        ]
      },
      "firestore_collections": [
        "leihfahrzeugPool (read/write)",
        "leihfahrzeugAnfragen (read/write)"
      ]
    },
    "wissensdatenbank.html": {
      "purpose": "Knowledge base - Disassembly guides, handover notes, announcements",
      "lines": 3723,
      "title": "Wissensdatenbank | Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": {
        "total": 64,
        "key_functions": [
          "loadGuidelines - Loads technical guides",
          "loadDemontage - Loads disassembly instructions",
          "addComment - Adds comments to guides",
          "editCurrentGuideline - Edits guidelines",
          "filterAndRenderDemontage - Filters by difficulty/category",
          "createHandoverNote - Shift handover notes"
        ]
      },
      "firestore_collections": [
        "guidelines (read/write)",
        "demontage_anleitungen (read/write)",
        "categories (read/write)",
        "announcements (read/write)",
        "shift_handovers (read/write)"
      ]
    },
    "dienstplan.html": {
      "purpose": "Schedule management - Shift creation, assignments, handover",
      "lines": 3493,
      "title": "Dienstplan-Verwaltung - Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": {
        "total": 74,
        "key_functions": [
          "loadSchedule - Loads full schedule",
          "createSchicht - Creates new shift",
          "editSchichtTyp - Edits shift types",
          "calculateShiftHours - Hours calculation",
          "detectConflicts - Detects schedule conflicts",
          "handleDragDrop - Drag & drop shifts"
        ]
      },
      "firestore_collections": [
        "schichten (read/write)",
        "schichtTypen (read/write)",
        "mitarbeiter (read)",
        "bereiche (read/write)",
        "schichtWuensche (read)",
        "schichtTausche (read/write)"
      ]
    },
    "kalender.html": {
      "purpose": "Calendar view for material requests and scheduling",
      "lines": 3703,
      "title": "Kalender-Ansicht | Auto-Lackierzentrum Mosbach",
      "importance": "LOW",
      "functions": {
        "total": 57,
        "key_functions": [
          "loadEventsForDate - Loads events",
          "exportToICS, exportToPDF - Export functions",
          "handleDragDrop - Calendar item drag & drop",
          "detectConflicts - Conflict detection"
        ]
      },
      "firestore_collections": [
        "materialRequests (read)"
      ]
    },
    "liste.html": {
      "purpose": "Vehicle list/overview with status filtering",
      "lines": 3584,
      "title": "Fahrzeug-Übersicht | Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": {
        "total": 44,
        "key_functions": [
          "loadFromLocalStorage - Loads vehicle data",
          "filterTable - Advanced filtering",
          "filterKunden - Customer filtering",
          "filterService - Service type filtering",
          "deleteVehicle - Delete vehicle record",
          "formatStatus - Status formatting"
        ]
      },
      "firestore_collections": []
    },
    "entwuerfe-bearbeiten.html": {
      "purpose": "Draft editing - Complete incomplete vehicle intakes",
      "lines": 4841,
      "title": "Entwürfe Bearbeiten | Auto-Lackierzentrum Mosbach",
      "importance": "HIGH",
      "functions": {
        "total": 59,
        "key_functions": [
          "loadDrafts - Loads draft vehicles",
          "saveDraft - Saves changes",
          "createBestellungenFromErsatzteile - Creates orders from spare parts",
          "erstelleAngebot - Creates offer/quote",
          "fillFormFromPdf - PDF pre-fill",
          "renderSignature - Signature display"
        ]
      },
      "firestore_collections": [
        "fahrzeuge (read/write)",
        "ersatzteile (read/write)",
        "lackierung (read/write)",
        "arbeitslohn (read/write)",
        "materialien (read/write)",
        "bestellungen (read/write)"
      ]
    },
    "kalkulation.html": {
      "purpose": "Advanced costing/quote system with KI analysis",
      "lines": 18772,
      "title": "Kalkulation - Fahrzeugannahme App",
      "importance": "CRITICAL",
      "functions": {
        "total": 270,
        "key_functions": [
          "addMaterialToKalkulation - Material addition",
          "analyzeWithKI - AI-based damage analysis",
          "applyKISchaeden - Apply KI suggestions",
          "calculatePositionPreis - Position pricing",
          "buildKIRequest - AI request builder",
          "manageOENumbers - OE part management",
          "loadKalkulationTemplates - Template loading",
          "exportKalkulationToPDF - PDF export"
        ]
      },
      "firestore_collections": [
        "kalkulationen (read/write)",
        "kalkulation_katalog (read)",
        "kalkulation_material (read)",
        "kalkulation_saetze (read)",
        "kalkulation_templates (read)",
        "kalkulation_kunden (read)",
        "lieferanten (read)",
        "fahrzeuge (read)",
        "partnerAnfragen (read)",
        "ersatzteile (read)",
        "einstellungen (read)"
      ]
    },
    "nutzer-verwaltung.html": {
      "purpose": "User account management and role assignment",
      "lines": 1056,
      "title": "Nutzerverwaltung - Admin",
      "importance": "MEDIUM",
      "functions": {
        "total": 18,
        "key_functions": [
          "loadUsers - Loads all users",
          "approveUser - Approves pending users",
          "changeRole - Changes user role",
          "resetPassword - Password reset",
          "disableUser, enableUser - Account status"
        ]
      },
      "firestore_collections": [
        "users (read/write)"
      ]
    },
    "steuerberater-statistiken.html": {
      "purpose": "Tax accountant dashboard with financial statistics",
      "lines": 1046,
      "title": "Steuerberater-Statistiken | Auto-Lackierzentrum Mosbach",
      "importance": "LOW",
      "functions": {
        "total": 20
      },
      "features": [
        "Chart.js visualizations",
        "Financial trend analysis",
        "Revenue breakdown by service"
      ]
    },
    "registrierung.html": {
      "purpose": "Partner registration form",
      "lines": 950,
      "title": "Partner-Registrierung | Auto-Lackierzentrum Mosbach",
      "importance": "MEDIUM",
      "functions": [
        "handleRegistration - Form submission",
        "validateEmail - Email validation",
        "validatePhone - Phone validation"
      ]
    }
  },
  "summary": {
    "total_functions_across_codebase": "~1200 functions",
    "total_firestore_collections": 20,
    "critical_pages": [
      "annahme.html - Vehicle intake",
      "kanban.html - Process management",
      "kalkulation.html - Advanced costing",
      "index.html - Authentication & dashboard"
    ],
    "authentication_pattern": "2-stage: Werkstatt selection → Employee login",
    "multi_tenant_isolation": "werkstattId suffix on collections (e.g., fahrzeuge_mosbach)",
    "key_technical_patterns": [
      "Firestore real-time listeners with cleanup",
      "Multi-service status tracking system",
      "PDF generation (jsPDF client-side, Puppeteer server-side)",
      "Cloud Functions for async operations",
      "Service Worker caching",
      "Dark mode support"
    ]
  }
}
