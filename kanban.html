<!DOCTYPE html>
<html lang="de">
<head>
    <!-- werkstattId will be set dynamically by auth-manager.js after login -->
    <script>
        /// <reference path="js/types.js" />
        // window.werkstattId is set automatically after successful login
        // This ensures proper multi-tenant data isolation
    </script>
    <script>
        // ‚úÖ BUG #5 FIX: Global DEBUG flag for conditional logging
        window.DEBUG = (
            localStorage.getItem('DEBUG') === 'true' ||
            window.location.search.includes('debug=true') ||
            window.location.hostname === 'localhost' ||
            window.location.port === '8000'
        );

        // üõ°Ô∏è Pattern 57 FIX (2025-11-26): Background Sync Tracker
        // Tracks silent Firestore update failures and shows ONE warning toast
        window.backgroundSyncTracker = {
            failures: [],
            warningShown: false,
            maxFailuresBeforeWarning: 3,

            // Track a failed background sync operation
            trackFailure: function(operation, error, vehicleId) {
                this.failures.push({
                    operation,
                    error: error?.message || String(error),
                    vehicleId,
                    timestamp: Date.now()
                });

                console.error(`‚ùå Background Sync Failed [${operation}]:`, error);

                // Show ONE warning toast after multiple failures
                if (this.failures.length >= this.maxFailuresBeforeWarning && !this.warningShown) {
                    this.warningShown = true;
                    if (window.toast) {
                        window.toast.warning(
                            'Einige Hintergrund-Updates konnten nicht synchronisiert werden. ' +
                            'Bitte Seite neu laden falls Daten fehlen.',
                            { duration: 8000 }
                        );
                    }
                }
            },

            // Reset tracker (call on successful page load)
            reset: function() {
                this.failures = [];
                this.warningShown = false;
            },

            // Get failure count
            getFailureCount: function() {
                return this.failures.length;
            }
        };
    </script>

    <!-- üåì FOUC Prevention: Load Theme BEFORE CSS to prevent flash -->
    <script>
        (function() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            console.log(`üåì Theme pre-loaded in <head>: ${savedTheme} (FOUC Prevention)`);
        })();
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prozess√ºberwachung - Kanban Board | Auto-Lackierzentrum Mosbach</title>

    <!-- Aggressive No-Cache Headers (Cache-Fix f√ºr v=a4192c4) -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate, max-age=0">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Cache Buster - Force Reload -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <!-- Apple Liquid Glass Design System -->
    <link rel="stylesheet" href="design-system.css?v=af6b90f">
    <link rel="stylesheet" href="liquid-glass.css?v=af6b90f">
    <link rel="stylesheet" href="animations.css?v=af6b90f">
    <link rel="stylesheet" href="mobile-first.css?v=af6b90f">
    <link rel="stylesheet" href="css/ai-chat-widget.css">
    <link rel="stylesheet" href="css/quota-display.css">
    <link rel="stylesheet" href="css/skeleton.css"> <!-- üÜï Skeleton Loaders -->

    <!-- üõ°Ô∏è PERFORMANCE FIX Phase 2: Ausgelagertes CSS (76 KB) -->
    <link rel="stylesheet" href="css/kanban.css">

    <!-- GSAP Animation Library (Phase 1 UX Redesign) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.5/gsap.min.js"></script>

    <!-- ========== MODAL: Als bezahlt markieren (KANBAN) ========== -->
    <div id="bezahltModal-kanban" class="modal" style="display: none; position: fixed; z-index: 10000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); align-items: center; justify-content: center;">
        <div class="modal-content" style="background-color: var(--color-surface); margin: auto; padding: 30px; border-radius: 12px; width: 90%; max-width: 500px; box-shadow: var(--shadow-xl); border: 1px solid var(--color-border);">
            <span class="modal-close" onclick="closeBezahltModalKanban()" style="color: var(--color-text-secondary); float: right; font-size: 28px; font-weight: bold; cursor: pointer; line-height: 20px; transition: color 0.2s;">&times;</span>
            <h2 style="color: var(--color-text-primary); margin-bottom: 20px; font-size: 24px; font-weight: 600;">Rechnung als bezahlt markieren</h2>

            <p id="modal-rechnungsnummer-kanban" style="color: var(--color-text-secondary); margin-bottom: 20px; font-size: 14px;"></p>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="modal-bezahldatum-kanban" class="form-label" style="display: block; margin-bottom: 8px; color: var(--color-text-primary); font-weight: 500;">Bezahldatum *</label>
                <input type="date" id="modal-bezahldatum-kanban" class="form-input" required style="width: 100%; padding: 10px; border: 1px solid var(--color-border); border-radius: 6px; background: var(--color-bg-secondary); color: var(--color-text-primary);">
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="modal-zahlungsart-kanban" class="form-label" style="display: block; margin-bottom: 8px; color: var(--color-text-primary); font-weight: 500;">Zahlungsart *</label>
                <select id="modal-zahlungsart-kanban" class="form-input" required style="width: 100%; padding: 10px; border: 1px solid var(--color-border); border-radius: 6px; background: var(--color-bg-secondary); color: var(--color-text-primary);">
                    <option value="">Bitte w√§hlen</option>
                    <option value="ueberweisung">√úberweisung</option>
                    <option value="bar">Bar</option>
                    <option value="karte">Karte</option>
                </select>
            </div>

            <div class="form-group" style="margin-bottom: 20px;">
                <label for="modal-notizen-kanban" class="form-label" style="display: block; margin-bottom: 8px; color: var(--color-text-primary); font-weight: 500;">Notizen</label>
                <textarea id="modal-notizen-kanban" class="form-input" rows="3" style="width: 100%; padding: 10px; border: 1px solid var(--color-border); border-radius: 6px; background: var(--color-bg-secondary); color: var(--color-text-primary); resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeBezahltModalKanban()" style="flex: 1; padding: 12px 24px; border: 1px solid var(--color-border); border-radius: 8px; background: var(--color-bg-secondary); color: var(--color-text-primary); font-weight: 600; cursor: pointer; transition: all 0.2s;">Abbrechen</button>
                <button class="btn btn-primary" onclick="submitBezahltKanban()" style="flex: 1; padding: 12px 24px; border: none; border-radius: 8px; background: var(--color-primary); color: white; font-weight: 600; cursor: pointer; transition: all 0.2s;">Speichern</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-functions-compat.js"></script>

    <!-- Firebase Konfiguration -->
    <script src="firebase-config.js?v=a4192c4"></script>

    <!-- Image Optimizer - Foto-Komprimierung -->
    <script src="image-optimizer.js"></script>

    <!-- Error Handler & Toast Notifications -->
    <script src="error-handler.js"></script>

    <!-- Listener Registry - Memory Leak Prevention -->
    <script src="listener-registry.js"></script>

    <!-- Auth Manager f√ºr Multi-Tenant Support -->
    <script src="js/auth-manager.js"></script>
    <script src="js/utils/escape-html.js"></script>
    <script src="js/settings-manager.js"></script>
    <script src="js/service-types.js"></script>
    <script src="js/permissions-helper.js"></script>

    <!-- Event System f√ºr Real-Time Updates (Phase 3) -->
    <script src="js/app-events.js"></script>

    <!-- Global Chat Notifications -->
    <link rel="stylesheet" href="global-chat-notifications.css">
    <script src="global-chat-notifications.js"></script>

    <!-- Feather Icons -->
    <script src="https://unpkg.com/feather-icons"></script>

    <!-- Dark Mode Toggle -->
    <!-- DISABLED: Legacy script creates duplicate buttons -->
    <!-- <script src="dark-mode-toggle.js"></script> -->

    <!-- Phase 3: Event Listeners for Real-Time UI Updates -->
    <script>
        // ============================================
        // INLINE FALLBACK: safeNavigate (if listener-registry.js not loaded yet)
        // ============================================
        window.safeNavigate = window.safeNavigate || function(url) {
            console.log(`üöÄ [FALLBACK] safeNavigate to: ${url}`);
            if (window.listenerRegistry) {
                window.listenerRegistry.unregisterAll();
            }
            setTimeout(() => { window.location.href = url; }, 100);
        };

        // ============================================
        // üîî KANBAN EVENT LISTENERS
        // ============================================
        function setupKanbanEventListeners() {
            // ‚úÖ [STATUS_UPDATE] Re-render only the affected card
            if (window.appEvents) {
                window.appEvents.subscribe(window.appEvents.EVENTS.VEHICLE_STATUS_UPDATED, function(data) {
                    console.log('üì° [KANBAN] Status Update Event empfangen:', data);

                    // Find and update just the card
                    const card = document.querySelector(`.kanban-card[data-id="${data.fahrzeugId}"]`);
                    if (card) {
                        // Update status badge if exists
                        const statusBadge = card.querySelector('.status-badge');
                        if (statusBadge) {
                            statusBadge.textContent = data.newStatus;
                            statusBadge.className = `status-badge status-${data.newStatus.replace(/\s+/g, '-').toLowerCase()}`;
                        }
                    }
                });

                // ‚úÖ [NEW_VEHICLE] Add new card without full reload
                window.appEvents.subscribe(window.appEvents.EVENTS.VEHICLE_CREATED, function(data) {
                    console.log('üì° [KANBAN] Neues Fahrzeug Event:', data);
                    // Full re-render for new vehicle (no optimized partial render implemented yet)
                    if (typeof renderKanbanBoard === 'function') {
                        renderKanbanBoard();
                    }
                });

                console.log('‚úÖ [KANBAN] Event Listeners registriert (Phase 3)');
            }
        }

        // Initialize event listeners when DOM is ready
        if (document.readyState === 'loading') {
            window.listenerRegistry.registerDOM(document, 'DOMContentLoaded', setupKanbanEventListeners, 'document DOMContentLoaded');
        } else {
            // DOM already loaded
            setupKanbanEventListeners();
        }
    </script>
</head>
<body class="has-ai-features">
    <!-- üé® Modern 2025 Background Effects -->
    <div class="gradient-mesh" aria-hidden="true"></div>
    <div class="noise-overlay" aria-hidden="true"></div>
    <div class="floating-orb floating-orb--1" aria-hidden="true"></div>
    <div class="floating-orb floating-orb--2" aria-hidden="true"></div>
    <div class="floating-orb floating-orb--3" aria-hidden="true"></div>

    <!-- üîô ZUR√úCK-BUTTON -->
    <button class="back-button" onclick="history.back()" title="Zur√ºck">
        <i data-feather="arrow-left"></i>
        <span>Zur√ºck</span>
    </button>

    <!-- THEME TOGGLE BUTTON - Fixed Top-Right (Desktop Only) -->
    <button
        id="dark-mode-toggle"
        class="theme-toggle"
        type="button"
        aria-label="Dunklen Modus aktivieren"
        aria-pressed="false"
        title="Theme wechseln (Cmd+Shift+D)">
        <svg class="theme-icon sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="theme-icon moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>

    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div id="werkstattLogo" style="display: inline-block; vertical-align: middle; margin-right: 12px;"></div>
                <h1>Prozess√ºberwachung</h1>
            </div>
            <p class="header-subtitle">Workflow-Board f√ºr alle Service-Prozesse</p>

            <!-- Navigation & Process Filter -->
            <div class="header-nav">
                <div class="nav-section">
                    <a href="index.html" class="nav-btn" title="Startseite">
                        <i data-feather="home"></i>
                        <span class="nav-btn-text">Start</span>
                    </a>
                    <a href="liste.html" class="nav-btn" title="Fahrzeugliste">
                        <i data-feather="list"></i>
                        <span class="nav-btn-text">Liste</span>
                    </a>
                    <a href="annahme.html" class="nav-btn highlight" title="Neues Fahrzeug aufnehmen">
                        <i data-feather="plus-circle"></i>
                        <span class="nav-btn-text">Neu</span>
                    </a>
                </div>

                <!-- Process Selector -->
                <div class="process-filter">
                    <label for="processSelect">Service:</label>
                    <select id="processSelect" onchange="switchProcess(this.value)">
                        <option value="alle" selected>Alle Prozesse</option>
                        <option value="lackier">Lackierung</option>
                        <option value="reifen">Reifen</option>
                        <option value="mechanik">Mechanik</option>
                        <option value="pflege">Pflege</option>
                        <option value="tuev">T√úV/AU</option>
                        <option value="versicherung">Versicherung</option>
                        <option value="glas">Glas</option>
                        <option value="klima">Klima</option>
                        <option value="dellen">Dellen</option>
                        <option value="folierung">Folierung</option>
                        <option value="steinschutz">Steinschutz</option>
                        <option value="werbebeklebung">Werbebeklebung</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <span>Lade Fahrzeuge...</span>
        </div>

        <!-- üè≠ KANBAN CONTAINER - Dynamisch bef√ºllt -->
        <div class="kanban-container" id="kanbanContainer">
            <!-- Columns werden dynamisch generiert basierend auf currentProcess -->
        </div>
    </div>

    <!-- ========== MODAL: Fahrzeug-Bilder Gro√üansicht ========== -->
    <div id="imageModal" class="photo-modal" style="display: none;">
        <div class="photo-modal-content">
            <span class="photo-modal-close" onclick="closeImageModal()">&times;</span>
            <div class="photo-modal-header">
                <h3 id="imageModalTitle">Fahrzeugbilder</h3>
            </div>
            <div class="photo-modal-images" id="imageModalContent">
                <!-- Bilder werden hier dynamisch eingef√ºgt -->
            </div>
        </div>
    </div>

    <!-- ========== MODAL: Auftrag-Details (Fotos) ========== -->
    <div id="auftragModal" class="photo-modal" style="display: none;">
        <div class="photo-modal-content">
            <span class="photo-modal-close" onclick="closeAuftragModal()">&times;</span>

            <div class="photo-modal-header">
                <h3 id="auftragModalTitle">Auftrag-Details</h3>
                <p id="auftragModalSubtitle" class="photo-modal-subtitle"></p>
            </div>

            <div class="photo-modal-body">
                <div class="auftrag-info-grid" id="auftragInfoGrid">
                    <!-- Wird dynamisch bef√ºllt -->
                </div>

                <div class="photo-modal-images" id="auftragModalImages">
                    <!-- Bilder werden hier eingef√ºgt -->
                </div>
            </div>

            <div class="photo-modal-buttons">
                <button class="photo-modal-btn secondary" onclick="closeAuftragModal()">
                    Schlie√üen
                </button>
            </div>
        </div>
    </div>

    <!-- üõ°Ô∏è PERFORMANCE FIX Phase 2: Ausgelagertes JavaScript (360 KB, 6.710 Zeilen) -->
    <script src="js/kanban.js"></script>

    <!-- Theme Toggle - After main script -->
    <script>
        // ============================================
        // üåì THEME TOGGLE (Kanban)
        // ============================================
        function initThemeToggle() {
            const toggleBtn = document.getElementById('dark-mode-toggle');
            if (!toggleBtn) return;

            // Apply saved theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            toggleBtn.setAttribute('aria-pressed', savedTheme === 'dark');

            // Toggle function
            toggleBtn.addEventListener('click', function() {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'dark' ? 'light' : 'dark';

                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                this.setAttribute('aria-pressed', newTheme === 'dark');

                console.log(`üåì Theme switched to: ${newTheme}`);
            });

            // Keyboard shortcut: Cmd+Shift+D
            document.addEventListener('keydown', function(e) {
                if ((e.metaKey || e.ctrlKey) && e.shiftKey && e.key.toLowerCase() === 'd') {
                    e.preventDefault();
                    toggleBtn.click();
                }
            });

            console.log('‚úÖ Theme Toggle initialized');
        }

        // Initialize when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initThemeToggle);
        } else {
            initThemeToggle();
        }
    </script>

    <!-- Werkstatt-Logo Loading -->
    <script>
        // ============================================
        // üè¢ WERKSTATT-LOGO LADEN
        // ============================================
        (async function() {
            try {
                const settings = await window.settingsManager.loadSettings();

                if (settings?.profil) {
                    // Update Page Title
                    document.title = `Prozess√ºberwachung | ${settings.profil.name || 'Auto-Lackierzentrum'}`;

                    // Display Logo
                    if (settings.profil.logoUrl) {
                        const logoContainer = document.getElementById('werkstattLogo');
                        if (logoContainer) {
                            logoContainer.innerHTML = `
                                <img src="${settings.profil.logoUrl}"
                                     alt="${settings.profil.name}"
                                     style="height: 32px; width: auto; vertical-align: middle;
                                            object-fit: contain;">
                            `;
                            console.log('‚úÖ [KANBAN] Werkstatt-Logo angezeigt');
                        }
                    }
                }
            } catch (error) {
                console.warn('‚ö†Ô∏è [KANBAN] Logo konnte nicht geladen werden:', error);
            }
        })();
    </script>

    <!-- üóëÔ∏è BOTTOM NAVIGATION ENTFERNT - Nur Mobile Header! -->

    <!-- KI-Chat-Assistent -->
    <div id="aiChatWidget"></div>
    <script src="js/ai-agent-tools.js"></script>
    <script src="js/ai-agent-engine.js"></script>
    <script src="js/ai-chat-widget.js"></script>
    <script src="js/quota-display.js"></script>

    <!-- ============================================
         SERVICE WORKER REGISTRATION - Offline-Funktionalit√§t
         ============================================ -->
    <script>
        // Service Worker nur registrieren wenn:
        // 1. Browser unterst√ºtzt Service Worker
        // 2. NICHT in Playwright Tests (navigator.webdriver)
        // 3. NICHT auf Emulator-Port (8000)
        if ('serviceWorker' in navigator && !navigator.webdriver && window.location.port !== '8000') {
            window.addEventListener('load', async () => {
                try {
                    const registration = await navigator.serviceWorker.register('./sw.js', {
                        scope: './'
                    });

                    console.log('‚úÖ [SW] Service Worker registriert:', registration.scope);

                    // Update-Handling: Neuen SW aktivieren wenn gefunden
                    registration.addEventListener('updatefound', () => {
                        const newWorker = registration.installing;
                        console.log('üîÑ [SW] Update gefunden, installiere...');

                        newWorker.addEventListener('statechange', () => {
                            if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                console.log('‚úÖ [SW] Update bereit! Seite neu laden f√ºr neue Version.');

                                // Optional: Auto-reload nach 3 Sekunden
                                // setTimeout(() => window.location.reload(), 3000);
                            }
                        });
                    });

                } catch (error) {
                    console.error('‚ùå [SW] Registrierung fehlgeschlagen:', error);
                }
            });
        } else {
            console.log('‚ÑπÔ∏è [SW] Service Worker nicht registriert (Test-Modus oder nicht unterst√ºtzt)');
        }
    </script>

    <!-- üé® UX REDESIGN 2025 - JavaScript -->
    <script>
        // ============================================
        // üé® UX REDESIGN 2025 - MICRO-INTERACTIONS
        // ============================================

        // 3D Tilt Effect on Kanban Cards
        function init3DTiltEffect() {
            const cards = document.querySelectorAll('.kanban-card');

            cards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.classList.add('tilt-active');
                });

                card.addEventListener('mouseleave', function() {
                    this.classList.remove('tilt-active');
                    this.style.setProperty('--tilt-x', '0deg');
                    this.style.setProperty('--tilt-y', '0deg');
                });

                card.addEventListener('mousemove', function(e) {
                    if (!this.classList.contains('tilt-active')) return;

                    const rect = this.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const y = e.clientY - rect.top;
                    const centerX = rect.width / 2;
                    const centerY = rect.height / 2;

                    const tiltX = ((y - centerY) / centerY) * -3; // Reduced intensity for cards
                    const tiltY = ((x - centerX) / centerX) * 3;

                    this.style.setProperty('--tilt-x', `${tiltX}deg`);
                    this.style.setProperty('--tilt-y', `${tiltY}deg`);
                });
            });

            console.log('‚úÖ 3D Tilt Effect initialized on', cards.length, 'kanban cards');
        }

        // Ripple Effect on Buttons and Cards
        function initRippleEffect() {
            const rippleElements = document.querySelectorAll('.nav-btn, .process-filter select');

            rippleElements.forEach(element => {
                element.addEventListener('click', function(e) {
                    // Remove existing ripples
                    const existingRipple = this.querySelector('.ripple');
                    if (existingRipple) existingRipple.remove();

                    // Create ripple
                    const ripple = document.createElement('span');
                    ripple.classList.add('ripple');

                    const rect = this.getBoundingClientRect();
                    const size = Math.max(rect.width, rect.height);
                    const x = e.clientX - rect.left - size / 2;
                    const y = e.clientY - rect.top - size / 2;

                    ripple.style.width = ripple.style.height = `${size}px`;
                    ripple.style.left = `${x}px`;
                    ripple.style.top = `${y}px`;

                    this.appendChild(ripple);

                    // Remove after animation
                    setTimeout(() => ripple.remove(), 600);
                });
            });

            console.log('‚úÖ Ripple Effect initialized on', rippleElements.length, 'elements');
        }

        // Scroll Reveal Animations
        function initScrollAnimations() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, {
                threshold: 0.1,
                rootMargin: '0px 0px -50px 0px'
            });

            // Add scroll-reveal class to kanban columns and cards
            document.querySelectorAll('.kanban-column, .kanban-card').forEach(el => {
                el.classList.add('scroll-reveal');
                observer.observe(el);
            });

            console.log('‚úÖ Scroll Animations initialized');
        }

        // GSAP Entry Animations
        function initGSAPAnimations() {
            if (typeof gsap === 'undefined') {
                console.warn('‚ö†Ô∏è GSAP not loaded, skipping entry animations');
                return;
            }

            // Animate header
            gsap.from('.header', {
                duration: 0.8,
                y: -30,
                opacity: 0,
                ease: 'power3.out'
            });

            // Animate kanban container
            gsap.from('.kanban-container', {
                duration: 0.8,
                y: 30,
                opacity: 0,
                ease: 'power3.out',
                delay: 0.2
            });

            // Animate kanban columns with stagger
            gsap.from('.kanban-column', {
                duration: 0.6,
                y: 20,
                opacity: 0,
                ease: 'power2.out',
                stagger: 0.1,
                delay: 0.4
            });

            console.log('‚úÖ GSAP Entry Animations initialized');
        }

        // Initialize all UX features when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Respect reduced motion preference
            if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                console.log('‚ö†Ô∏è Reduced motion preference detected, skipping animations');
                return;
            }

            // Initialize with slight delay to ensure page is fully rendered
            setTimeout(() => {
                init3DTiltEffect();
                initRippleEffect();
                initScrollAnimations();
                initGSAPAnimations();
                console.log('üé® UX Redesign 2025 fully initialized for Kanban');
            }, 100);
        });

        // Re-initialize tilt effect when cards are dynamically added
        const originalRenderCard = window.renderCard;
        if (typeof originalRenderCard === 'function') {
            window.renderCard = function(...args) {
                const result = originalRenderCard.apply(this, args);
                // Re-init tilt after new cards are rendered
                setTimeout(init3DTiltEffect, 100);
                return result;
            };
        }
    </script>
</body>
</html>
